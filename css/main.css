/* ============================================
   MYTHRAS CLASSIC FANTASY CHARACTER SHEET
   Main Layout Styles
   ============================================ */

/* Reset & Base */
*, *::before, *::after {
  box-sizing: border-box;
}

html {
  font-size: 18px;
}

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  font-family: var(--font-body);
  color: var(--text-primary);
  background: var(--bg-outer);
}

/* Global Input Alignment */
input[type="number"] {
  text-align: center;
  -moz-appearance: textfield;
  appearance: textfield;
}

input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type="text"] {
  text-align: left;
}

/* Standard input sizing for consistency across all pages */
input[type="text"],
input[type="number"],
select {
  padding: 0.4rem 0.5rem;
  font-family: var(--font-body);
  font-size: 0.95rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

input[type="text"]:focus,
input[type="number"]:focus,
select:focus {
  outline: none;
  border-color: var(--input-focus);
  box-shadow: 0 0 0 2px rgba(74, 60, 42, 0.15);
}

/* ============================================
   Navigation
   ============================================ */
.sheet-navigation {
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 1rem;
  background: var(--nav-bg);
  border-bottom: 2px solid var(--border-gold);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.tab-list {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 0.25rem;
}

.tab-btn {
  padding: 0.5rem 1rem;
  font-family: var(--font-header);
  font-size: 0.9rem;
  background: var(--tab-bg);
  border: 1px solid var(--border-gold);
  border-radius: 4px 4px 0 0;
  cursor: pointer;
  transition: all 0.2s ease;
  color: var(--text-primary);
}

.tab-btn:hover {
  background: var(--tab-hover);
}

.tab-btn.active {
  background: var(--tab-active);
  border-bottom-color: var(--tab-active);
  font-weight: 600;
}

.sheet-controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.sheet-type-selector {
  display: none; /* Sheet type is now automatic based on species */
  padding: 0.4rem 0.6rem;
  font-family: var(--font-body);
  border: 1px solid var(--border-gold);
  border-radius: 4px;
  background: var(--input-bg);
}

/* ============================================
   Buttons
   ============================================ */
.btn {
  padding: 0.4rem 0.8rem;
  font-family: var(--font-body);
  font-size: 0.85rem;
  border: 1px solid var(--border-gold);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-primary {
  background: var(--btn-primary-bg);
  color: var(--btn-primary-text);
}

.btn-primary:hover {
  background: var(--btn-primary-hover);
}

.btn-secondary {
  background: var(--btn-secondary-bg);
  color: var(--btn-secondary-text);
}

.btn-secondary:hover {
  background: var(--btn-secondary-hover);
}

.btn-small {
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
}

/* ============================================
   Page Structure
   ============================================ */
.character-sheet {
  width: 100%;
  max-width: none;
  margin: 0;
  padding: 0;
}

.sheet-page {
  display: none;
  padding: 0;
}

.sheet-page.active {
  display: block;
}

.page-content {
  padding: 1.5rem 2rem;
  background: var(--bg-parchment);
  min-height: calc(100vh - 60px);
}

.page-title {
  text-align: center;
  font-family: var(--font-header);
  font-size: 1.8rem;
  color: var(--text-header);
  margin: 0 0 1rem 0;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid var(--border-gold);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

/* ============================================
   Ornate Border
   ============================================ */
.ornate-border {
  border: 3px solid var(--border-gold);
  border-radius: 8px;
  box-shadow: 
    inset 0 0 20px rgba(139, 115, 85, 0.1),
    0 4px 12px rgba(0,0,0,0.15);
  position: relative;
}

.ornate-border::before {
  content: '';
  position: absolute;
  top: 4px;
  left: 4px;
  right: 4px;
  bottom: 4px;
  border: 1px solid var(--border-light);
  border-radius: 4px;
  pointer-events: none;
}

/* ============================================
   Page 1: Portrait
   ============================================ */
.page-portrait.active {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 80px);
}

.portrait-frame {
  width: 100%;
  max-width: 600px;
  aspect-ratio: 3/4;
  padding: 2rem;
  background: var(--bg-parchment);
}

.portrait-container {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: var(--portrait-bg);
  border: 1px solid var(--border-light);
}

.image-upload-input {
  position: absolute;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
  z-index: 2;
}

.image-upload-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 2rem;
  pointer-events: none;
}

.upload-text {
  font-family: var(--font-header);
  font-size: 2rem;
  color: var(--text-link);
  margin-bottom: 0.5rem;
}

.upload-subtext {
  font-size: 1.5rem;
  font-style: italic;
  color: var(--text-secondary);
}

.portrait-image {
  position: absolute;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 1;
}

.btn-remove-image {
  position: absolute;
  top: 0.25rem;
  right: 0.25rem;
  width: 1.25rem;
  height: 1.25rem;
  border-radius: 50%;
  border: none;
  background: rgba(200, 50, 50, 0.7);
  color: white;
  font-size: 0.75rem;
  line-height: 1;
  cursor: pointer;
  z-index: 3;
}

.btn-remove-image:hover {
  background: rgba(200, 50, 50, 1);
}

.hidden {
  display: none !important;
}

/* ============================================
   Page 2: Main Character Sheet Header
   ============================================ */
.sheet-header {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 1.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--border-gold);
  margin-bottom: 1.5rem;
}

.header-left,
.header-center,
.header-right {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  min-width: 0;
  overflow: hidden;
}

.header-logo {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}

.logo-mythras {
  text-align: center;
}

.logo-text {
  display: block;
  font-family: var(--font-header);
  font-size: 1.8rem;
  color: var(--text-header);
  letter-spacing: 0.1em;
}

.logo-subtext {
  display: block;
  font-family: var(--font-header);
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.portrait-thumbnail {
  position: relative;
  width: 120px;
  flex: 1;
  min-height: 120px;
  background: var(--portrait-bg);
  border: 1px solid var(--border-gold);
  overflow: hidden;
}

.thumbnail-label {
  padding: 0.5rem;
  font-size: 0.7rem;
}

.upload-text-small {
  font-family: var(--font-header);
  font-size: 0.8rem;
  color: var(--text-link);
  display: block;
  margin-bottom: 0.25rem;
}

.upload-subtext-small {
  font-size: 0.65rem;
  font-style: italic;
  display: block;
}

.portrait-image-thumb {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Field Rows */
.field-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-wrap: wrap;
  min-width: 0;
}

.field-label {
  font-weight: 600;
  font-size: 1rem;
  min-width: 0;
  flex-shrink: 1;
  white-space: nowrap;
}

.field-label-large {
  font-family: var(--font-header);
  font-size: 1rem;
  text-transform: uppercase;
}

.field-input {
  flex: 1 1 auto;
  padding: 0.5rem 0.75rem;
  font-family: var(--font-body);
  font-size: 0.95rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-width: 0;
  border-radius: 4px;
}

.field-input:focus {
  outline: none;
  border-color: var(--input-focus);
  box-shadow: 0 0 0 2px rgba(74, 60, 42, 0.2);
}

.field-input-large {
  font-size: 1rem;
  padding: 0.3rem 0.5rem;
}

.field-input-half {
  flex: 0.5;
}

.field-input-third {
  flex: 1;
  min-width: 60px;
  max-width: 100px;
}

.field-input-small {
  width: 80px;
  min-width: 50px;
  flex: 0 1 80px;
}

.field-input-tiny {
  width: 60px;
  min-width: 40px;
  flex: 0 1 60px;
  text-align: center;
}

.field-separator {
  font-weight: bold;
  color: var(--text-secondary);
}

.field-suffix {
  font-size: 0.85rem;
  color: var(--text-secondary);
}

/* Prerequisite Skills */
.prereq-skills {
  margin-top: 0.5rem;
  font-size: 0.75rem;
  max-width: 160px;
}

.prereq-row {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  margin-bottom: 0.2rem;
}

.prereq-key {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
  cursor: pointer;
  transition: transform 0.15s ease;
}

.prereq-key:hover {
  transform: scale(1.2);
}

.prereq-label {
  font-size: 0.72rem;
  color: var(--text-secondary);
}

.prereq-label.clickable {
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dotted;
}

.prereq-label.clickable:hover {
  color: var(--accent-color);
}

/* Rank Section */
.rank-section {
  padding: 0.5rem;
  background: rgba(255,255,255,0.3);
  border-radius: 4px;
  margin-bottom: 0.5rem;
  width: fit-content;
}

.rank-section-content {
  display: flex;
  gap: 1rem;
  align-items: stretch;
}

.rank-fields {
  flex: 1;
}

.rank-section .section-header {
  margin-bottom: 0.5rem;
  padding: 0.3rem 0.5rem;
}

.rank-section .rank-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.4rem;
}

.rank-section .rank-row:last-child {
  margin-bottom: 0;
}

.rank-section .combined-rank-row {
  margin-top: 0.5rem;
  padding-top: 0.4rem;
  border-top: 1px solid var(--border-gold);
}

.rank-section .combined-rank-row .field-label {
  font-weight: bold;
}

.rank-section .field-label {
  font-size: 0.95rem;
  min-width: auto;
}

.rank-section .field-input-tiny {
  width: 55px;
}

/* Rank Ready-to-Advance indicator */
.rank-section .field-input-tiny.rank-ready {
  background: #2e7d32;
  color: #fff;
  border-color: #1b5e20;
  box-shadow: 0 0 6px rgba(46, 125, 50, 0.5);
  font-weight: bold;
}

.rank-section .field-input-tiny.rank-ready:hover {
  background: #388e3c;
}

/* Max rank indicator */
.rank-section .field-input-tiny.rank-max {
  background: #b8860b;
  color: #fff;
  border-color: #8b6914;
}

/* Game Buttons - Vertical Layout in Rank Section */
.game-buttons-vertical {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  justify-content: center;
}

.game-btn-small {
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
}

.game-btn-small .game-icon {
  font-size: 0.9rem;
}

/* Tenacity & EXP */
.tenacity-section,
.exp-rolls-section {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.25rem;
}

.btn-spend-exp {
  padding: 0.35rem 0.75rem;
  font-size: 0.85rem;
  background: var(--button-bg, #5a4a3a);
  color: var(--button-text, #fff);
  border: 1px solid var(--border-gold);
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}

.btn-spend-exp:hover {
  background: var(--button-hover, #6b5a4a);
  transform: translateY(-1px);
}

.btn-spend-exp:active {
  transform: translateY(0);
}

/* ============================================
   Main Content Grid
   ============================================ */
.main-content-grid {
  display: grid;
  grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr) minmax(0, 1fr);
  gap: 1.5rem;
  align-items: start;
}

.column-left {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.column-center {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.column-left .skills-section,
.column-left .skill-grade-reference,
.column-left .enc-penalty-note {
  /* Skills section uses full width of left column */
}

.column-right {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  position: sticky;
  top: 80px;
  align-self: start;
  max-height: calc(100vh - 100px);
  overflow-y: auto;
  min-width: 0;
}

/* ============================================
   Attributes Section - Two Box Layout
   ============================================ */
.attributes-row {
  display: flex;
  gap: 1rem;
  overflow: hidden;
}

.attributes-section {
  background: rgba(255,255,255,0.2);
  padding: 0.75rem;
  border: 1px solid var(--border-light);
  border-radius: 8px;
}

.attributes-section.core-attributes {
  width: 170px;
  flex-shrink: 0;
}

.attributes-section.core-attributes .attribute-row {
  display: grid;
  grid-template-columns: 50px 55px;
  align-items: center;
  gap: 0.5rem;
  padding: 0.3rem 0;
  border-bottom: 1px solid var(--border-light);
}

.attributes-section.derived-attributes {
  flex: 1;
  min-width: 0;
}

.attributes-section .section-header {
  margin-bottom: 0.5rem;
}

.attributes-section.core-attributes .attribute-row:last-of-type {
  border-bottom: none;
}

.attribute-label {
  font-family: var(--font-header);
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-header);
}

.attribute-input {
  width: 55px;
  height: 55px;
  padding: 0.4rem;
  font-size: 1.3rem;
  font-weight: 600;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

/* Derived Attributes Box */
.derived-header {
  display: grid;
  grid-template-columns: 1fr 70px 70px;
  gap: 0.4rem;
  padding: 0.25rem 0;
  margin-bottom: 0.25rem;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
}

.derived-header-orig,
.derived-header-curr {
  text-align: center;
}

.derived-attributes .derived-row {
  display: grid;
  grid-template-columns: 1fr 70px;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0;
  border-bottom: 1px solid var(--border-light);
}

/* Special handling for rows with original values (two inputs) */
.derived-attributes .derived-row.has-original {
  grid-template-columns: 1fr 70px 70px;
}

/* Initiative dice button (inside label) */
.btn-init-roll {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  line-height: 1;
  opacity: 0.8;
  transition: opacity 0.2s, transform 0.15s;
  flex-shrink: 0;
  margin-left: 0.25rem;
  vertical-align: middle;
  display: inline-flex;
  align-items: center;
}

.btn-init-roll:hover {
  opacity: 1;
  transform: scale(1.2);
}

.d10-init-icon {
  width: 22px;
  height: 22px;
  color: var(--accent-color, #8b7355);
}

.derived-attributes .derived-row:last-of-type {
  border-bottom: none;
}

.derived-attributes .derived-label {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

/* Attribute info button */
.attr-info-btn {
  width: 16px;
  height: 16px;
  min-width: 16px;
  border-radius: 50%;
  border: 1px solid var(--accent-color);
  background: white;
  color: var(--accent-color);
  font-size: 0.65rem;
  font-weight: bold;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
  flex-shrink: 0;
}

.attr-info-btn:hover {
  background: var(--accent-color);
  color: white;
}

/* Tenacity section info button alignment */
.tenacity-section .field-label {
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.derived-input {
  width: 100%;
  padding: 0.4rem;
  font-size: 0.95rem;
  text-align: center !important;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.derived-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

.derived-input.derived-readonly {
  background: rgba(255,255,255,0.5) !important;
  color: var(--text-primary);
  font-weight: 600;
  cursor: default;
  border: 1px solid transparent !important;
}

.derived-input.derived-editable {
  background: var(--input-bg) !important;
  border: 1px solid var(--btn-primary-bg) !important;
  cursor: text;
}

/* Weapon Precision Damage Modifier row */
.wp-damage-row {
  background: rgba(100, 149, 237, 0.1);
  border-radius: 4px;
  margin: 2px 0;
  padding: 0.4rem 0.3rem !important;
}

.wp-damage-row .derived-label {
  color: #4a6fa5;
  font-style: italic;
}

.wp-damage-row .derived-input {
  background: rgba(100, 149, 237, 0.15) !important;
  border-color: rgba(100, 149, 237, 0.4) !important;
}

/* Characteristics readonly/editable states */
.attribute-input.char-readonly {
  background: rgba(255,255,255,0.5) !important;
  color: var(--text-primary);
  font-weight: 600;
  cursor: default;
  border: 1px solid transparent !important;
}

.attribute-input.char-editable {
  background: var(--input-bg) !important;
  border: 1px solid var(--btn-primary-bg) !important;
  cursor: text;
}

/* Unlock Button Row */
.unlock-button-row {
  margin-top: 0.75rem;
}

.btn-unlock {
  width: 100%;
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  font-weight: 600;
  background: linear-gradient(to bottom, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
  border: 1px solid var(--border-gold);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-unlock:hover {
  background: linear-gradient(to bottom, rgba(255,255,255,0.4), rgba(255,255,255,0.2));
  border-color: var(--text-header);
}

.btn-unlock.unlocked {
  background: linear-gradient(to bottom, rgba(180, 80, 80, 0.3), rgba(180, 80, 80, 0.1));
  border-color: var(--accent-rust);
}

.btn-small {
  padding: 0.4rem 0.75rem;
  font-size: 0.85rem;
  margin-top: 0.75rem;
}

.btn-warning {
  background: var(--btn-primary-bg);
  color: var(--btn-primary-text);
}

.attribute-input:focus {
  outline: none;
  border-color: var(--input-focus);
  box-shadow: 0 0 0 2px rgba(74, 60, 42, 0.2);
}

/* ============================================
   Skills Section
   ============================================ */
.skills-section,
.alignment-section,
.passion-section,
.oath-section,
.language-section {
  background: rgba(255,255,255,0.2);
  padding: 0.75rem;
  border: 1px solid var(--border-light);
  border-radius: 8px;
  overflow-x: hidden;
}

/* Scrollable containers for dynamic rows */
#passions-container {
  max-height: calc(4 * 42px);  /* 4 rows */
  overflow-y: auto;
  overflow-x: hidden;
}

#oaths-container {
  max-height: calc(5 * 42px);  /* 5 rows */
  overflow-y: auto;
  overflow-x: hidden;
}

#professional-skills-container {
  max-height: calc(20 * 38px);  /* 20 rows */
  overflow-y: auto;
  overflow-x: hidden;
  resize: vertical;
  min-height: 190px;
}

#passions-container::-webkit-scrollbar,
#oaths-container::-webkit-scrollbar,
#professional-skills-container::-webkit-scrollbar {
  width: 6px;
}

#passions-container::-webkit-scrollbar-track,
#oaths-container::-webkit-scrollbar-track,
#professional-skills-container::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
  border-radius: 3px;
}

#passions-container::-webkit-scrollbar-thumb,
#oaths-container::-webkit-scrollbar-thumb,
#professional-skills-container::-webkit-scrollbar-thumb {
  background: var(--border-gold);
  border-radius: 3px;
}

.section-header {
  font-family: var(--font-header);
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-header);
  margin: 0 0 0.75rem 0;
  padding: 0.4rem 0.6rem;
  background: linear-gradient(to right, rgba(139, 115, 85, 0.25), rgba(139, 115, 85, 0.1), transparent);
  border-left: 4px solid var(--border-gold);
  border-bottom: 1px solid var(--border-gold);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.skills-header,
.section-subheader {
  display: grid;
  grid-template-columns: 42px 1fr 70px 55px 60px 15px;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
  gap: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.skills-header.prof-header {
  grid-template-columns: 42px 1fr 80px 55px 60px;
}

/* Section header with button */
.section-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.25rem;
}

.section-header-row .section-header {
  margin-bottom: 0;
}

.header-buttons {
  display: flex;
  gap: 0.25rem;
}

.btn-small {
  padding: 0.2rem 0.5rem;
  font-size: 0.75rem;
  border-radius: 4px;
}

.btn-alphabetize,
.btn-add-row,
.btn-remove-row {
  background: var(--button-bg, #5a4a3a);
  color: var(--text-light);
  border: 1px solid var(--border-gold);
  cursor: pointer;
  transition: background 0.15s;
}

.btn-alphabetize:hover,
.btn-add-row:hover {
  background: #6b5a4a;
}

.btn-remove-row {
  background: #6b4a4a;
}

.btn-remove-row:hover {
  background: #8b5a5a;
}

.btn-add-row,
.btn-remove-row {
  font-weight: 700;
  font-size: 0.9rem;
  padding: 0.15rem 0.5rem;
}

/* ============================================
   BERSERK RAGE SECTION
   ============================================ */
.berserk-rage-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a1a1a 0%, #3d2020 100%);
  border: 2px solid #8b0000;
  border-radius: 6px;
}

.berserk-rage-section .section-header {
  color: #ff4444;
  text-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.berserk-rage-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.rage-info-row {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  color: #ddd;
  font-size: 0.75rem;
  flex-wrap: wrap;
}

.rage-label {
  color: #aaa;
}

.rage-value {
  font-weight: bold;
  color: #ff6b6b;
  min-width: 1rem;
  text-align: center;
}

.rage-button-row {
  display: flex;
  justify-content: center;
  margin-top: 0.25rem;
}

.btn-rage {
  background: linear-gradient(135deg, #8b0000 0%, #b22222 50%, #8b0000 100%);
  color: white;
  border: 1px solid #ff4444;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(139, 0, 0, 0.4);
  width: 100%;
  justify-content: center;
}

.btn-rage:hover {
  background: linear-gradient(135deg, #a00000 0%, #cc2222 50%, #a00000 100%);
  box-shadow: 0 4px 12px rgba(255, 68, 68, 0.5);
}

.btn-rage:disabled {
  background: #444;
  border-color: #666;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.btn-rage.raging {
  animation: rage-pulse 1s infinite;
  background: linear-gradient(135deg, #ff0000 0%, #ff4444 50%, #ff0000 100%);
}

@keyframes rage-pulse {
  0%, 100% { box-shadow: 0 0 8px rgba(255, 0, 0, 0.5); }
  50% { box-shadow: 0 0 18px rgba(255, 0, 0, 0.8), 0 0 35px rgba(255, 68, 68, 0.4); }
}

.rage-icon {
  font-size: 1rem;
}

.rage-tracker {
  background: rgba(139, 0, 0, 0.3);
  border: 1px solid #ff4444;
  border-radius: 5px;
  padding: 0.5rem;
  margin-top: 0.35rem;
}

.rage-active-label {
  text-align: center;
  font-size: 0.9rem;
  font-weight: bold;
  color: #ff4444;
  animation: rage-text-pulse 0.5s infinite alternate;
  margin-bottom: 0.35rem;
}

@keyframes rage-text-pulse {
  from { text-shadow: 0 0 5px rgba(255, 68, 68, 0.5); }
  to { text-shadow: 0 0 15px rgba(255, 68, 68, 1), 0 0 30px rgba(255, 0, 0, 0.5); }
}

.rage-rounds-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  justify-content: center;
  margin: 0.5rem 0;
  color: #ddd;
}

.rage-rounds-input {
  width: 50px;
  padding: 0.3rem;
  text-align: center;
  font-size: 1rem;
  font-weight: bold;
  background: #1a1a1a;
  color: #ff6b6b;
  border: 1px solid #ff4444;
  border-radius: 4px;
}

.rage-effects-summary {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.25rem;
  margin: 0.5rem 0;
  font-size: 0.8rem;
}

.rage-effect {
  color: #88ff88;
  padding: 0.2rem 0.4rem;
  background: rgba(0, 100, 0, 0.2);
  border-radius: 3px;
}

.rage-effect.rage-penalty {
  color: #ff8888;
  background: rgba(100, 0, 0, 0.2);
}

.btn-end-rage {
  width: 100%;
  background: #333;
  color: #ff6b6b;
  border: 1px solid #ff4444;
  padding: 0.5rem;
  cursor: pointer;
  border-radius: 4px;
  font-weight: bold;
  margin-top: 0.5rem;
}

.btn-end-rage:hover {
  background: #444;
}

.btn-reset-rage {
  background: #444;
  color: #ff6b6b;
  border: 1px solid #666;
  padding: 0.2rem 0.4rem;
  font-size: 0.9rem;
  cursor: pointer;
  border-radius: 4px;
  margin-left: 0.5rem;
}

.btn-reset-rage:hover {
  background: #555;
  border-color: #ff4444;
}

/* Strikethrough for disabled abilities during rage */
.class-ability-input.rage-disabled {
  text-decoration: line-through;
  color: #888;
  background: #f0f0f0;
}

/* Artful Dodger inactive state (heavy armor or overencumbered) */
.class-ability-input.ad-inactive {
  text-decoration: line-through;
  color: #999;
}

.class-ability-info-btn.ad-warning {
  background: #fff3e0;
  border-color: #e65100;
  color: #e65100;
  font-size: 0.65rem;
  font-weight: bold;
  cursor: help;
}

.class-ability-info-btn.ad-warning:hover {
  background: #e65100;
  color: white;
}

/* Rage boosted/penalized skill indicators */
.rage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #4a4 !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ============================================
   Universal Field Highlight Classes
   Use .field-boosted for ANY positive ability boost
   Use .field-penalized for ANY ability penalty
   ============================================ */
.field-boosted,
input.field-boosted,
.derived-input.field-boosted,
.derived-input.derived-readonly.field-boosted,
.wp-damage-row .derived-input.field-boosted,
input.weapon-damage.field-boosted,
.damage-cell input.weapon-damage.field-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

.field-penalized,
input.field-penalized,
.derived-input.field-penalized,
.derived-input.derived-readonly.field-penalized {
  background-color: rgba(200, 100, 0, 0.15) !important;
  border: 1px solid #a64 !important;
  color: #a64 !important;
}

/* Generic damage-boosted class for any ability that modifies Damage Modifier */
.damage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ensure damage-boosted wins over derived-input compound selectors */
.derived-input.damage-boosted,
.derived-input.derived-readonly.damage-boosted,
.wp-damage-row .derived-input.damage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ensure damage-boosted wins for weapon damage fields on Combat page */
input.weapon-damage.damage-boosted,
.damage-cell input.weapon-damage.damage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ensure rage-boosted wins over derived-input compound selectors */
.derived-input.rage-boosted,
.derived-input.derived-readonly.rage-boosted,
.wp-damage-row .derived-input.rage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ensure rage-boosted wins for weapon damage fields on Combat page */
input.weapon-damage.rage-boosted,
.damage-cell input.weapon-damage.rage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

.rage-penalized {
  background-color: rgba(150, 0, 0, 0.15) !important;
  border-color: #a44 !important;
}

/* Artful Dodger bonus styling */
.artful-dodger-bonus {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Lightning Reflexes bonus styling (same green as artful dodger) */
.lightning-reflexes-bonus {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Agile bonus styling */
.agile-bonus {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ============================================
   FORCEFUL STRIKE SECTION
   ============================================ */
.forceful-strike-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #203d20 100%);
  border: 2px solid #4a8b4a;
  border-radius: 6px;
}

.forceful-strike-section .section-header {
  color: #6b6;
  text-shadow: 0 0 10px rgba(102, 187, 102, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.forceful-strike-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  align-items: center;
}

.forceful-strike-info {
  color: #aaa;
  font-size: 0.7rem;
  text-align: center;
}

.forceful-label {
  color: #9d9;
}

.forceful-strike-toggle {
  width: 100%;
}

.btn-forceful {
  background: linear-gradient(135deg, #2d5a2d 0%, #3d7a3d 50%, #2d5a2d 100%);
  color: white;
  border: 1px solid #6b6;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(45, 90, 45, 0.4);
  width: 100%;
}

.btn-forceful:hover {
  background: linear-gradient(135deg, #3d6a3d 0%, #4d8a4d 50%, #3d6a3d 100%);
  box-shadow: 0 4px 12px rgba(102, 187, 102, 0.5);
}

.btn-forceful.active {
  background: linear-gradient(135deg, #4a9a4a 0%, #5aba5a 50%, #4a9a4a 100%);
  animation: forceful-pulse 1.5s infinite;
  border-color: #8d8;
}

@keyframes forceful-pulse {
  0%, 100% { box-shadow: 0 0 8px rgba(102, 187, 102, 0.5); }
  50% { box-shadow: 0 0 15px rgba(102, 187, 102, 0.8), 0 0 30px rgba(90, 186, 90, 0.4); }
}

.forceful-icon {
  font-size: 1rem;
}

/* Forceful Strike penalized skill indicators */
.forceful-penalized {
  background-color: rgba(200, 100, 0, 0.15) !important;
  border: 1px solid #a64 !important;
  color: #a64 !important;
}

.forceful-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ============================================
   COMMANDING SECTION
   ============================================ */
.commanding-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a2a1a 0%, #3d3d20 100%);
  border: 2px solid #8b8b4a;
  border-radius: 6px;
}

.commanding-section .section-header {
  color: #cc6;
  text-shadow: 0 0 10px rgba(204, 204, 102, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.commanding-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.commanding-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.commanding-value {
  color: #cc6;
  font-weight: bold;
  font-size: 1rem;
}

.commanding-label {
  color: #999;
}

.btn-reset-commanding {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-commanding:hover {
  background: #444;
  border-color: #cc6;
  color: #cc6;
}

.commanding-button-row {
  display: flex;
  gap: 0.5rem;
  width: 100%;
}

.btn-commanding {
  flex: 1;
  background: linear-gradient(135deg, #4a4a2d 0%, #5a5a3d 50%, #4a4a2d 100%);
  color: white;
  border: 1px solid #cc6;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(90, 90, 45, 0.4);
}

.btn-commanding:hover:not(:disabled) {
  background: linear-gradient(135deg, #5a5a3d 0%, #6a6a4d 50%, #5a5a3d 100%);
  box-shadow: 0 4px 12px rgba(204, 204, 102, 0.5);
}

.btn-commanding:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.commanding-active {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.5rem;
  background: rgba(204, 204, 102, 0.1);
  border-radius: 4px;
  border: 1px solid #cc6;
}

.commanding-active-label {
  color: #cc6;
  font-weight: bold;
  font-size: 0.9rem;
  text-shadow: 0 0 8px rgba(204, 204, 102, 0.6);
  animation: commanding-pulse 2s infinite;
}

@keyframes commanding-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.btn-end-commanding {
  background: linear-gradient(135deg, #5a5a3d 0%, #6a6a4d 50%, #5a5a3d 100%);
  color: white;
  border: 1px solid #cc6;
  padding: 0.3rem 1rem;
  font-size: 0.8rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-end-commanding:hover {
  background: linear-gradient(135deg, #6a6a4d 0%, #7a7a5d 50%, #6a6a4d 100%);
}

/* Commanding boosted skill indicator */
.commanding-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ============================================
   MENTAL STRENGTH SECTION
   ============================================ */
/* ========================================
   ABILITY ANIMATION OVERLAYS (shared)
   ======================================== */
.ability-anim-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.ability-anim-overlay.active {
  opacity: 1;
}
.ability-anim-content {
  text-align: center;
  color: white;
}

/* Holy Strike Animation */
.holy-strike-anim .holy-strike-icon {
  font-size: 4rem;
  animation: holyPulse 0.5s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(240,192,64,0.8));
}
.holy-strike-anim .holy-strike-title {
  font-size: 1.8rem;
  font-weight: bold;
  color: #f0c040;
  text-shadow: 0 0 20px rgba(240,192,64,0.6);
  margin-top: 0.5rem;
}
.holy-strike-anim .holy-strike-subtitle {
  font-size: 1rem;
  color: #ddd;
  margin-top: 0.25rem;
}
@keyframes holyPulse {
  0% { transform: scale(1); }
  100% { transform: scale(1.15); }
}

/* Lay on Hands Animation */
.lay-on-hands-anim {
  position: relative;
}
.lay-on-hands-anim .lay-on-hands-icon {
  font-size: 4rem;
  animation: healPulse 0.8s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(125,212,212,0.8));
}
.lay-on-hands-anim .lay-on-hands-anim-title {
  font-size: 1.8rem;
  font-weight: bold;
  color: #7dd4d4;
  text-shadow: 0 0 20px rgba(125,212,212,0.6);
  margin-top: 0.5rem;
}
.lay-on-hands-particles {
  position: absolute;
  top: 0; left: 50%;
  transform: translateX(-50%);
  width: 120px; height: 120px;
}
.heal-particle {
  position: absolute;
  color: #7dd4d4;
  font-size: 1.2rem;
  opacity: 0;
  animation: healFloat 1.5s ease-out infinite;
}
.heal-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
.heal-particle:nth-child(2) { left: 30%; animation-delay: 0.3s; }
.heal-particle:nth-child(3) { left: 50%; animation-delay: 0.15s; }
.heal-particle:nth-child(4) { left: 70%; animation-delay: 0.45s; }
.heal-particle:nth-child(5) { left: 90%; animation-delay: 0.6s; }
@keyframes healPulse {
  0% { transform: scale(1); }
  100% { transform: scale(1.1); }
}
@keyframes healFloat {
  0% { opacity: 0; transform: translateY(0); }
  30% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-60px); }
}

/* Detect Evil Animation */
.detect-evil-anim {
  position: relative;
}
.detect-evil-anim .detect-evil-icon {
  font-size: 4rem;
  animation: detectPulse 0.6s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(192,128,255,0.8));
  position: relative;
  z-index: 2;
}
.detect-evil-anim .detect-evil-anim-title {
  font-size: 1.4rem;
  font-weight: bold;
  color: #c080ff;
  text-shadow: 0 0 15px rgba(192,128,255,0.6);
  margin-top: 0.5rem;
  position: relative;
  z-index: 2;
}
.detect-evil-rings {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
.detect-ring {
  position: absolute;
  border: 2px solid rgba(192,128,255,0.4);
  border-radius: 50%;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
.detect-ring.ring-1 {
  width: 80px; height: 80px;
  animation: ringExpand 2s ease-out infinite;
}
.detect-ring.ring-2 {
  width: 80px; height: 80px;
  animation: ringExpand 2s ease-out 0.5s infinite;
}
.detect-ring.ring-3 {
  width: 80px; height: 80px;
  animation: ringExpand 2s ease-out 1s infinite;
}
@keyframes detectPulse {
  0% { transform: scale(1); }
  100% { transform: scale(1.08); }
}
@keyframes ringExpand {
  0% { width: 40px; height: 40px; opacity: 0.8; border-color: rgba(192,128,255,0.6); }
  100% { width: 200px; height: 200px; opacity: 0; border-color: rgba(192,128,255,0); }
}

/* ========================================
   HOLY STRIKE SECTION
   ======================================== */
.holy-strike-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a1a1a 0%, #3d2020 100%);
  border: 2px solid #b8860b;
  border-radius: 6px;
}

.holy-strike-section .section-header {
  color: #f0c040;
  text-shadow: 0 0 10px rgba(240, 192, 64, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.holy-strike-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.holy-strike-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.holy-strike-value {
  color: #f0c040;
  font-weight: bold;
  font-size: 1rem;
}

.holy-strike-label {
  color: #999;
}

.btn-reset-holy-strike {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-holy-strike:hover {
  background: #444;
  border-color: #f0c040;
  color: #f0c040;
}

.holy-strike-button-row {
  width: 100%;
}

.btn-holy-strike {
  width: 100%;
  background: linear-gradient(135deg, #4a2d1a 0%, #6a3d20 50%, #4a2d1a 100%);
  color: white;
  border: 1px solid #f0c040;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(184, 134, 11, 0.4);
}

.btn-holy-strike:hover:not(:disabled) {
  background: linear-gradient(135deg, #5a3d2a 0%, #7a4d30 50%, #5a3d2a 100%);
  box-shadow: 0 4px 12px rgba(240, 192, 64, 0.5);
}

.btn-holy-strike:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.holy-strike-active-btn {
  background: linear-gradient(135deg, #6a4d20 0%, #8a6d30 50%, #6a4d20 100%) !important;
  border-color: #ffd700 !important;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.6) !important;
  animation: holyBtnPulse 1.5s ease-in-out infinite;
}

@keyframes holyBtnPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.4); }
  50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
}

/* Holy Strike damage cell highlight */
.damage-cell.holy-strike-highlight {
  background: rgba(0, 180, 0, 0.15) !important;
  border-radius: 4px;
  box-shadow: 0 0 8px rgba(0, 200, 0, 0.3);
  transition: all 0.3s ease;
}

.holy-strike-badge {
  display: inline-block;
  background: linear-gradient(135deg, #2a5a1a, #3a7a2a);
  color: #7fff7f;
  font-size: 0.7rem;
  font-weight: bold;
  padding: 0.1rem 0.3rem;
  border-radius: 3px;
  border: 1px solid #5a5;
  margin-left: 4px;
  animation: badgePulse 1.5s ease-in-out infinite;
  white-space: nowrap;
}

@keyframes badgePulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 1; }
}

/* ========================================
   DETECT EVIL SECTION
   ======================================== */
.detect-evil-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1a2a 0%, #2d2040 100%);
  border: 2px solid #8060b0;
  border-radius: 6px;
}

.detect-evil-section .section-header {
  color: #c080ff;
  text-shadow: 0 0 10px rgba(192, 128, 255, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.detect-evil-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.detect-evil-button-row {
  width: 100%;
}

.btn-detect-evil {
  width: 100%;
  background: linear-gradient(135deg, #2a1a3a 0%, #3d2a50 50%, #2a1a3a 100%);
  color: white;
  border: 1px solid #8060b0;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(128, 96, 176, 0.4);
}

.btn-detect-evil:hover {
  background: linear-gradient(135deg, #3a2a4a 0%, #4d3a60 50%, #3a2a4a 100%);
  box-shadow: 0 4px 12px rgba(192, 128, 255, 0.5);
}

/* ========================================
   CURE DISEASE SECTION
   ======================================== */
.cure-disease-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #2a3d2a 100%);
  border: 2px solid #5a8a5a;
  border-radius: 6px;
}

.cure-disease-section .section-header {
  color: #7dcc7d;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.cure-disease-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.cure-disease-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.cure-disease-value {
  color: #7dcc7d;
  font-weight: bold;
  font-size: 1rem;
}

.cure-disease-label {
  color: #999;
}

.btn-reset-cure-disease {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-cure-disease:hover {
  background: #444;
  border-color: #7dcc7d;
  color: #7dcc7d;
}

.cure-disease-button-row {
  width: 100%;
}

.btn-cure-disease {
  width: 100%;
  background: linear-gradient(135deg, #1a3a1a 0%, #2a5a2a 50%, #1a3a1a 100%);
  color: white;
  border: 1px solid #5a8a5a;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(90, 138, 90, 0.4);
}

.btn-cure-disease:hover:not(:disabled) {
  background: linear-gradient(135deg, #2a4a2a 0%, #3a6a3a 50%, #2a4a2a 100%);
  box-shadow: 0 4px 12px rgba(125, 204, 125, 0.5);
}

.btn-cure-disease:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Cure Disease Animation */
.cure-disease-anim {
  position: relative;
}
.cure-disease-anim .cure-disease-icon {
  font-size: 4rem;
  animation: curePulse 0.7s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(125,204,125,0.8));
}
.cure-disease-anim .cure-disease-anim-title {
  font-size: 1.6rem;
  font-weight: bold;
  color: #7dcc7d;
  text-shadow: 0 0 15px rgba(125,204,125,0.6);
  margin-top: 0.5rem;
  position: relative;
  z-index: 2;
}
.cure-disease-particles {
  position: absolute;
  top: 0; left: 50%;
  transform: translateX(-50%);
  width: 120px; height: 120px;
}
.cure-particle {
  position: absolute;
  color: #7dcc7d;
  font-size: 1.2rem;
  opacity: 0;
  animation: healFloat 1.5s ease-out infinite;
}
.cure-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
.cure-particle:nth-child(2) { left: 30%; animation-delay: 0.25s; }
.cure-particle:nth-child(3) { left: 50%; animation-delay: 0.1s; }
.cure-particle:nth-child(4) { left: 70%; animation-delay: 0.35s; }
.cure-particle:nth-child(5) { left: 90%; animation-delay: 0.5s; }
@keyframes curePulse {
  0% { transform: scale(1); }
  100% { transform: scale(1.1); }
}

/* ========================================
   DIVINE PROTECTION SECTION
   ======================================== */
.divine-protection-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1a2a 0%, #2a2a3d 100%);
  border: 2px solid #6080b8;
  border-radius: 6px;
}

.divine-protection-section .section-header {
  color: #80b0ff;
  text-shadow: 0 0 10px rgba(128, 176, 255, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.divine-protection-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.divine-protection-info {
  text-align: center;
}

.divine-prot-label {
  color: #80b0ff;
  font-size: 0.75rem;
  font-weight: bold;
}

.divine-protection-toggle {
  width: 100%;
}

.btn-divine-protection {
  width: 100%;
  background: linear-gradient(135deg, #1a2a4a 0%, #2a3a5a 50%, #1a2a4a 100%);
  color: white;
  border: 1px solid #6080b8;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(96, 128, 184, 0.4);
}

.btn-divine-protection:hover {
  background: linear-gradient(135deg, #2a3a5a 0%, #3a4a6a 50%, #2a3a5a 100%);
  box-shadow: 0 4px 12px rgba(128, 176, 255, 0.5);
}

.divine-protection-active-btn {
  background: linear-gradient(135deg, #2a4a6a 0%, #3a5a8a 50%, #2a4a6a 100%) !important;
  border-color: #80b0ff !important;
  box-shadow: 0 0 15px rgba(128, 176, 255, 0.6) !important;
  animation: divProtPulse 1.5s ease-in-out infinite;
}

@keyframes divProtPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(128, 176, 255, 0.4); }
  50% { box-shadow: 0 0 20px rgba(128, 176, 255, 0.8); }
}

/* Divine Protection boosted skill fields */
.divine-prot-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Divine Protection highlighted skill row */
.divine-prot-row {
  background: rgba(128, 176, 255, 0.1) !important;
  border-radius: 4px;
  box-shadow: inset 0 0 8px rgba(128, 176, 255, 0.15);
  position: relative;
}
.divine-prot-row .skill-name {
  color: #80b0ff !important;
  text-shadow: 0 0 6px rgba(128, 176, 255, 0.3);
}

/* Divine Protection Animation */
.divine-prot-anim .divine-prot-icon {
  font-size: 4rem;
  animation: shieldPulse 0.5s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(128,176,255,0.8));
}
.divine-prot-anim .divine-prot-anim-title {
  font-size: 1.8rem;
  font-weight: bold;
  color: #80b0ff;
  text-shadow: 0 0 20px rgba(128,176,255,0.6);
  margin-top: 0.5rem;
}
.divine-prot-anim .divine-prot-subtitle {
  font-size: 1rem;
  color: #ddd;
  margin-top: 0.25rem;
}
@keyframes shieldPulse {
  0% { transform: scale(1); }
  100% { transform: scale(1.12); }
}

/* ========================================
   CIRCLE OF POWER SECTION
   ======================================== */
.circle-of-power-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1a2d 0%, #25254a 100%);
  border: 2px solid #5588cc;
  border-radius: 6px;
}

.circle-of-power-section .section-header {
  color: #77bbff;
  text-shadow: 0 0 10px rgba(119, 187, 255, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.circle-of-power-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  align-items: center;
  text-align: center;
}

.cop-label {
  color: #99aacc;
  font-size: 0.72rem;
  font-style: italic;
}

.circle-of-power-detail {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.cop-text {
  color: #aabbdd;
  font-size: 0.78rem;
}

.cop-magnitude {
  display: inline-block;
  background: linear-gradient(135deg, #2a3a6a, #3a4a8a);
  color: #77bbff;
  font-size: 1.2rem;
  font-weight: bold;
  padding: 0.15rem 0.5rem;
  border-radius: 5px;
  border: 1px solid #5588cc;
  min-width: 2rem;
  text-align: center;
  text-shadow: 0 0 8px rgba(119, 187, 255, 0.5);
}

.circle-of-power-note {
  margin-top: 0.1rem;
}

.cop-formula {
  color: #778899;
  font-size: 0.68rem;
}

/* ========================================
   FAMILIAR SECTION (SORCERER)
   ======================================== */
.familiar-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1528 0%, #231a35 100%);
  border: 2px solid #7a4f9e;
  border-radius: 6px;
}

.familiar-section .section-header {
  color: #c090e0;
}

.familiar-content {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.familiar-type-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.3rem 0.5rem;
  background: rgba(138, 43, 226, 0.12);
  border-radius: 4px;
  border: 1px solid rgba(138, 43, 226, 0.25);
}

.familiar-type-label {
  font-weight: 600;
  font-size: 0.85rem;
  color: #c090e0;
}

.familiar-type-value {
  font-size: 0.9rem;
  font-weight: 700;
  color: #d0a0f0;
  flex: 1;
}

.btn-choose-familiar {
  font-size: 0.75rem;
  padding: 0.15rem 0.4rem;
  background: rgba(138, 43, 226, 0.2);
  border: 1px solid rgba(160, 80, 200, 0.4);
  border-radius: 3px;
  cursor: pointer;
  color: #c090e0;
}

.btn-choose-familiar:hover {
  background: rgba(138, 43, 226, 0.35);
}

.familiar-info-details {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
  font-size: 0.78rem;
  color: #b0b0b0;
}

.familiar-info-item {
  padding: 0.1rem 0;
}

.familiar-warning {
  color: #f08080;
  font-weight: 600;
}

.familiar-note {
  font-size: 0.72rem;
  color: #999;
  font-style: italic;
  border-top: 1px solid rgba(138, 43, 226, 0.2);
  padding-top: 0.3rem;
  margin-top: 0.1rem;
}

/* Magic Surge Section */
.magic-surge-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #151a28 0%, #1a2540 100%);
  border: 2px solid #4a7ab8;
  border-radius: 6px;
}

.magic-surge-section .section-header {
  color: #70b0e0;
}

.magic-surge-content {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.magic-surge-info-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.85rem;
}

.magic-surge-value {
  font-weight: 800;
  font-size: 1.1rem;
  color: #70b0e0;
}

.magic-surge-label {
  color: #999;
  font-size: 0.82rem;
}

.magic-surge-button-row {
  display: flex;
  gap: 0.5rem;
}

.btn-magic-surge {
  flex: 1;
  padding: 0.4rem 0.6rem;
  background: linear-gradient(to bottom, #1e3a5a, #253e60);
  border: 1px solid #4a7ab8;
  border-radius: 5px;
  color: #b0d0f0;
  font-weight: 700;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.15s;
}

.btn-magic-surge:hover {
  background: linear-gradient(to bottom, #253e60, #2e4870);
  border-color: #70a0d0;
}

.btn-magic-surge:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Familiar Type Modal */
.familiar-modal-content {
  max-width: 420px;
  padding: 1.2rem;
}

.familiar-modal-content .modal-title {
  text-align: center;
  color: #7b3f9e;
  margin-bottom: 0.5rem;
}

.familiar-modal-desc {
  font-size: 0.8rem;
  color: #777;
  text-align: center;
  margin-bottom: 0.8rem;
}

.familiar-modal-options {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

.familiar-option-group {
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
}

.familiar-option-label {
  font-size: 0.78rem;
  font-weight: 600;
  color: #555;
}

.familiar-select {
  padding: 0.35rem 0.5rem;
  border: 1px solid rgba(138, 43, 226, 0.3);
  border-radius: 4px;
  font-size: 0.85rem;
  background: rgba(138, 43, 226, 0.04);
}

.familiar-custom-input {
  padding: 0.35rem 0.5rem;
  border: 1px solid rgba(138, 43, 226, 0.3);
  border-radius: 4px;
  font-size: 0.85rem;
}

.familiar-modal-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  margin-top: 0.8rem;
}

.btn-confirm-familiar {
  background: #7b3f9e;
  color: white;
  border: none;
  padding: 0.4rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 600;
}

.btn-confirm-familiar:hover {
  background: #6a2e8d;
}

.btn-cancel-familiar {
  background: #ccc;
  color: #333;
  border: none;
  padding: 0.4rem 1rem;
  border-radius: 4px;
  cursor: pointer;
}

.btn-cancel-familiar:hover {
  background: #bbb;
}

/* ========================================
   SPELL WEAVING (SORCERER)  Cast Modal
   ======================================== */
.cast-modal-weaving {
  margin: 0.4rem 0;
  padding: 0.5rem 0.6rem;
  border-radius: 6px;
  border: 1px solid rgba(140, 80, 200, 0.25);
  background: rgba(100, 60, 180, 0.06);
}

.weaving-header-row {
  display: flex;
  align-items: baseline;
  gap: 0.4rem;
}

.weaving-toggle {
  cursor: pointer;
  user-select: none;
}

.weaving-toggle:hover {
  opacity: 0.85;
}

.weaving-toggle-arrow {
  font-size: 0.8rem;
  color: #c090e0;
  transition: transform 0.2s;
}

.weaving-label {
  font-weight: 700;
  font-size: 0.95rem;
  color: #c090e0;
}

.weaving-max-note {
  font-size: 0.78rem;
  color: #888;
  font-style: italic;
}

.weaving-body {
  margin-top: 0.4rem;
}

.weaving-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.3rem;
}

.weaving-option {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.35rem 0.5rem;
  border-radius: 4px;
  border: 1px solid rgba(140, 80, 200, 0.15);
  background: rgba(30, 20, 50, 0.3);
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, opacity 0.2s;
  font-size: 0.88rem;
}

.weaving-option:hover:not(.disabled) {
  background: rgba(100, 60, 180, 0.15);
  border-color: rgba(140, 80, 200, 0.35);
}

.weaving-option.active {
  background: rgba(100, 60, 180, 0.2);
  border-color: rgba(160, 100, 220, 0.5);
  box-shadow: 0 0 4px rgba(140, 80, 200, 0.2);
}

.weaving-option.disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.weaving-option.quickening-warn {
  border-color: rgba(200, 160, 40, 0.3);
}

.weaving-option.quickening-warn .weaving-name::after {
  content: ' ';
  font-size: 0.8rem;
  color: #d4a017;
}

.weaving-check {
  margin: 0;
  accent-color: #9060c0;
  width: 16px;
  height: 16px;
}

.weaving-name {
  color: #ddd;
  font-weight: 600;
  flex: 1;
}

.weaving-cost {
  color: #70b0e0;
  font-size: 0.82rem;
  font-weight: 600;
}

.weaving-diff {
  color: #d4a017;
  font-size: 0.78rem;
  font-style: italic;
}

.weaving-summary {
  display: flex;
  gap: 0.6rem;
  justify-content: center;
  margin-top: 0.4rem;
  padding: 0.3rem 0.5rem;
  border-radius: 4px;
  background: rgba(100, 60, 180, 0.12);
  border: 1px solid rgba(140, 80, 200, 0.2);
  font-size: 0.85rem;
}

.weaving-summary-cost {
  color: #70b0e0;
  font-weight: 700;
}

.weaving-summary-diff {
  color: #d4a017;
  font-weight: 600;
}

.weaving-summary-time {
  color: #e08060;
  font-weight: 600;
}

/* Weaving Amplify note below summary */
.weaving-amplify-note {
  text-align: center;
  font-size: 0.85rem;
  color: #e06030;
  font-weight: 600;
  margin-top: 0.3rem;
  padding: 0.25rem 0.5rem;
  background: rgba(224, 96, 48, 0.1);
  border-radius: 6px;
}

/* Duration/Area that can't be modified by weave */
.stat-weave-no-effect {
  opacity: 0.6;
  text-decoration: line-through;
  text-decoration-color: rgba(255, 80, 80, 0.5);
}

/* Damage modal: Amplify note */
.damage-amplify-note {
  text-align: center;
  font-size: 0.82rem;
  color: #e06030;
  font-weight: 600;
  margin: 0.3rem 0 0.5rem;
  padding: 0.3rem 0.6rem;
  background: rgba(224, 96, 48, 0.12);
  border-radius: 6px;
  border: 1px solid rgba(224, 96, 48, 0.25);
}

/* Amplify badge next to dice expression */
.damage-amplify-badge {
  display: inline-block;
  font-size: 0.7rem;
  font-weight: 700;
  color: #e06030;
  background: rgba(224, 96, 48, 0.15);
  padding: 0.1rem 0.35rem;
  border-radius: 4px;
  margin-left: 0.3rem;
  vertical-align: middle;
}

/* Amplify calculation breakdown */
.damage-amplify-calc {
  text-align: center;
  font-size: 0.82rem;
  color: #e06030;
  margin-top: 0.3rem;
  padding: 0.2rem 0;
}

/* Amplified total */
.damage-amplified-total {
  color: #e06030 !important;
  font-size: 1.2rem !important;
  border-top: 1px solid rgba(224, 96, 48, 0.3);
  padding-top: 0.3rem;
  margin-top: 0.2rem;
}

/* Manual roll amplify reminder */
.damage-manual-amplify {
  text-align: center;
  font-size: 0.82rem;
  color: #e06030;
  margin: 0.4rem 0;
  padding: 0.3rem 0.5rem;
  background: rgba(224, 96, 48, 0.1);
  border-radius: 6px;
  border: 1px dashed rgba(224, 96, 48, 0.3);
}

.weaving-lock-note {
  text-align: center;
  font-size: 0.8rem;
  color: #d4a017;
  margin-top: 0.3rem;
  font-style: italic;
}

/* Intensity locked by weaving */
.intensity-locked {
  opacity: 0.5;
  pointer-events: none;
}

/* Weaving locked by intensity */
.weaving-locked-by-intensity {
  opacity: 0.5;
}

.weaving-locked-by-intensity .weaving-check {
  pointer-events: none;
}

.weaving-locked-by-intensity::after {
  content: ' Weaving unavailable while Intensity > 1';
  display: block;
  text-align: center;
  font-size: 0.72rem;
  color: #d4a017;
  margin-top: 0.3rem;
  font-style: italic;
}

/* ========================================
   ARCANE FLUX MODAL (SORCERER)
   ======================================== */
.arcane-flux-modal-overlay {
  z-index: 10001;
}

.arcane-flux-modal {
  max-width: 500px;
  padding: 1.2rem;
  border-radius: 8px;
}

.arcane-flux-modal.flux-minor {
  border: 2px solid rgba(200, 160, 40, 0.6);
  background: linear-gradient(135deg, #1a1a10, #252015);
}

.arcane-flux-modal.flux-major {
  border: 2px solid rgba(200, 40, 40, 0.6);
  background: linear-gradient(135deg, #1a1010, #251515);
}

.flux-title {
  text-align: center;
  margin: 0 0 0.5rem 0;
  font-size: 1.1rem;
}

.flux-minor .flux-title {
  color: #d4a017;
}

.flux-major .flux-title {
  color: #e04040;
}

.flux-desc {
  text-align: center;
  font-size: 0.82rem;
  color: #bbb;
  margin-bottom: 0.8rem;
}

.flux-wisdom-note {
  font-size: 0.8rem;
  padding: 0.4rem 0.6rem;
  border-radius: 4px;
  margin-bottom: 0.7rem;
  background: rgba(100, 60, 180, 0.12);
  border: 1px solid rgba(140, 80, 200, 0.3);
  color: #c090e0;
}

.flux-wisdom-none {
  color: #999;
  background: rgba(80, 80, 80, 0.1);
  border-color: rgba(120, 120, 120, 0.2);
}

.flux-prompt-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  flex-wrap: wrap;
}

.flux-btn {
  padding: 0.45rem 0.9rem;
  border-radius: 5px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid;
  transition: background 0.2s;
}

.flux-btn-ignore {
  background: rgba(100, 60, 180, 0.2);
  border-color: rgba(140, 80, 200, 0.4);
  color: #c090e0;
}

.flux-btn-ignore:hover {
  background: rgba(100, 60, 180, 0.35);
}

.flux-btn-roll-self {
  background: rgba(40, 120, 200, 0.2);
  border-color: rgba(60, 140, 220, 0.4);
  color: #70b0e0;
}

.flux-btn-roll-self:hover {
  background: rgba(40, 120, 200, 0.35);
}

.flux-btn-system {
  background: rgba(200, 160, 40, 0.2);
  border-color: rgba(200, 160, 40, 0.4);
  color: #d4b040;
}

.flux-btn-system:hover {
  background: rgba(200, 160, 40, 0.35);
}

.flux-btn-submit, .flux-btn-confirm {
  background: rgba(40, 160, 80, 0.2);
  border-color: rgba(40, 160, 80, 0.4);
  color: #60c080;
}

.flux-btn-submit:hover, .flux-btn-confirm:hover {
  background: rgba(40, 160, 80, 0.35);
}

.flux-btn-close {
  background: rgba(120, 120, 120, 0.2);
  border-color: rgba(150, 150, 150, 0.3);
  color: #bbb;
}

.flux-btn-close:hover {
  background: rgba(120, 120, 120, 0.35);
}

.flux-btn-reroll {
  background: rgba(40, 120, 200, 0.2);
  border-color: rgba(60, 140, 220, 0.4);
  color: #70b0e0;
}

.flux-btn-reroll:hover {
  background: rgba(40, 120, 200, 0.35);
}

.flux-btn-keep {
  background: rgba(40, 160, 80, 0.2);
  border-color: rgba(40, 160, 80, 0.4);
  color: #60c080;
}

.flux-btn-keep:hover {
  background: rgba(40, 160, 80, 0.35);
}

.flux-btn-choose {
  margin-top: 0.3rem;
  padding: 0.3rem 0.7rem;
  font-size: 0.78rem;
  background: rgba(40, 160, 80, 0.15);
  border: 1px solid rgba(40, 160, 80, 0.3);
  color: #60c080;
  border-radius: 4px;
  cursor: pointer;
}

.flux-btn-choose:hover {
  background: rgba(40, 160, 80, 0.3);
}

.flux-roll-input-section {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.5rem;
  flex-wrap: wrap;
}

.flux-roll-label {
  font-size: 0.82rem;
  color: #bbb;
}

.flux-roll-input {
  width: 70px;
  padding: 0.3rem 0.4rem;
  border: 1px solid rgba(150, 150, 150, 0.3);
  border-radius: 4px;
  background: rgba(30, 30, 40, 0.6);
  color: #ddd;
  font-size: 0.9rem;
  text-align: center;
}

.flux-roll-display {
  text-align: center;
  font-size: 0.9rem;
  color: #ccc;
  margin-bottom: 0.4rem;
}

.flux-roll-number {
  font-size: 1.3rem;
  color: #d4a017;
}

.flux-major .flux-roll-number {
  color: #e04040;
}

.flux-result-display {
  margin: 0.5rem 0;
}

.flux-result-effect {
  font-size: 0.85rem;
  line-height: 1.4;
  color: #ddd;
  padding: 0.5rem 0.6rem;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.04);
  border-left: 3px solid rgba(200, 160, 40, 0.5);
}

.flux-major .flux-result-effect,
.flux-major-effect {
  border-left-color: rgba(200, 40, 40, 0.5);
}

.flux-escalation {
  margin-top: 0.6rem;
  padding: 0.5rem;
  border: 1px solid rgba(200, 40, 40, 0.4);
  border-radius: 4px;
  background: rgba(200, 40, 40, 0.06);
}

.flux-escalation-title {
  color: #e04040;
  font-size: 0.9rem;
  margin: 0 0 0.4rem 0;
  text-align: center;
}

.flux-escalation-warning {
  color: #e04040;
  font-size: 0.82rem;
  margin-top: 0.4rem;
  font-weight: 600;
}

.flux-mitigation-note {
  font-size: 0.78rem;
  padding: 0.3rem 0.5rem;
  margin-bottom: 0.5rem;
  color: #c090e0;
  background: rgba(100, 60, 180, 0.08);
  border-radius: 4px;
  border: 1px solid rgba(140, 80, 200, 0.2);
}

.flux-reroll-note {
  font-size: 0.8rem;
  color: #70b0e0;
  margin-bottom: 0.4rem;
  text-align: center;
}

.flux-action-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  margin-top: 0.6rem;
  flex-wrap: wrap;
}

.flux-comparison {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.flux-compare-item {
  padding: 0.5rem;
  border-radius: 4px;
  border: 1px solid rgba(150, 150, 150, 0.2);
  transition: opacity 0.3s, border-color 0.3s;
}

.flux-compare-label {
  font-size: 0.8rem;
  color: #aaa;
  margin-bottom: 0.2rem;
}

.flux-compare-rejected {
  opacity: 0.4;
  border-color: rgba(200, 40, 40, 0.3);
  text-decoration: line-through;
}

.flux-compare-active {
  border-color: rgba(40, 160, 80, 0.5);
  background: rgba(40, 160, 80, 0.06);
}

.flux-choose-section {
  margin-bottom: 0.5rem;
}

.flux-choose-label {
  font-size: 0.82rem;
  color: #bbb;
  display: block;
  margin-bottom: 0.3rem;
}

.flux-choose-select {
  width: 100%;
  padding: 0.35rem 0.5rem;
  border: 1px solid rgba(150, 150, 150, 0.3);
  border-radius: 4px;
  background: rgba(30, 30, 40, 0.6);
  color: #ddd;
  font-size: 0.78rem;
}

.flux-double-result {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

/* ========================================
   SPELL DAMAGE RESOLUTION MODAL
   ======================================== */
.damage-modal-overlay {
  z-index: 10002;
}

.damage-modal {
  max-width: 440px;
  padding: 1.2rem;
  border-radius: 8px;
  border: 2px solid rgba(220, 80, 40, 0.4);
  background: linear-gradient(135deg, #1a1210, #251810);
}

.damage-title {
  text-align: center;
  margin: 0 0 0.3rem 0;
  font-size: 1.1rem;
  color: #e08050;
}

.damage-spell-name {
  text-align: center;
  font-size: 0.95rem;
  font-weight: 700;
  color: #ddd;
  margin-bottom: 0.5rem;
}

.damage-crit-note {
  text-align: center;
  font-size: 0.82rem;
  color: #d4a017;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.damage-info-block {
  padding: 0.5rem 0.6rem;
  border-radius: 5px;
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid rgba(220, 80, 40, 0.15);
  margin-bottom: 0.6rem;
}

.damage-formula-row,
.damage-loc-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.25rem;
  font-size: 0.85rem;
}

.damage-formula-label,
.damage-loc-label {
  color: #aaa;
  min-width: 90px;
}

.damage-formula-value {
  color: #e08050;
  font-weight: 700;
  font-size: 1rem;
}

.damage-loc-value {
  color: #ddd;
}

.damage-type-badge {
  font-size: 0.65rem;
  padding: 0.1rem 0.4rem;
  border-radius: 10px;
  text-transform: uppercase;
  font-weight: 700;
  letter-spacing: 0.5px;
}

.damage-type-fire { background: rgba(220, 80, 20, 0.2); color: #e08040; border: 1px solid rgba(220, 80, 20, 0.3); }
.damage-type-cold { background: rgba(40, 120, 220, 0.2); color: #60a0e0; border: 1px solid rgba(40, 120, 220, 0.3); }
.damage-type-lightning { background: rgba(200, 180, 40, 0.2); color: #d0c040; border: 1px solid rgba(200, 180, 40, 0.3); }
.damage-type-acid { background: rgba(40, 180, 40, 0.2); color: #40c040; border: 1px solid rgba(40, 180, 40, 0.3); }
.damage-type-force { background: rgba(160, 80, 220, 0.2); color: #b080e0; border: 1px solid rgba(160, 80, 220, 0.3); }
.damage-type-radiant { background: rgba(220, 200, 40, 0.2); color: #e0d040; border: 1px solid rgba(220, 200, 40, 0.3); }
.damage-type-magical { background: rgba(140, 100, 200, 0.2); color: #a080d0; border: 1px solid rgba(140, 100, 200, 0.3); }

.damage-notes {
  font-size: 0.75rem;
  color: #999;
  margin-top: 0.3rem;
  line-height: 1.3;
  font-style: italic;
}

.damage-prompt {
  text-align: center;
  font-size: 0.85rem;
  color: #bbb;
  margin-bottom: 0.5rem;
}

.damage-prompt-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
}

/* Auto-roll results */
.damage-roll-result {
  text-align: center;
  margin-bottom: 0.6rem;
  padding: 0.5rem;
  border-radius: 5px;
  background: rgba(220, 80, 40, 0.08);
  border: 1px solid rgba(220, 80, 40, 0.2);
}

.damage-roll-header {
  font-size: 0.8rem;
  color: #aaa;
  margin-bottom: 0.2rem;
}

.damage-roll-breakdown {
  font-size: 0.78rem;
  color: #999;
  margin-bottom: 0.2rem;
}

.damage-roll-total {
  font-size: 1.3rem;
  font-weight: 700;
  color: #e08050;
}

.damage-location-result {
  text-align: center;
  margin-bottom: 0.5rem;
  padding: 0.4rem;
  border-radius: 5px;
  background: rgba(40, 120, 200, 0.06);
  border: 1px solid rgba(40, 120, 200, 0.15);
}

.damage-loc-header {
  font-size: 0.8rem;
  color: #70b0e0;
  margin-bottom: 0.2rem;
}

.damage-loc-name {
  font-size: 1rem;
  font-weight: 700;
  color: #ddd;
}

.damage-loc-list {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}

.damage-loc-item {
  font-size: 0.82rem;
  color: #ccc;
}

.damage-reminder-notes {
  font-size: 0.75rem;
  color: #999;
  margin-top: 0.4rem;
  padding: 0.3rem 0.5rem;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.03);
  line-height: 1.3;
}

/* Manual roll instructions */
.damage-manual-instructions {
  padding: 0.5rem;
}

.damage-manual-header {
  text-align: center;
  font-size: 0.9rem;
  color: #bbb;
  margin-bottom: 0.5rem;
}

.damage-manual-dice {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  justify-content: center;
  margin-bottom: 0.4rem;
}

.damage-manual-label {
  color: #aaa;
  font-size: 0.85rem;
}

.damage-manual-value {
  color: #e08050;
  font-weight: 700;
  font-size: 1.1rem;
}

.damage-manual-loc {
  text-align: center;
  font-size: 0.85rem;
  color: #ccc;
  margin-bottom: 0.4rem;
}

.damage-close-area {
  display: flex;
  justify-content: center;
  margin-top: 0.5rem;
}

/* ========================================
   IMPROVED AIM SECTION (RANGER)
   ======================================== */
.improved-aim-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #25352a 100%);
  border: 2px solid #4a8a4a;
  border-radius: 6px;
}

.improved-aim-section .section-header {
  color: #7dcc7d;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.improved-aim-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  align-items: center;
  text-align: center;
}

.improved-aim-label {
  color: #88aa88;
  font-size: 0.72rem;
  font-style: italic;
}

.btn-improved-aim {
  width: 100%;
  background: linear-gradient(135deg, #2a4a2a 0%, #3a6a3a 50%, #2a4a2a 100%);
  color: white;
  border: 1px solid #6b6;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(45, 90, 45, 0.4);
}

.btn-improved-aim:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a5a3a 0%, #4a7a4a 50%, #3a5a3a 100%);
  box-shadow: 0 4px 12px rgba(102, 187, 102, 0.5);
}

.improved-aim-active-btn {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a8a4a 50%, #3a6a3a 100%) !important;
  border-color: #7dcc7d !important;
  color: #aaffaa !important;
  box-shadow: 0 0 15px rgba(125, 204, 125, 0.4) !important;
  animation: aimPulse 2s ease-in-out infinite;
  width: 100%;
}

@keyframes aimPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(125, 204, 125, 0.3); }
  50% { box-shadow: 0 0 20px rgba(125, 204, 125, 0.6); }
}

/* Improved Aim animation */
.improved-aim-anim {
  background: radial-gradient(circle, rgba(125, 204, 125, 0.2) 0%, transparent 70%);
}

.improved-aim-anim .aim-reticle {
  font-size: 3rem;
  animation: aimZoom 1.5s ease-out forwards;
}

.improved-aim-anim .aim-text {
  color: #7dcc7d;
  font-size: 1.1rem;
  font-weight: bold;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  animation: fadeInUp 0.5s ease-out 0.3s both;
}

@keyframes aimZoom {
  0% { transform: scale(0.3); opacity: 0; }
  50% { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1); opacity: 0.8; }
}

@keyframes fadeInUp {
  from { transform: translateY(10px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Improved Aim boosted skill field */
.improved-aim-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

.improved-aim-row {
  background: rgba(0, 150, 0, 0.08) !important;
  border-radius: 4px;
}
.improved-aim-row .combat-skill-name {
  color: #1a6b1a !important;
}

/* ========================================
   SPECIES ENEMY SECTION
   ======================================== */
.species-enemy-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a1a1a 0%, #352a1a 100%);
  border: 2px solid #8a6a3a;
  border-radius: 6px;
}

.species-enemy-section .section-header {
  color: #d4a04a;
  text-shadow: 0 0 10px rgba(212, 160, 74, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.species-enemy-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  align-items: center;
  text-align: center;
}

.species-enemy-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.3rem;
  justify-content: center;
}

.se-enemy-tag {
  background: linear-gradient(135deg, #3a2a1a, #4a3a2a);
  color: #d4a04a;
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 600;
  border: 1px solid rgba(212, 160, 74, 0.3);
}

.btn-species-enemy {
  width: 100%;
  background: linear-gradient(135deg, #3a2a1a 0%, #5a4a2a 50%, #3a2a1a 100%);
  color: white;
  border: 1px solid #b88a4a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(138, 106, 58, 0.4);
}

.btn-species-enemy:hover:not(:disabled) {
  background: linear-gradient(135deg, #4a3a2a 0%, #6a5a3a 50%, #4a3a2a 100%);
  box-shadow: 0 4px 12px rgba(184, 138, 74, 0.5);
}

.se-active-btn {
  background: linear-gradient(135deg, #4a5a2a 0%, #5a6a3a 50%, #4a5a2a 100%) !important;
  border-color: #7dcc7d !important;
  color: #aaffaa !important;
  box-shadow: 0 0 15px rgba(125, 204, 125, 0.4) !important;
  animation: sePulse 2s ease-in-out infinite;
  width: 100%;
}

@keyframes sePulse {
  0%, 100% { box-shadow: 0 0 10px rgba(125, 204, 125, 0.3); }
  50% { box-shadow: 0 0 20px rgba(125, 204, 125, 0.6); }
}

/* Species Enemy animation */
.species-enemy-anim {
  background: radial-gradient(circle, rgba(125, 204, 125, 0.2) 0%, transparent 70%);
}

.species-enemy-anim .se-icon {
  font-size: 3rem;
  animation: aimZoom 1.5s ease-out forwards;
}

.species-enemy-anim .se-text {
  color: #7dcc7d;
  font-size: 1.2rem;
  font-weight: bold;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  animation: fadeInUp 0.5s ease-out 0.3s both;
}

/* Species Enemy boosted fields (matches rage-boosted pattern) */
.se-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ensure se-boosted wins over skill-input compound selectors */
input.skill-input.se-boosted,
input.prof-skill-current.se-boosted,
input.combat-skill-percent.se-boosted,
.derived-input.se-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Global green tint when Species Enemy active */
.species-enemy-active-mode .skill-row,
.species-enemy-active-mode .combat-skill-row {
  background: rgba(125, 204, 125, 0.04);
}

/* Lay on Hands Section */
.lay-on-hands-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a2a 0%, #1f3d3d 100%);
  border: 2px solid #5fa8a8;
  border-radius: 6px;
}

.lay-on-hands-section .section-header {
  color: #7dd4d4;
  text-shadow: 0 0 10px rgba(125, 212, 212, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.lay-on-hands-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.lay-on-hands-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.lay-on-hands-value {
  color: #7dd4d4;
  font-weight: bold;
  font-size: 1rem;
}

.lay-on-hands-label {
  color: #999;
}

.btn-reset-lay-on-hands {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-lay-on-hands:hover {
  background: #444;
  border-color: #7dd4d4;
  color: #7dd4d4;
}

.lay-on-hands-button-row {
  width: 100%;
}

.btn-lay-on-hands {
  width: 100%;
  background: linear-gradient(135deg, #1a3a3a 0%, #2a5050 50%, #1a3a3a 100%);
  color: white;
  border: 1px solid #5fa8a8;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(95, 168, 168, 0.4);
}

.btn-lay-on-hands:hover:not(:disabled) {
  background: linear-gradient(135deg, #2a4a4a 0%, #3a6060 50%, #2a4a4a 100%);
  box-shadow: 0 4px 12px rgba(125, 212, 212, 0.5);
}

.btn-lay-on-hands:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.mental-strength-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1a2a 0%, #20203d 100%);
  border: 2px solid #6a6a8b;
  border-radius: 6px;
}

.mental-strength-section .section-header {
  color: #99f;
  text-shadow: 0 0 10px rgba(153, 153, 255, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.mental-strength-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.mental-strength-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.mental-strength-value {
  color: #99f;
  font-weight: bold;
  font-size: 1rem;
}

.mental-strength-label {
  color: #999;
}

.btn-reset-mental-strength {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-mental-strength:hover {
  background: #444;
  border-color: #99f;
  color: #99f;
}

.mental-strength-button-row {
  width: 100%;
}

.btn-mental-strength {
  width: 100%;
  background: linear-gradient(135deg, #3a3a5a 0%, #4a4a6a 50%, #3a3a5a 100%);
  color: white;
  border: 1px solid #99f;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(90, 90, 140, 0.4);
}

.btn-mental-strength:hover:not(:disabled) {
  background: linear-gradient(135deg, #4a4a6a 0%, #5a5a7a 50%, #4a4a6a 100%);
  box-shadow: 0 4px 12px rgba(153, 153, 255, 0.5);
}

.btn-mental-strength:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.mental-strength-active {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.3rem;
  width: 100%;
  padding: 0.5rem;
  background: rgba(153, 153, 255, 0.1);
  border-radius: 4px;
  border: 1px solid #99f;
}

.mental-strength-active-label {
  color: #99f;
  font-weight: bold;
  font-size: 0.9rem;
  text-shadow: 0 0 8px rgba(153, 153, 255, 0.6);
  animation: mental-strength-pulse 2s infinite;
}

.mental-strength-effects {
  color: #aaf;
  font-size: 0.75rem;
  font-style: italic;
}

@keyframes mental-strength-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.btn-end-mental-strength {
  background: linear-gradient(135deg, #4a4a6a 0%, #5a5a7a 50%, #4a4a6a 100%);
  color: white;
  border: 1px solid #99f;
  padding: 0.3rem 1rem;
  font-size: 0.8rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-end-mental-strength:hover {
  background: linear-gradient(135deg, #5a5a7a 0%, #6a6a8a 50%, #5a5a7a 100%);
}

/* Mental Strength boosted skill indicator */
.mental-strength-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ========================================
   Turn Undead Section (Cleric)
   ======================================== */
.turn-undead-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a2510 0%, #3d3520 100%);
  border: 2px solid #d4a840;
  border-radius: 6px;
}

.turn-undead-section .section-header {
  color: #ffd700;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.turn-undead-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.turn-undead-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.turn-undead-value {
  color: #ffd700;
  font-weight: bold;
  font-size: 1rem;
}

.turn-undead-label {
  color: #999;
}

.btn-reset-turn-undead {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-turn-undead:hover {
  background: #444;
  border-color: #ffd700;
  color: #ffd700;
}

.turn-undead-button-row {
  width: 100%;
}

.btn-turn-undead {
  width: 100%;
  background: linear-gradient(135deg, #5a4a1a 0%, #7a6a2a 50%, #5a4a1a 100%);
  color: white;
  border: 1px solid #ffd700;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(212, 168, 64, 0.4);
}

.btn-turn-undead:hover:not(:disabled) {
  background: linear-gradient(135deg, #7a6a2a 0%, #9a8a3a 50%, #7a6a2a 100%);
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.5);
}

.btn-turn-undead:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.turn-undead-active {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.3rem;
  width: 100%;
  padding: 0.5rem;
  background: rgba(255, 215, 0, 0.1);
  border-radius: 4px;
  border: 1px solid #ffd700;
}

.turn-undead-active-label {
  color: #ffd700;
  font-weight: bold;
  font-size: 0.9rem;
  text-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
  animation: turn-undead-pulse 2s infinite;
}

.turn-undead-effects {
  color: #eec;
  font-size: 0.75rem;
  font-style: italic;
}

@keyframes turn-undead-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.btn-end-turn-undead {
  background: linear-gradient(135deg, #5a4a1a 0%, #7a6a2a 50%, #5a4a1a 100%);
  color: white;
  border: 1px solid #ffd700;
  padding: 0.3rem 1rem;
  font-size: 0.8rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-end-turn-undead:hover {
  background: linear-gradient(135deg, #7a6a2a 0%, #9a8a3a 50%, #7a6a2a 100%);
}

/* Turn Undead Animation Overlay */
.turn-undead-anim-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.turn-undead-anim-overlay.active {
  opacity: 1;
}

.turn-undead-anim-overlay.fade-out {
  opacity: 0;
}

.turn-undead-anim-content {
  position: relative;
  width: 300px;
  height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.holy-burst {
  position: absolute;
  width: 150px;
  height: 150px;
  background: radial-gradient(circle, #fff8dc 0%, #ffd700 30%, #ff8c00 60%, transparent 70%);
  border-radius: 50%;
  animation: holy-burst-pulse 0.8s ease-out infinite;
}

@keyframes holy-burst-pulse {
  0% { transform: scale(0.5); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.8; }
  100% { transform: scale(0.5); opacity: 1; }
}

.holy-rays {
  position: absolute;
  width: 200px;
  height: 200px;
  animation: holy-rays-rotate 3s linear infinite;
}

@keyframes holy-rays-rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.holy-rays .ray {
  position: absolute;
  width: 4px;
  height: 100px;
  background: linear-gradient(to top, transparent, #ffd700, #fff);
  left: 50%;
  top: 0;
  transform-origin: bottom center;
  opacity: 0.8;
}

.holy-rays .ray:nth-child(1) { transform: translateX(-50%) rotate(0deg); }
.holy-rays .ray:nth-child(2) { transform: translateX(-50%) rotate(45deg); }
.holy-rays .ray:nth-child(3) { transform: translateX(-50%) rotate(90deg); }
.holy-rays .ray:nth-child(4) { transform: translateX(-50%) rotate(135deg); }
.holy-rays .ray:nth-child(5) { transform: translateX(-50%) rotate(180deg); }
.holy-rays .ray:nth-child(6) { transform: translateX(-50%) rotate(225deg); }
.holy-rays .ray:nth-child(7) { transform: translateX(-50%) rotate(270deg); }
.holy-rays .ray:nth-child(8) { transform: translateX(-50%) rotate(315deg); }

.turn-undead-icon {
  font-size: 4rem;
  z-index: 1;
  animation: turn-undead-icon-pulse 0.5s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px #ffd700);
}

@keyframes turn-undead-icon-pulse {
  from { transform: scale(1); }
  to { transform: scale(1.15); }
}

.turn-undead-anim-text {
  margin-top: 1rem;
  color: #ffd700;
  font-size: 1.2rem;
  font-weight: bold;
  text-shadow: 0 0 10px #ffd700, 0 0 20px #ff8c00;
  z-index: 1;
}

/* Turn Undead Modal */
.turn-undead-modal-content {
  max-width: 550px;
  width: 95%;
}

.turn-undead-modal-header {
  background: linear-gradient(135deg, #5a4a1a 0%, #8b7a2a 100%);
  border-bottom: 2px solid #ffd700;
}

.turn-undead-modal-header h3 {
  color: #ffd700;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.turn-undead-modal-body {
  background: linear-gradient(to bottom, #fff8e7, #fff5d6);
}

.turn-undead-roll-section {
  margin-bottom: 1rem;
}

.turn-undead-roll-section h4 {
  color: #8b7a2a;
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
  border-bottom: 1px solid #ddd;
  padding-bottom: 0.25rem;
}

.turn-undead-instruction {
  font-size: 0.85rem;
  color: #666;
  margin: 0 0 0.75rem 0;
  font-style: italic;
}

.turn-undead-roll-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.turn-undead-roll-label {
  font-weight: bold;
  color: #5a4a1a;
  min-width: 100px;
}

.turn-undead-roll-formula,
.turn-undead-roll-skill {
  font-family: monospace;
  background: #fff;
  padding: 0.25rem 0.5rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-weight: bold;
}

.btn-roll-intensity,
.btn-roll-channel {
  background: linear-gradient(135deg, #5a4a1a 0%, #8b7a2a 100%);
  color: #fff;
  border: 1px solid #ffd700;
  padding: 0.4rem 0.75rem;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
}

.btn-roll-intensity:hover:not(:disabled),
.btn-roll-channel:hover:not(:disabled) {
  background: linear-gradient(135deg, #7a6a2a 0%, #ab9a3a 100%);
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.btn-roll-intensity:disabled,
.btn-roll-channel:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.turn-undead-roll-result {
  font-weight: bold;
  min-width: 120px;
}

.turn-undead-roll-result.rolling {
  color: #888;
  animation: result-pulse 0.3s ease infinite;
}

@keyframes result-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.turn-undead-roll-result.success {
  color: #2e7d32;
}

.turn-undead-roll-result.critical {
  color: #1565c0;
}

.turn-undead-roll-result.failure {
  color: #c62828;
}

.turn-undead-roll-result.fumble {
  color: #6a1b9a;
}

.result-critical {
  color: #1565c0;
  font-weight: bold;
}

.result-success {
  color: #2e7d32;
  font-weight: bold;
}

.result-failure {
  color: #c62828;
  font-weight: bold;
}

.result-fumble {
  color: #6a1b9a;
  font-weight: bold;
}

.turn-undead-intensity-display {
  margin-top: 0.75rem;
  padding: 0.5rem;
  background: linear-gradient(135deg, #fff8dc, #fff5b8);
  border: 2px solid #ffd700;
  border-radius: 4px;
  text-align: center;
  font-size: 1.0rem;
}

.turn-undead-intensity-display strong {
  color: #8b7a2a;
  font-size: 1.3rem;
}

.turn-undead-divider {
  border: none;
  border-top: 2px dashed #ccc;
  margin: 1rem 0;
}

.turn-undead-outcome {
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 6px;
  animation: outcome-appear 0.3s ease;
}

@keyframes outcome-appear {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.turn-undead-outcome h4 {
  margin: 0 0 0.5rem 0;
  color: #5a4a1a;
}

.outcome-critical {
  background: linear-gradient(135deg, #e3f2fd, #bbdefb);
  border: 2px solid #1565c0;
  padding: 1rem;
  border-radius: 6px;
}

.outcome-critical p:first-child {
  color: #1565c0;
  font-size: 1.0rem;
}

.outcome-success {
  background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
  border: 2px solid #2e7d32;
  padding: 1rem;
  border-radius: 6px;
}

.outcome-success p:first-child {
  color: #2e7d32;
  font-size: 1.0rem;
}

.outcome-failure {
  background: linear-gradient(135deg, #ffebee, #ffcdd2);
  border: 2px solid #c62828;
  padding: 1rem;
  border-radius: 6px;
}

.outcome-failure p:first-child {
  color: #c62828;
  font-size: 1.0rem;
}

.outcome-fumble {
  background: linear-gradient(135deg, #f3e5f5, #e1bee7);
  border: 2px solid #6a1b9a;
  padding: 1rem;
  border-radius: 6px;
}

.outcome-fumble p:first-child {
  color: #6a1b9a;
  font-size: 1.0rem;
}

.outcome-note {
  font-style: italic;
  color: #666;
  font-size: 0.9rem;
  margin-top: 0.5rem;
}

/* Greater Turning Reroll */
.turn-undead-reroll-row {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-top: 0.75rem;
  padding: 0.5rem;
  background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
  border: 1px solid #4caf50;
  border-radius: 4px;
}

.btn-reroll-channel {
  background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
  color: #fff;
  border: 1px solid #1b5e20;
  padding: 0.4rem 0.75rem;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
}

.btn-reroll-channel:hover {
  background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
  box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
}

.reroll-note {
  font-size: 0.85rem;
  color: #2e7d32;
  font-style: italic;
}

/* ============================================
   HOLY SMITE SECTION
   ============================================ */
.holy-smite-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1a2a 0%, #2d2045 100%);
  border: 2px solid #9a6fd4;
  border-radius: 6px;
}

.holy-smite-section .section-header {
  color: #c8a8f8;
  text-shadow: 0 0 10px rgba(200, 168, 248, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.holy-smite-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.holy-smite-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.holy-smite-value {
  color: #c8a8f8;
  font-weight: bold;
  font-size: 1rem;
}

.holy-smite-label {
  color: #999;
}

.holy-smite-bonus-row {
  display: flex;
  align-items: center;
  justify-content: center;
}

.holy-smite-bonus {
  color: #c8a8f8;
  font-weight: bold;
  font-size: 0.8rem;
}

.btn-reset-holy-smite {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-holy-smite:hover {
  background: #444;
  border-color: #c8a8f8;
  color: #c8a8f8;
}

.holy-smite-toggle {
  width: 100%;
}

.btn-holy-smite {
  width: 100%;
  background: linear-gradient(135deg, #4a2a7a 0%, #6a4a9a 50%, #4a2a7a 100%);
  color: white;
  border: 1px solid #9a6fd4;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(154, 111, 212, 0.4);
}

.btn-holy-smite:hover:not(:disabled) {
  background: linear-gradient(135deg, #5a3a8a 0%, #7a5aaa 50%, #5a3a8a 100%);
  box-shadow: 0 0 15px rgba(154, 111, 212, 0.6);
}

.btn-holy-smite:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-holy-smite.active {
  background: linear-gradient(135deg, #2a6a2a 0%, #3a8a3a 50%, #2a6a2a 100%);
  border-color: #4a4;
  box-shadow: 0 0 15px rgba(74, 170, 74, 0.6);
  animation: holy-smite-pulse 2s infinite;
}

@keyframes holy-smite-pulse {
  0%, 100% { box-shadow: 0 0 15px rgba(74, 170, 74, 0.6); }
  50% { box-shadow: 0 0 25px rgba(74, 170, 74, 0.8); }
}

/* ============================================
   POWERFUL CONCENTRATION SECTION
   ============================================ */
.powerful-concentration-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a2a 0%, #203540 100%);
  border: 2px solid #4a9aaa;
  border-radius: 6px;
}

.powerful-concentration-section .section-header {
  color: #8ad4e8;
  text-shadow: 0 0 10px rgba(138, 212, 232, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.powerful-concentration-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.powerful-concentration-description {
  font-size: 0.75rem;
  color: #aaa;
  line-height: 1.4;
}

.powerful-concentration-description strong {
  color: #8ad4e8;
}

.powerful-concentration-toggle {
  width: 100%;
}

.btn-powerful-concentration {
  width: 100%;
  background: linear-gradient(135deg, #2a5a6a 0%, #3a7a8a 50%, #2a5a6a 100%);
  color: white;
  border: 1px solid #4a9aaa;
  padding: 0.4rem 0.5rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(74, 154, 170, 0.4);
}

.btn-powerful-concentration:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a6a7a 0%, #4a8a9a 50%, #3a6a7a 100%);
  box-shadow: 0 0 15px rgba(74, 154, 170, 0.6);
}

.btn-powerful-concentration:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-powerful-concentration.active {
  background: linear-gradient(135deg, #2a6a2a 0%, #3a8a3a 50%, #2a6a2a 100%);
  border-color: #4a4;
  box-shadow: 0 0 15px rgba(74, 170, 74, 0.6);
  animation: powerful-concentration-pulse 2s infinite;
}

@keyframes powerful-concentration-pulse {
  0%, 100% { box-shadow: 0 0 15px rgba(74, 170, 74, 0.6); }
  50% { box-shadow: 0 0 25px rgba(74, 170, 74, 0.8); }
}

/* Powerful Concentration bonus styling for Willpower */
.powerful-concentration-bonus {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ensure powerful-concentration-bonus wins over skill-input */
input.skill-input.powerful-concentration-bonus,
#willpower-current.powerful-concentration-bonus {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ============================================
   ANIMAL COMPANION SECTION
   ============================================ */
.animal-companion-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #2d3a2d 100%);
  border: 2px solid #5a8a5a;
  border-radius: 6px;
}

.animal-companion-section .section-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.animal-companion-section .section-header {
  color: #8fbc8f;
  text-shadow: 0 0 10px rgba(143, 188, 143, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.btn-add-companion {
  background: linear-gradient(135deg, #3a5a3a 0%, #4a7a4a 100%);
  border: 1px solid #5a8a5a;
  color: #fff;
  padding: 0.2rem 0.5rem;
  font-size: 0.8rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-add-companion:hover {
  background: linear-gradient(135deg, #4a6a4a 0%, #5a9a5a 100%);
  box-shadow: 0 0 8px rgba(90, 138, 90, 0.5);
}

.animal-companion-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.companion-tier-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.25rem 0.5rem;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 4px;
  font-size: 0.75rem;
}

.companion-tier-label {
  color: #8fbc8f;
  font-weight: bold;
}

.companion-siz-limit {
  color: #aaa;
}

.companion-list {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  max-height: 150px;
  overflow-y: auto;
}

.companion-list .no-companions {
  color: #666;
  font-size: 0.75rem;
  font-style: italic;
  text-align: center;
  margin: 0.5rem 0;
}

.companion-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.3rem 0.5rem;
  background: rgba(143, 188, 143, 0.1);
  border: 1px solid rgba(143, 188, 143, 0.3);
  border-radius: 4px;
  font-size: 0.8rem;
}

.companion-name {
  color: #ccc;
  font-weight: 500;
}

.companion-siz {
  color: #8fbc8f;
  font-size: 0.7rem;
}

.btn-remove-companion {
  background: transparent;
  border: none;
  color: #a66;
  cursor: pointer;
  font-size: 0.8rem;
  padding: 0 0.25rem;
  opacity: 0.6;
  transition: opacity 0.2s ease;
}

.btn-remove-companion:hover {
  opacity: 1;
  color: #c66;
}

/* ============================================
   ANIMAL COMPANION MODAL
   ============================================ */
.animal-companion-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.animal-companion-modal.hidden {
  display: none;
}

.animal-companion-modal-content {
  background: linear-gradient(135deg, #1a2a1a 0%, #2d3d2d 100%);
  border: 2px solid #5a8a5a;
  border-radius: 10px;
  padding: 1.5rem;
  max-width: 550px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.animal-companion-modal-content h3 {
  color: #8fbc8f;
  text-align: center;
  margin: 0 0 1rem 0;
  font-size: 1.3rem;
  text-shadow: 0 0 10px rgba(143, 188, 143, 0.5);
}

.companion-modal-description {
  color: #aaa;
  font-size: 0.85rem;
  line-height: 1.5;
  margin-bottom: 1rem;
  text-align: center;
}

.companion-modal-description strong {
  color: #8fbc8f;
}

.companion-siz-info {
  background: rgba(0, 0, 0, 0.3);
  padding: 0.75rem;
  border-radius: 6px;
  margin-bottom: 1rem;
  text-align: center;
}

.companion-siz-info .siz-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: #8fbc8f;
}

.companion-siz-info .siz-label {
  font-size: 0.8rem;
  color: #888;
  display: block;
  margin-top: 0.25rem;
}

.companion-input-section {
  margin-bottom: 1rem;
}

.companion-input-section label {
  display: block;
  color: #aaa;
  font-size: 0.85rem;
  margin-bottom: 0.4rem;
}

.companion-input-row {
  display: flex;
  gap: 0.5rem;
}

.companion-input-row input,
.animal-companion-modal-content .companion-input-row input,
#companion-name-input {
  flex: 1;
  padding: 0.5rem;
  border: 1px solid #5a8a5a;
  border-radius: 5px;
  background: #1a2a1a !important;
  color: #ddd !important;
  font-size: 0.9rem;
}

.companion-input-row input:focus,
#companion-name-input:focus {
  outline: none;
  border-color: #7aaa7a;
  box-shadow: 0 0 5px rgba(122, 170, 122, 0.4);
}

.companion-input-row input::placeholder,
#companion-name-input::placeholder {
  color: #666 !important;
}

.btn-add-animal {
  background: linear-gradient(135deg, #2a5a2a 0%, #3a7a3a 100%);
  border: 1px solid #4a8a4a;
  color: #fff;
  padding: 0.5rem 1rem;
  font-size: 0.85rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-add-animal:hover {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a9a4a 100%);
  box-shadow: 0 0 10px rgba(74, 138, 74, 0.4);
}

.companion-examples-section {
  margin-bottom: 1rem;
}

.companion-examples-label {
  color: #888;
  font-size: 0.8rem;
  margin-bottom: 0.5rem;
  display: block;
}

.companion-examples-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.25rem;
  max-height: 200px;
  overflow-y: auto;
  padding: 0.5rem;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}

.companion-example {
  font-size: 0.75rem;
  color: #aaa;
  padding: 0.2rem 0.4rem;
  background: rgba(143, 188, 143, 0.1);
  border-radius: 3px;
}

.companion-example .example-siz {
  color: #8fbc8f;
  font-weight: bold;
}

.companion-modal-footer {
  display: flex;
  justify-content: center;
  padding-top: 0.5rem;
}

.companion-modal-footer .btn-cancel {
  background: linear-gradient(135deg, #4a4a4a 0%, #5a5a5a 100%);
  border: 1px solid #666;
  color: #ccc;
  padding: 0.5rem 1.5rem;
  font-size: 0.85rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.companion-modal-footer .btn-cancel:hover {
  background: linear-gradient(135deg, #5a5a5a 0%, #6a6a6a 100%);
  border-color: #888;
}

/* ============================================
   SHAPE CHANGE SECTION (Druid)
   ============================================ */
.shape-change-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #2a3d2a 100%);
  border: 2px solid #4a8b4a;
  border-radius: 6px;
}

.shape-change-section .section-header-row {
  margin-bottom: 0.3rem;
}

.shape-change-section .section-header {
  color: #8bc68b;
  text-shadow: 0 0 10px rgba(100, 180, 100, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.shape-change-content {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

.shape-change-info-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.shape-change-value {
  color: #8bc68b;
  font-weight: bold;
  font-size: 1.2rem;
}

.shape-change-label {
  color: #a0c0a0;
  font-size: 0.85rem;
}

.btn-reset-shape-change {
  padding: 0.15rem 0.4rem;
  font-size: 0.8rem;
  background: #2a3d2a;
  border: 1px solid #4a8b4a;
  color: #8bc68b;
  cursor: pointer;
  border-radius: 4px;
}

.btn-reset-shape-change:hover {
  background: #3a4d3a;
}

.shape-change-tier-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  font-size: 0.8rem;
}

.shape-change-tier {
  color: #c0e0c0;
  font-weight: 600;
}

.shape-change-duration {
  color: #90b090;
  font-style: italic;
}

.shape-change-button-row {
  margin-top: 0.2rem;
}

.btn-shape-change {
  width: 100%;
  padding: 0.5rem;
  font-size: 0.9rem;
  font-weight: 600;
  background: linear-gradient(135deg, #2d5a2d 0%, #3d7a3d 100%);
  border: 2px solid #5a9a5a;
  color: #d4f0d4;
  cursor: pointer;
  border-radius: 6px;
  text-shadow: 0 1px 2px rgba(0,0,0,0.4);
  transition: all 0.2s ease;
}

.btn-shape-change:hover:not(:disabled) {
  background: linear-gradient(135deg, #3d7a3d 0%, #4d9a4d 100%);
  border-color: #7aba7a;
  box-shadow: 0 0 12px rgba(100, 180, 100, 0.4);
}

.btn-shape-change:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Shape Change Modal */
.shape-change-modal-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.shape-change-modal {
  background: linear-gradient(135deg, #1a2a1a 0%, #2a3d20 100%);
  border: 2px solid #5a9a5a;
  border-radius: 10px;
  max-width: 550px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 0 40px rgba(80, 160, 80, 0.3);
}

.shape-change-modal-header {
  padding: 1rem 1.2rem 0.5rem;
  border-bottom: 1px solid #4a8b4a;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.shape-change-modal-header h3 {
  color: #c0e8c0;
  margin: 0;
  font-size: 1.1rem;
}

.shape-change-modal-siz {
  color: #90c090;
  font-size: 0.85rem;
  font-style: italic;
}

.shape-change-modal-body {
  padding: 1rem 1.2rem;
  color: #b0d0b0;
  font-size: 0.9rem;
  line-height: 1.6;
}

.shape-change-modal-body p {
  margin: 0 0 0.8rem 0;
}

.shape-change-modal-body p:last-child {
  margin-bottom: 0;
}

.shape-change-modal-footer {
  padding: 0.8rem 1.2rem;
  border-top: 1px solid #4a8b4a;
  display: flex;
  gap: 0.8rem;
  justify-content: center;
}

.btn-shape-change-transform {
  padding: 0.6rem 1.5rem;
  font-size: 1rem;
  font-weight: 700;
  background: linear-gradient(135deg, #2d5a2d 0%, #3d7a3d 100%);
  border: 2px solid #6ab06a;
  color: #e0ffe0;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s ease;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

.btn-shape-change-transform:hover {
  background: linear-gradient(135deg, #3d7a3d 0%, #4d9a4d 100%);
  box-shadow: 0 0 20px rgba(100, 200, 100, 0.5);
  transform: scale(1.03);
}

.btn-shape-change-cancel {
  padding: 0.5rem 1.2rem;
  font-size: 0.9rem;
  background: #333;
  border: 1px solid #555;
  color: #aaa;
  cursor: pointer;
  border-radius: 6px;
}

.btn-shape-change-cancel:hover {
  background: #444;
  color: #ccc;
}

/* Shape Change Animation Overlay */
.shape-change-anim-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(10, 30, 10, 0.85);
  z-index: 10001;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.4s ease;
  cursor: pointer;
}

.shape-change-anim-overlay.active {
  opacity: 1;
}

.shape-change-anim-overlay.fade-out {
  opacity: 0;
}

.shape-change-anim-content {
  position: relative;
  width: 300px;
  height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.shape-change-anim-burst {
  position: absolute;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(100, 200, 100, 0.6) 0%, rgba(50, 120, 50, 0.2) 60%, transparent 80%);
  animation: shapeChangePulse 1.5s ease-in-out infinite;
}

.shape-change-anim-animals {
  position: absolute;
  width: 100%;
  height: 100%;
}

.shape-change-anim-emoji {
  position: absolute;
  top: 50%;
  left: 50%;
  font-size: 2rem;
  opacity: 0;
  animation: shapeChangeOrbit 2.5s ease-out forwards;
  animation-delay: var(--delay);
  transform-origin: center center;
}

.shape-change-anim-text {
  position: absolute;
  bottom: -60px;
  text-align: center;
  color: #c0e8c0;
  font-size: 1.1rem;
  font-style: italic;
  text-shadow: 0 0 15px rgba(100, 200, 100, 0.6);
  opacity: 0;
  animation: shapeChangeTextFade 2s ease-out 0.5s forwards;
  width: 400px;
}

@keyframes shapeChangePulse {
  0%, 100% { transform: scale(0.9); opacity: 0.5; }
  50% { transform: scale(1.2); opacity: 0.9; }
}

@keyframes shapeChangeOrbit {
  0% {
    transform: translate(-50%, -50%) rotate(var(--angle)) translateY(0px) scale(0);
    opacity: 0;
  }
  30% {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(var(--angle)) translateY(-100px) scale(1.2);
  }
  70% {
    opacity: 0.8;
    transform: translate(-50%, -50%) rotate(calc(var(--angle) + 180deg)) translateY(-120px) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(calc(var(--angle) + 360deg)) translateY(-80px) scale(0.5);
  }
}

@keyframes shapeChangeTextFade {
  0% { opacity: 0; transform: translateY(10px); }
  30% { opacity: 1; transform: translateY(0); }
  85% { opacity: 1; }
  100% { opacity: 0.8; }
}

/* ============================================
   BRUTE STRENGTH SECTION
   ============================================ */
.brute-strength-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a1a1a 0%, #3d2020 100%);
  border: 2px solid #8b4a4a;
  border-radius: 6px;
}

.brute-strength-section .section-header {
  color: #b66;
  text-shadow: 0 0 10px rgba(187, 102, 102, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.brute-strength-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  align-items: center;
}

.brute-strength-info {
  color: #aaa;
  font-size: 0.7rem;
  text-align: center;
}

.brute-label {
  color: #d99;
}

.brute-strength-toggle {
  width: 100%;
}

.btn-brute {
  background: linear-gradient(135deg, #5a2d2d 0%, #7a3d3d 50%, #5a2d2d 100%);
  color: white;
  border: 1px solid #b66;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(90, 45, 45, 0.4);
  width: 100%;
}

.btn-brute:hover {
  background: linear-gradient(135deg, #6a3d3d 0%, #8a4d4d 50%, #6a3d3d 100%);
  box-shadow: 0 4px 12px rgba(187, 102, 102, 0.5);
}

.btn-brute.active {
  background: linear-gradient(135deg, #9a4a4a 0%, #ba5a5a 50%, #9a4a4a 100%);
  animation: brute-pulse 1.5s infinite;
  border-color: #d88;
}

@keyframes brute-pulse {
  0%, 100% { box-shadow: 0 0 8px rgba(187, 102, 102, 0.5); }
  50% { box-shadow: 0 0 15px rgba(187, 102, 102, 0.8), 0 0 30px rgba(186, 90, 90, 0.4); }
}

.brute-icon {
  font-size: 1rem;
}

/* Brute Strength boosted indicator */
.brute-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ============================================
   JUST A SCRATCH SECTION
   ============================================ */
.just-a-scratch-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a2a 0%, #204040 100%);
  border: 2px solid #4a8b8b;
  border-radius: 6px;
}

.just-a-scratch-section .section-header {
  color: #6bb;
  text-shadow: 0 0 10px rgba(102, 187, 187, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.just-a-scratch-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  align-items: center;
}

.scratch-info-row {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  flex-wrap: wrap;
  justify-content: center;
}

.scratch-label {
  color: #9cc;
  font-size: 0.75rem;
}

.scratch-value {
  color: #6ff;
  font-weight: bold;
  font-size: 0.9rem;
}

.scratch-button-row {
  width: 100%;
}

.btn-scratch {
  background: linear-gradient(135deg, #2d4a4a 0%, #3d6a6a 50%, #2d4a4a 100%);
  color: white;
  border: 1px solid #6bb;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.3rem;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(45, 74, 74, 0.4);
  width: 100%;
}

.btn-scratch:hover:not(:disabled) {
  background: linear-gradient(135deg, #3d5a5a 0%, #4d7a7a 50%, #3d5a5a 100%);
  box-shadow: 0 4px 12px rgba(102, 187, 187, 0.5);
}

.btn-scratch:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.scratch-icon {
  font-size: 1rem;
}

.btn-reset-scratch {
  background: #2d4a4a;
  color: #6bb;
  border: 1px solid #4a8b8b;
  padding: 0.15rem 0.3rem;
  font-size: 0.75rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-scratch:hover {
  background: #3d5a5a;
}

/* Just a Scratch Modal Styles */
.scratch-modal-content {
  max-width: 500px;
  min-height: auto;
}

.scratch-description {
  font-size: 1rem;
  line-height: 1.5;
  margin-bottom: 1rem;
}

.scratch-note {
  color: #c66;
  font-style: italic;
  font-size: 0.9rem;
  margin-bottom: 1rem;
}

.scratch-action {
  text-align: center;
  margin: 1rem 0;
}

/* Just a Scratch Location Modal */
.scratch-location-modal-content {
  max-width: 450px;
}

.scratch-locations-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin: 1rem 0;
}

.scratch-location-option {
  width: 100%;
}

.btn-location {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  background: linear-gradient(135deg, #2a3a3a 0%, #3a4a4a 100%);
  border: 1px solid #5a8a8a;
  border-radius: 6px;
  color: #fff;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-location:hover {
  background: linear-gradient(135deg, #3a4a4a 0%, #4a5a5a 100%);
  border-color: #6bb;
  transform: translateX(5px);
}

.btn-location .loc-name {
  font-weight: bold;
  color: #9cc;
}

.btn-location .loc-hp {
  color: #f88;
}

.btn-location .loc-heal {
  color: #8f8;
}

/* ============================================
   SPELL-LIKE ABILITIES SECTION
   ============================================ */
.spell-like-section {
  padding: 0.5rem 0.75rem;
  background: linear-gradient(135deg, #1a1a2a 0%, #2d203d 100%);
  border: 2px solid #8b4a8b;
  border-radius: 6px;
}

.spell-like-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.spell-like-section .section-header {
  color: #b6b;
  text-shadow: 0 0 10px rgba(187, 102, 187, 0.5);
  margin-bottom: 0;
  font-size: 0.9rem;
}

.btn-collapse-toggle {
  background: transparent;
  border: 1px solid #8b4a8b;
  color: #b6b;
  width: 24px;
  height: 24px;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.btn-collapse-toggle:hover {
  background: rgba(139, 74, 139, 0.3);
  border-color: #a86aa8;
}

.btn-collapse-toggle .collapse-icon {
  transition: transform 0.3s ease;
  font-size: 0.75rem;
}

.btn-collapse-toggle.collapsed .collapse-icon {
  transform: rotate(-90deg);
}

.spell-like-content.collapsible {
  overflow: hidden;
  transition: max-height 0.3s ease, opacity 0.3s ease;
  max-height: 1000px;
  opacity: 1;
}

.spell-like-content.collapsible:not(.collapsed) {
  margin-top: 0.5rem;
}

.spell-like-content.collapsible.collapsed {
  max-height: 0;
  opacity: 0;
  padding: 0;
  margin: 0;
}

.spell-like-description {
  color: #ddd;
  font-size: 0.85rem;
  line-height: 1.4;
}

.spell-like-description .spell-name {
  color: #d8a8d8;
  font-weight: bold;
  font-size: 1rem;
  margin-bottom: 0.4rem;
  display: block;
}

.spell-like-description .spell-resist {
  color: #a8a;
  font-style: italic;
  margin-bottom: 0.4rem;
  display: block;
}

.spell-like-description p {
  margin: 0.4rem 0;
}

.spell-like-description ul {
  margin: 0.4rem 0 0.4rem 1.5rem;
  padding: 0;
}

.spell-like-description li {
  margin: 0.2rem 0;
}

.spell-like-description table {
  margin: 0.5rem 0;
  border-collapse: collapse;
  width: auto;
}

.spell-like-description th,
.spell-like-description td {
  border: 1px solid #666;
  padding: 0.25rem 0.5rem;
  text-align: left;
}

.spell-like-description th {
  background: rgba(100, 50, 100, 0.3);
  color: #d8a8d8;
}

/* ============================================
   WEAPON SPECIALIZATION SECTION
   ============================================ */
.weapon-spec-section {
  margin-top: 0.25rem;
  padding: 0.5rem;
  border-radius: 6px;
}

.weapon-spec-header {
  cursor: pointer;
}

.weapon-spec-section .section-header {
  font-size: 0.85rem;
  margin: 0;
  color: var(--accent-color, #c9a55a);
}

.weapon-spec-content.collapsible {
  overflow: hidden;
  transition: max-height 0.3s ease, opacity 0.3s ease;
}

.weapon-spec-content.collapsible:not(.collapsed) {
  max-height: 2000px;
  opacity: 1;
}

.weapon-spec-content.collapsible.collapsed {
  max-height: 0;
  opacity: 0;
  padding: 0;
}

.weapon-spec-cards {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.weapon-spec-card {
  background: linear-gradient(135deg, rgba(40, 40, 60, 0.6) 0%, rgba(50, 40, 30, 0.6) 100%);
  border: 1px solid rgba(201, 165, 90, 0.3);
  border-radius: 6px;
  padding: 0.6rem 0.75rem;
}

.weapon-spec-card-header {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.35rem;
}

.weapon-spec-card-icon {
  font-size: 1rem;
}

.weapon-spec-card-title {
  font-weight: bold;
  color: var(--accent-color, #c9a55a);
  font-size: 0.85rem;
}

.weapon-spec-card-type {
  font-size: 0.7rem;
  color: #999;
  flex-shrink: 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.weapon-spec-card-benefits {
  font-size: 0.78rem;
  color: #ccc;
  line-height: 1.45;
}

.weapon-spec-card-benefits p {
  margin: 0.25rem 0;
}

.weapon-spec-card-benefits strong {
  color: var(--accent-color, #c9a55a);
}

.weapon-spec-card-benefits .benefit-item {
  margin: 0.3rem 0;
  padding-left: 0.6rem;
  border-left: 2px solid rgba(201, 165, 90, 0.25);
}

/* Combat page weapon highlighting for specializations */
.weapon-specialized {
  background: rgba(201, 165, 90, 0.12) !important;
  border-color: rgba(201, 165, 90, 0.4) !important;
  box-shadow: inset 0 0 6px rgba(201, 165, 90, 0.15);
}

.weapon-specialized-indicator {
  position: absolute;
  top: -2px;
  right: 2px;
  font-size: 0.6rem;
  color: var(--accent-color, #c9a55a);
  pointer-events: none;
  z-index: 1;
}

/* ============================================
   WEAPON MASTER SYSTEM
   ============================================ */

/* Unified weapon spec activation button */
.weapon-spec-activate-btn {
  font-family: inherit;
  white-space: nowrap;
  transition: all 0.3s ease;
}

.weapon-spec-activate-btn:hover {
  transform: scale(1.05);
  filter: brightness(1.2);
}

.weapon-spec-activate-btn.ws-active {
  animation: wmPulse 2s ease-in-out infinite;
}

/* Weapon spec card buttons container */
.weapon-spec-card-buttons {
  display: flex;
  gap: 0.3rem;
  align-items: center;
  margin-left: auto;
  margin-right: 0.4rem;
}

/* Combat skill row when weapon spec active */
.combat-skill-row.weapon-spec-active-row {
  background: rgba(0, 150, 0, 0.08) !important;
  border-radius: 4px;
  position: relative;
}

.combat-skill-row.weapon-spec-active-row::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border: 1px solid rgba(42, 122, 42, 0.4);
  border-radius: 4px;
  pointer-events: none;
}

/* Ensure damage-boosted wins on combat skill percent input */
.combat-skill-percent.damage-boosted,
input.combat-skill-percent.damage-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Ranged weapon load reduced indicator */
.spec-load-reduced {
  color: #6c6 !important;
  font-weight: bold;
}

/* Mastered weapon card highlight */
.weapon-spec-card.weapon-mastered {
  transition: all 0.3s ease;
}

/* Weapon master benefit line in spec card */
.wm-benefit {
  font-style: italic;
}

/* Monk Abilities - compact grid layout like ability-cards-grid */
#monk-abilities-cards {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.4rem;
  margin-top: 0.3rem;
}

#monk-abilities-cards .weapon-spec-card {
  padding: 0.4rem 0.55rem;
  margin: 0;
}

#monk-abilities-cards .weapon-spec-card-header {
  margin-bottom: 0.2rem;
}

#monk-abilities-cards .weapon-spec-card-title {
  font-size: 0.8rem;
}

#monk-abilities-cards .weapon-spec-card-icon {
  font-size: 0.85rem;
}

#monk-abilities-cards .benefit-item {
  font-size: 0.72rem;
  margin: 0.15rem 0;
  padding-left: 0.4rem;
}

#monk-abilities-section .section-header {
  font-size: 0.85rem;
}

#monk-abilities-cards .monk-status-card {
  grid-column: 1 / -1;
}

/* ---- Animations ---- */

@keyframes wmPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes wmFlash {
  0% { opacity: 0; }
  15% { opacity: 0.8; }
  100% { opacity: 0; }
}

@keyframes wmTextReveal {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
  20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
  35% { transform: translate(-50%, -50%) scale(1); }
  75% { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1) translateY(-20px); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

/* ============================================
   SYRIN SPECIES ABILITIES SECTION
   ============================================ */
.syrin-abilities-row {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.syrin-ability-section {
  flex: 1;
  min-width: 140px;
  padding: 0.5rem;
  border-radius: 6px;
}

.diving-strike-section {
  background: linear-gradient(135deg, #1a2a3a 0%, #2d3a4d 100%);
  border: 2px solid #6a9fd4;
}

.diving-strike-section .section-header {
  color: #8ec8f8;
  text-shadow: 0 0 10px rgba(142, 200, 248, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.radiant-burst-section {
  background: linear-gradient(135deg, #2a2510 0%, #3d3520 100%);
  border: 2px solid #d4a840;
}

.radiant-burst-section .section-header {
  color: #ffd700;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.syrin-ability-content {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  align-items: center;
}

.syrin-ability-info-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  color: #aaa;
  font-size: 0.75rem;
}

.syrin-ability-value {
  color: #8ec8f8;
  font-weight: bold;
  font-size: 1rem;
}

.syrin-ability-label {
  color: #999;
}

.syrin-ability-cost {
  color: #ffd700;
  font-weight: bold;
  font-size: 0.8rem;
}

.btn-reset-syrin {
  background: transparent;
  border: 1px solid #666;
  color: #999;
  padding: 0.1rem 0.3rem;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 3px;
}

.btn-reset-syrin:hover {
  background: #444;
  border-color: #8ec8f8;
  color: #8ec8f8;
}

.syrin-ability-button-row {
  width: 100%;
}

.btn-syrin-ability {
  width: 100%;
  padding: 0.4rem 0.5rem;
  font-size: 0.8rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.btn-diving-strike {
  background: linear-gradient(135deg, #2a4a6a 0%, #4a6a8a 50%, #2a4a6a 100%);
  color: white;
  border: 1px solid #6a9fd4;
  box-shadow: 0 2px 8px rgba(106, 159, 212, 0.4);
}

.btn-diving-strike:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a5a7a 0%, #5a7a9a 50%, #3a5a7a 100%);
  box-shadow: 0 0 15px rgba(106, 159, 212, 0.6);
}

.btn-diving-strike:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-radiant-burst {
  background: linear-gradient(135deg, #5a4a1a 0%, #7a6a2a 50%, #5a4a1a 100%);
  color: white;
  border: 1px solid #ffd700;
  box-shadow: 0 2px 8px rgba(212, 168, 64, 0.4);
}

.btn-radiant-burst:hover:not(:disabled) {
  background: linear-gradient(135deg, #7a6a2a 0%, #9a8a3a 50%, #7a6a2a 100%);
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
}

.btn-radiant-burst:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.syrin-ability-active {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.3rem;
  width: 100%;
}

.syrin-active-label {
  color: #8ec8f8;
  font-weight: bold;
  font-size: 0.8rem;
  animation: syrin-pulse 2s infinite;
}

@keyframes syrin-pulse {
  0%, 100% { opacity: 1; text-shadow: 0 0 10px rgba(142, 200, 248, 0.5); }
  50% { opacity: 0.7; text-shadow: 0 0 5px rgba(142, 200, 248, 0.3); }
}

.btn-end-syrin {
  background: linear-gradient(135deg, #4a4a4a 0%, #6a6a6a 100%);
  color: #fff;
  border: 1px solid #888;
  padding: 0.25rem 0.6rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.75rem;
  transition: all 0.2s ease;
}

.btn-end-syrin:hover {
  background: linear-gradient(135deg, #5a5a5a 0%, #7a7a7a 100%);
}

/* Radiant Burst Modal */
.radiant-burst-modal-content {
  max-width: 500px;
  width: 95%;
}

.radiant-burst-modal-header {
  background: linear-gradient(135deg, #5a4a2a 0%, #8a7a4a 100%);
  border-bottom: 2px solid #ffd700;
}

.radiant-burst-modal-header h3 {
  color: #ffd700;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.radiant-burst-modal-body {
  background: linear-gradient(to bottom, #fff8e7, #fff5d6);
}

.radiant-burst-effect {
  margin-bottom: 1rem;
  padding: 0.75rem;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.radiant-burst-effect-title {
  font-weight: bold;
  color: #5a4a2a;
  margin-bottom: 0.5rem;
}

.radiant-burst-effect-text {
  color: #333;
  line-height: 1.5;
  margin-bottom: 0.5rem;
}

.radiant-burst-roll-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 0.5rem;
  flex-wrap: wrap;
}

.radiant-burst-stat {
  font-weight: bold;
  color: #8a7a4a;
  background: linear-gradient(135deg, #fff8dc, #fff5b8);
  padding: 0.25rem 0.5rem;
  border: 1px solid #daa520;
  border-radius: 4px;
}

.btn-roll-radiant {
  background: linear-gradient(135deg, #5a4a2a 0%, #8a7a4a 100%);
  color: #fff;
  border: 1px solid #ffd700;
  padding: 0.3rem 0.6rem;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  font-size: 0.85rem;
  transition: all 0.2s ease;
}

.btn-roll-radiant:hover:not(:disabled) {
  background: linear-gradient(135deg, #6a5a3a 0%, #9a8a5a 100%);
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.btn-roll-radiant:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.radiant-burst-roll-result {
  font-weight: bold;
  color: #5a4a2a;
}

.radiant-damage-section {
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px dashed #ccc;
}

/* Scrollable containers */
.scrollable-skills-container {
  max-height: 400px;
  overflow-y: auto;
  padding-right: 4px;
}

.resizable-container {
  resize: vertical;
  min-height: 200px;
  max-height: 600px;
}

.scrollable-skills-container::-webkit-scrollbar {
  width: 6px;
}

.scrollable-skills-container::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.05);
  border-radius: 3px;
}

.scrollable-skills-container::-webkit-scrollbar-thumb {
  background: rgba(139, 115, 85, 0.4);
  border-radius: 3px;
}

.scrollable-skills-container::-webkit-scrollbar-thumb:hover {
  background: rgba(139, 115, 85, 0.6);
}

.header-base,
.header-current {
  text-align: center;
}

/* Skill Rows */
.skill-row {
  display: grid;
  grid-template-columns: 42px 1fr 70px 55px 60px 24px 15px;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0;
  font-size: 1.0rem;
  border-bottom: 1px solid var(--border-light);
}

.skill-row .d100-btn {
  padding: 0;
  margin: 0;
}

.skill-row .d10-icon {
  width: 16px;
  height: 16px;
}

.skill-row:last-child {
  border-bottom: none;
}

.prereq-keys {
  display: flex;
  gap: 1px;
  justify-content: flex-end;
  align-items: center;
}

.prereq-keys .prereq-key {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
  cursor: pointer;
}

/* Key Popup */
.key-popup {
  position: fixed;
  z-index: 10000;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.25);
  min-width: 220px;
  max-width: 300px;
  animation: keyPopupFadeIn 0.15s ease;
}

@keyframes keyPopupFadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

.key-popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  color: #fff;
  font-weight: 600;
  font-size: 0.95rem;
  border-radius: 8px 8px 0 0;
}

.key-popup-close {
  background: none;
  border: none;
  color: #fff;
  font-size: 1.4rem;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  opacity: 0.8;
}

.key-popup-close:hover {
  opacity: 1;
}

.key-popup-content {
  padding: 14px;
}

.key-popup-label {
  font-size: 0.85rem;
  color: #666;
  margin: 0 0 6px 0;
  font-weight: 500;
}

.key-popup-details {
  font-size: 0.95rem;
  color: #333;
  margin: 0;
  line-height: 1.4;
}

.skill-name {
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.skill-formula {
  font-size: 0.85rem;
  color: var(--text-secondary);
  text-align: right;
}

.skill-base {
  text-align: center;
  font-weight: 600;
  background: rgba(255,255,255,0.5);
  padding: 0.3rem;
  font-size: 1.0rem;
  border-radius: 4px;
}

.skill-input {
  width: 100%;
  padding: 0.4rem;
  font-size: 1.0rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.skill-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

.enc-indicator {
  display: inline-block;
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 10px solid #333;
  vertical-align: middle;
  margin-left: 2px;
  transition: border-color 0.3s;
}

.enc-indicator.enc-penalty-active {
  border-bottom-color: #c41e3a;
}

.enc-indicator.enc-burdened {
  border-bottom-color: #1e90ff;
}

/* ENC Status styling */
.enc-extremely-unburdened,
.enc-unburdened {
  color: #228b22 !important;
  font-weight: 600;
}

.enc-burdened {
  color: #1e90ff !important;
  font-weight: 700;
}

.enc-overburdened {
  color: #c41e3a !important;
  font-weight: 700;
}

.enc-penalty-active {
  color: #c41e3a;
  font-weight: 600;
}

/* Penalized skill value styling */
.enc-penalized-value {
  color: #c41e3a !important;
  background-color: rgba(196, 30, 58, 0.1) !important;
  font-weight: 600;
}

.enc-penalized-value.enc-burdened-penalty {
  color: #1e90ff !important;
  background-color: rgba(30, 144, 255, 0.1) !important;
}

/* Initiative/Movement penalty styling */
.enc-penalty-init-move {
  font-weight: 600;
}

.enc-penalty-init-move.burdened {
  color: #1e90ff !important;
  background-color: rgba(30, 144, 255, 0.1) !important;
}

.enc-penalty-init-move.overburdened {
  color: #c41e3a !important;
  background-color: rgba(196, 30, 58, 0.1) !important;
}

/* Belief Rows (Alignment, Passion, Oath) */
.alignment-section .section-subheader,
.passion-section .section-subheader,
.oath-section .section-subheader {
  display: grid !important;
  grid-template-columns: 1fr 135px 45px 50px 24px !important;
  gap: 0.4rem;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.belief-row {
  display: grid;
  grid-template-columns: 1fr 135px 45px 50px 24px;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0;
  font-size: 1.0rem;
  border-bottom: 1px solid var(--border-light);
}

.belief-row .d100-btn {
  padding: 0;
  margin: 0;
}

.belief-row .d10-icon {
  width: 16px;
  height: 16px;
}

.belief-row:last-child {
  border-bottom: none;
}

.belief-name {
  padding: 0.4rem 0.5rem;
  font-size: 1.0rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.belief-name:focus {
  outline: none;
  border-color: var(--input-focus);
}

.belief-formula {
  font-size: 0.75rem;
  color: var(--text-secondary);
  text-align: right;
}

.belief-formula-input {
  font-size: 0.75rem;
  color: var(--text-secondary);
  text-align: center;
  background: rgba(139, 115, 85, 0.1);
  border: 1px solid transparent;
  border-radius: 4px;
  padding: 0.25rem 0.2rem;
  width: 100%;
}

.belief-formula-input:focus {
  outline: none;
  border-color: var(--input-focus);
  background: var(--input-bg);
}

.belief-base {
  text-align: center;
  font-weight: 600;
  background: rgba(255,255,255,0.5);
  padding: 0.3rem;
  font-size: 1.0rem;
  border-radius: 4px;
}

.belief-input {
  width: 100%;
  padding: 0.4rem;
  font-size: 1.0rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.belief-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Language Rows */
.language-row {
  display: grid;
  grid-template-columns: 1fr 90px 60px 60px;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0;
  font-size: 1.0rem;
  border-bottom: 1px solid var(--border-light);
}

.language-row:last-child {
  border-bottom: none;
}

.language-row.native {
  grid-template-columns: auto 1fr 100px 60px 60px;
}

.language-label {
  font-size: 0.9rem;
  font-weight: 600;
  white-space: nowrap;
}

.language-name {
  padding: 0.4rem 0.5rem;
  font-size: 1.0rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-width: 0;
  border-radius: 4px;
}

.language-name:focus {
  outline: none;
  border-color: var(--input-focus);
}

.language-formula {
  font-size: 0.75rem;
  color: var(--text-secondary);
  text-align: right;
  white-space: nowrap;
}

.language-base {
  text-align: center;
  font-weight: 600;
  background: rgba(255,255,255,0.5);
  padding: 0.3rem;
  font-size: 1.0rem;
  border-radius: 4px;
}

.language-input {
  width: 100%;
  padding: 0.4rem;
  font-size: 1.0rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.language-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Professional Skills */
.professional-skill-row {
  display: grid;
  grid-template-columns: 42px 1fr 80px 55px 60px 24px 20px;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0;
  font-size: 1.0rem;
  border-bottom: 1px solid var(--border-light);
}

.professional-skill-row .d100-btn {
  padding: 0;
  margin: 0;
}

.professional-skill-row .d10-icon {
  width: 16px;
  height: 16px;
}

.professional-skill-row .prereq-keys {
  display: flex;
  gap: 2px;
  min-width: 42px;
}

.prof-enc-indicator {
  justify-self: center;
}

.prof-skill-name {
  padding: 0.4rem 0.5rem;
  font-size: 1.0rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.prof-skill-name:focus {
  outline: none;
  border-color: var(--input-focus);
}

.prof-skill-base {
  padding: 0.2rem !important;
  font-size: 0.7rem !important;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  text-align: center;
  border-radius: 4px;
  width: 100%;
  cursor: default;
}

.prof-skill-base[readonly] {
  background: rgba(139, 115, 85, 0.1);
  border-color: transparent;
}

.prof-skill-base-val {
  text-align: center;
  font-weight: 600;
  background: rgba(255,255,255,0.5);
  padding: 0.3rem;
  font-size: 1.0rem;
  border-radius: 4px;
}

.prof-skill-current {
  width: 100%;
  padding: 0.4rem;
  font-size: 1.0rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

/* Skill Grade Reference */
.enc-penalty-note {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 1.0rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.75rem;
}

.enc-penalty-note .enc-indicator {
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 12px solid #333;
  border-top: none;
}

.skill-grade-reference {
  background: rgba(255,255,255,0.2);
  padding: 1rem;
  border: 1px solid var(--border-light);
  border-radius: 8px;
}

.reference-header {
  font-family: var(--font-header);
  font-size: 0.8rem;
  font-weight: 600;
  margin: 0 0 0.25rem 0;
}

.grade-table {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: repeat(4, auto);
  grid-auto-flow: column;
  gap: 0.2rem 1rem;
}

.grade-row {
  display: flex;
  justify-content: space-between;
  padding: 0.15rem 0.3rem;
  font-size: 1.0rem;
  background: rgba(255,255,255,0.3);
}

/* ============================================
   Equipment Section
   ============================================ */
.equipment-section {
  background: rgba(255,255,255,0.2);
  padding: 1.25rem;
  border: 1px solid var(--border-light);
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  flex: 1;
}

.equipment-header {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border-light);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.header-item {
  flex: 1;
}

.header-enc {
  width: 60px;
  text-align: center;
}

#equipment-container {
  overflow-y: auto;
  max-height: 420px;  /* Shows approximately 12 rows */
  flex: 1;
}

.equipment-row {
  display: flex;
  gap: 0.5rem;
  padding: 0.3rem 0;
  border-bottom: 1px solid var(--border-light);
}

.equipment-name {
  flex: 1;
  padding: 0.4rem 0.6rem;
  font-size: 1.0rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-width: 0;
  border-radius: 4px;
}

.equipment-name:focus {
  outline: none;
  border-color: var(--input-focus);
}

.equipment-enc {
  width: 60px;
  padding: 0.4rem;
  font-size: 1.0rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  border-radius: 4px;
}

.equipment-enc:focus {
  outline: none;
  border-color: var(--input-focus);
}

.enc-totals {
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px solid var(--border-gold);
  font-size: 1rem;
}

.enc-money-row {
  display: flex;
  justify-content: space-between;
  padding: 0.1rem 0;
  margin-bottom: 0.25rem;
  font-weight: 500;
  color: var(--accent-gold);
}

.enc-toggle {
  margin-bottom: 0.25rem;
}

.enc-toggle label {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.68rem;
  cursor: pointer;
}

.enc-status-row,
.enc-total-row {
  display: flex;
  justify-content: space-between;
  padding: 0.1rem 0;
}

.enc-status-value,
.enc-total-value {
  font-weight: 600;
}

/* Money Section */
.money-section {
  margin-top: 0.75rem;
  padding: 0.5rem;
  background: rgba(255,255,255,0.15);
  border: 1px solid var(--border-gold);
  border-radius: 4px;
}

.money-header {
  font-family: var(--font-header);
  font-size: 1rem;
  color: var(--text-header);
  text-align: center;
  margin: 0 0 0.5rem 0;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid var(--border-light);
}

.money-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.25rem;
}

.money-row {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.money-row label {
  font-size: 0.75rem;
  font-weight: 500;
  margin-bottom: 0.15rem;
}

.money-input {
  width: 100%;
  max-width: 70px;
  padding: 0.25rem;
  font-size: 0.9rem;
  text-align: center;
  border: 1px solid var(--accent-rust);
  border-radius: 3px;
  background: rgba(255,255,255,0.9);
}

.money-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Container Buttons */
.container-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.75rem;
}

.btn-container {
  flex: 1 1 auto;
  min-width: 120px;
  padding: 0.5rem 0.75rem;
  font-family: var(--font-header);
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-header);
  background: linear-gradient(to bottom, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
  border: 1px solid var(--border-gold);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-container:hover {
  background: linear-gradient(to bottom, rgba(255,255,255,0.4), rgba(255,255,255,0.2));
  border-color: var(--text-header);
}

.btn-container.hidden {
  display: none;
}

/* Container Modal Capacity Bar */
.container-capacity-bar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  padding: 0.5rem;
  margin-bottom: 0.5rem;
  background: rgba(0,0,0,0.05);
  border-radius: 4px;
  font-size: 1rem;
  font-weight: 500;
}

.capacity-current {
  font-weight: 700;
  color: var(--accent-blue);
}

.capacity-max {
  font-weight: 700;
}

.container-capacity-bar.over-capacity .capacity-current {
  color: #c0392b;
}

.container-capacity-warning {
  background: #fef2f2;
  border: 1px solid #f87171;
  border-radius: 6px;
  padding: 10px 14px;
  margin-bottom: 12px;
  color: #b91c1c;
  font-weight: 600;
  text-align: center;
}

/* Modal Overlay */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-overlay.hidden {
  display: none;
}

.modal-content {
  background: var(--bg-parchment);
  border: 2px solid var(--border-gold);
  border-radius: 8px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  max-width: 500px;
  width: 90%;
  max-height: 85vh;
  min-height: 50vh;
  display: flex;
  flex-direction: column;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid var(--border-gold);
  background: linear-gradient(to bottom, rgba(139,115,85,0.2), transparent);
}

.modal-header h3 {
  font-family: var(--font-header);
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--text-header);
  margin: 0;
}

/* Container modal header buttons */
.container-header-buttons {
  display: flex;
  gap: 0.3rem;
  margin-left: auto;
  margin-right: 1rem;
}

.container-header-buttons .btn-small {
  padding: 0.2rem 0.5rem;
  font-size: 0.75rem;
}

.btn-modal-close {
  width: 2rem;
  height: 2rem;
  border: none;
  background: rgba(139,115,85,0.3);
  color: var(--text-header);
  font-size: 1.5rem;
  line-height: 1;
  border-radius: 4px;
  cursor: pointer;
}

.btn-modal-close:hover {
  background: rgba(139,115,85,0.5);
}

.modal-body {
  padding: 1rem 1.25rem;
  overflow-y: auto;
  flex: 1;
}

.modal-body .equipment-header {
  margin-bottom: 0.75rem;
}

.modal-footer {
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border-light);
  display: flex;
  justify-content: flex-end;
}

#container-items {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  max-height: 350px;
  overflow-y: auto;
}

#container-items .equipment-row {
  padding: 0.25rem 0;
}

/* Equipment scrollable container */
.equipment-scrollable {
  max-height: 400px;
  overflow-y: auto;
}

/* ============================================
   Page 3: Combat
   ============================================ */
.combat-header-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
}

/* Quick Reference */
.quick-reference {
  background: rgba(255,255,255,0.2);
  padding: 0.75rem;
  border: 1px solid var(--border-light);
}

.quick-ref-row {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.quick-ref-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem;
  background: rgba(255,255,255,0.3);
  border: 1px solid var(--border-light);
  height: 95px;
}

.ref-label {
  font-family: var(--font-header);
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-header);
  text-align: center;
}

.ref-value {
  font-size: 1.4rem;
  font-weight: 500;
  text-align: center;
}

.quick-ref-skills {
  margin-top: 0.5rem;
}

.ref-skill-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.ref-skill-row:last-child {
  margin-bottom: 0;
}

.ref-skill-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem;
  background: rgba(255,255,255,0.3);
  border: 1px solid var(--border-light);
  height: 95px;
}

.ref-skill-label {
  font-family: var(--font-header);
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-header);
  text-align: center;
}

.ref-skill-value {
  font-size: 1.4rem;
  font-weight: 500;
  text-align: center;
}

/* Hit Locations */
.hit-locations {
  background: rgba(255,255,255,0.2);
  padding: 0.5rem;
  border: 1px solid var(--border-light);
}

.hit-location-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.hit-location-table th,
.hit-location-table td {
  padding: 0.25rem 0.3rem;
  border: 1px solid var(--border-light);
  text-align: center;
}

.hit-location-table th {
  background: rgba(0,0,0,0.08);
  font-family: var(--font-header);
  font-weight: 700;
  font-size: 1.0rem;
  color: var(--text-header);
}

/* Column widths */
.hit-location-table th:nth-child(1),
.hit-location-table td:nth-child(1) {
  width: 55px;
  font-size: 1rem;
}

.hit-location-table th:nth-child(2) {
  width: 80px;
  text-align: left;
}

.hit-location-table td:nth-child(2) {
  width: 80px;
  text-align: left;
  font-weight: 500;
  font-size: 1rem;
}

.hit-location-table th:nth-child(3),
.hit-location-table td:nth-child(3) {
  width: 140px;
}

.hit-location-table th:nth-child(4),
.hit-location-table td:nth-child(4) {
  width: 50px;
}

.hit-location-table th:nth-child(5),
.hit-location-table td:nth-child(5) {
  width: 100px;
}

.hit-location-table input {
  width: 40px;
  padding: 0.3rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.hit-location-table input.armor-input {
  width: 100%;
  text-align: left;
}

.hit-location-table input:focus {
  outline: none;
  border-color: var(--input-focus);
}

.hit-location-table .hp-max-input,
.hit-location-table .hp-current {
  width: 40px;
  display: inline-block;
}

/* HP Cell with buttons */
.hp-cell {
  white-space: nowrap;
}

.hp-separator {
  margin: 0 2px;
  color: var(--text-secondary);
}

.hp-current-wrapper {
  display: inline-flex;
  align-items: center;
  gap: 3px;
}

.hp-btn-stack {
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.hp-btn {
  width: 16px;
  height: 12px;
  padding: 0;
  border: 1px solid var(--border-color);
  background: linear-gradient(to bottom, #f5f5f5, #e0e0e0);
  color: var(--text-color);
  font-size: 0.5rem;
  line-height: 1;
  cursor: pointer;
  border-radius: 2px;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.hp-btn:hover {
  background: linear-gradient(to bottom, #e8e8e8, #d0d0d0);
}

.hp-btn:active {
  background: linear-gradient(to bottom, #d0d0d0, #c0c0c0);
  transform: scale(0.95);
}

.hp-btn.hp-down {
  color: #c62828;
}

.hp-btn.hp-down:hover {
  background: linear-gradient(to bottom, #ffebee, #ffcdd2);
  border-color: #ef9a9a;
}

.hp-btn.hp-up {
  color: #2e7d32;
}

.hp-btn.hp-up:hover {
  background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
  border-color: #a5d6a7;
}

/* Wound Status Column */
.hit-location-table th:nth-child(6),
.hit-location-table td:nth-child(6) {
  width: 100px;
  text-align: center;
}

.wound-status {
  display: inline-block;
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  white-space: nowrap;
  color: var(--text-secondary);
}

.wound-status.wound-none {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  color: #2e7d32;
  border: 1px solid #a5d6a7;
  box-shadow: 0 1px 3px rgba(46, 125, 50, 0.2);
}

.wound-status.wound-minor {
  background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
  color: #f57f17;
  border: 1px solid #ffd54f;
  box-shadow: 0 1px 3px rgba(245, 127, 23, 0.2);
}

.wound-status.wound-serious {
  background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
  color: #c62828;
  border: 1px solid #ef9a9a;
  box-shadow: 0 1px 3px rgba(198, 40, 40, 0.2);
}

.wound-status.wound-major {
  background: linear-gradient(135deg, #4a0000 0%, #7b0000 100%);
  color: #fff;
  border: 1px solid #b71c1c;
  box-shadow: 0 1px 4px rgba(183, 28, 28, 0.4);
  animation: major-wound-pulse 2s infinite;
}

@keyframes major-wound-pulse {
  0%, 100% { box-shadow: 0 1px 4px rgba(183, 28, 28, 0.4); }
  50% { box-shadow: 0 2px 8px rgba(183, 28, 28, 0.7), 0 0 12px rgba(183, 28, 28, 0.3); }
}

/* Hit Locations section header */
.hit-locations .section-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.hit-locations .section-header {
  margin: 0;
}

/* Heal All button */
.btn-heal-all {
  padding: 0.25rem 0.6rem;
  font-size: 0.8rem;
  background: linear-gradient(135deg, #3a5a3a 0%, #4a7a4a 50%, #3a5a3a 100%);
  border: 1px solid #6a9a6a;
  color: white;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-heal-all:hover {
  background: linear-gradient(135deg, #4a6a4a 0%, #5a8a5a 50%, #4a6a4a 100%);
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(90, 150, 90, 0.4);
}

/* Heal All Confirmation Modal */
.heal-modal {
  max-width: 400px;
  text-align: center;
}

.heal-modal-header {
  background: linear-gradient(135deg, rgba(60, 100, 60, 0.3), rgba(80, 130, 80, 0.2));
  border-bottom-color: #6a9a6a;
}

.heal-modal-header h3 {
  color: #4a8a4a;
}

.heal-modal-body {
  padding: 1.5rem;
}

.heal-modal-body p {
  margin: 0 0 0.75rem 0;
  font-size: 1.0rem;
}

.heal-modal-note {
  font-size: 0.9rem !important;
  color: var(--text-secondary);
  font-style: italic;
}

.heal-modal-footer {
  display: flex;
  gap: 1rem;
  justify-content: center;
  padding: 1rem 1.5rem;
  border-top: 1px solid var(--border-light);
  background: rgba(0,0,0,0.03);
}

.btn-heal-confirm {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a8a4a 50%, #3a6a3a 100%);
  color: white;
  border: 1px solid #5a9a5a;
  padding: 0.5rem 1.25rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-heal-confirm:hover {
  background: linear-gradient(135deg, #4a7a4a 0%, #5a9a5a 50%, #4a7a4a 100%);
  box-shadow: 0 2px 8px rgba(90, 150, 90, 0.4);
}

/* Wound Info Modal */
.wound-info-modal {
  max-width: 550px;
  max-height: 85vh;
  overflow-y: auto;
}

.wound-info-header {
  border-bottom: 2px solid;
}

.wound-info-header-minor {
  background: linear-gradient(135deg, rgba(255, 235, 59, 0.2) 0%, rgba(255, 193, 7, 0.15) 100%);
  border-bottom-color: #ffc107;
}

.wound-info-header-minor h3 {
  color: #f57f17;
}

.wound-info-header-serious {
  background: linear-gradient(135deg, rgba(244, 67, 54, 0.2) 0%, rgba(211, 47, 47, 0.15) 100%);
  border-bottom-color: #f44336;
}

.wound-info-header-serious h3 {
  color: #c62828;
}

.wound-info-header-major {
  background: linear-gradient(135deg, rgba(74, 0, 0, 0.9) 0%, rgba(123, 0, 0, 0.85) 100%);
  border-bottom-color: #b71c1c;
}

.wound-info-header-major h3 {
  color: #ffcdd2;
}

.wound-info-body {
  padding: 1rem 1.25rem;
}

.wound-info-section {
  margin-bottom: 1.25rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-light);
}

.wound-info-section:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.wound-intro {
  font-size: 1rem;
  line-height: 1.5;
  margin: 0;
}

.wound-intro-major {
  color: #c62828;
  font-weight: 500;
}

.wound-effect-good {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  color: #2e7d32;
  padding: 0.75rem 1rem;
  border-radius: 6px;
  border: 1px solid #a5d6a7;
  margin-top: 0.75rem;
  text-align: center;
}

.wound-info-section h4 {
  font-family: var(--font-header);
  font-size: 1rem;
  color: var(--text-header);
  margin: 0 0 0.75rem 0;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid var(--border-light);
}

.wound-info-section h5 {
  font-size: 0.9rem;
  color: var(--text-header);
  margin: 0.75rem 0 0.5rem 0;
}

.wound-effects-list {
  margin: 0;
  padding-left: 1.5rem;
}

.wound-effects-list li {
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

.wound-effects-major li {
  color: #b71c1c;
}

.wound-location-group {
  background: rgba(0,0,0,0.03);
  padding: 0.75rem;
  border-radius: 6px;
  margin-bottom: 0.75rem;
  border-left: 3px solid var(--border-gold);
}

.wound-location-group h5 {
  margin-top: 0;
}

.wound-location-group ul {
  margin: 0;
  padding-left: 1.25rem;
}

.wound-location-group li {
  margin-bottom: 0.3rem;
}

.wound-roll-section {
  margin-top: 1rem;
  text-align: center;
}

.btn-roll-endurance {
  background: linear-gradient(135deg, #1565c0 0%, #1976d2 50%, #1565c0 100%);
  color: white;
  border: 1px solid #1976d2;
  padding: 0.6rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
  box-shadow: 0 2px 6px rgba(21, 101, 192, 0.3);
}

.btn-roll-endurance:hover {
  background: linear-gradient(135deg, #1976d2 0%, #2196f3 50%, #1976d2 100%);
  box-shadow: 0 4px 12px rgba(21, 101, 192, 0.4);
  transform: translateY(-1px);
}

.btn-roll-major {
  background: linear-gradient(135deg, #b71c1c 0%, #c62828 50%, #b71c1c 100%);
  border-color: #d32f2f;
  box-shadow: 0 2px 6px rgba(183, 28, 28, 0.3);
}

.btn-roll-major:hover {
  background: linear-gradient(135deg, #c62828 0%, #e53935 50%, #c62828 100%);
  box-shadow: 0 4px 12px rgba(183, 28, 28, 0.4);
}

.wound-note {
  background: rgba(255, 193, 7, 0.1);
  border: 1px solid #ffc107;
  border-radius: 6px;
  padding: 0.75rem;
  font-size: 0.9rem;
  margin-top: 0.75rem;
}

.wound-penalties {
  background: rgba(255, 235, 59, 0.05);
  border-radius: 8px;
  padding: 1rem;
  border: 1px solid rgba(255, 193, 7, 0.3);
}

.wound-fatal {
  background: rgba(183, 28, 28, 0.1);
  border-radius: 8px;
  padding: 1rem;
  border: 1px solid rgba(183, 28, 28, 0.3);
}

.wound-death-warning {
  color: #b71c1c;
  font-weight: 600;
  padding: 0.5rem 0.75rem;
  background: rgba(183, 28, 28, 0.1);
  border-radius: 4px;
  border-left: 3px solid #b71c1c;
}

.wound-survival {
  background: rgba(255, 152, 0, 0.1);
  border-radius: 8px;
  padding: 1rem;
  border: 1px solid rgba(255, 152, 0, 0.3);
}

.wound-info-footer {
  border-top: 1px solid var(--border-light);
  padding: 0.75rem 1.25rem;
  text-align: center;
  background: rgba(0,0,0,0.03);
}

/* Clickable wound status */
.wound-status.clickable {
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.wound-status.clickable:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.wound-status.clickable:not(.wound-none):hover::after {
  content: ' ';
  font-size: 0.6rem;
}

/* Combat Skills */
.combat-skills-section {
  margin-bottom: 1rem;
}

.combat-skills-section > .combat-skill-header {
  display: grid;
  grid-template-columns: 42px 200px 55px 24px 12px 1fr 65px;
  gap: 0.4rem;
  font-family: var(--font-header);
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-header);
  padding: 0.25rem 0.3rem;
  background: rgba(0,0,0,0.08);
  border: 1px solid var(--border-light);
}

.combat-skills-section > .combat-skill-row {
  display: grid;
  grid-template-columns: 42px 200px 55px 24px 12px 1fr 65px;
  gap: 0.4rem;
  padding: 0.2rem 0.3rem;
  border: 1px solid var(--border-light);
  border-top: none;
  font-size: 0.82rem;
}

.combat-skills-section .combat-skill-row .d100-btn {
  padding: 0;
  margin: 0;
  align-self: center;
}

.combat-skills-section .combat-skill-row .d10-icon {
  width: 16px;
  height: 16px;
}

.combat-skills-section .combat-skill-row .enc-indicator {
  align-self: center;
}

.combat-skills-section .combat-skill-row .prereq-keys {
  display: flex;
  gap: 2px;
  align-items: center;
}

.combat-skill-name {
  padding: 0.4rem 0.4rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.combat-skill-name:focus {
  outline: none;
  border-color: var(--input-focus);
}

.combat-skills-section .combat-skill-row.unarmed .combat-skill-name {
  background: transparent;
  border: none;
  font-weight: 500;
}

.combat-skill-percent {
  padding: 0.4rem 0.4rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.combat-skill-percent:focus {
  outline: none;
  border-color: var(--input-focus);
}

.combat-weapons-known {
  padding: 0.4rem 0.4rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.combat-weapons-known:focus {
  outline: none;
  border-color: var(--input-focus);
}

.combat-skills-section .combat-skill-row.unarmed .combat-weapons-known {
  background: transparent;
  border: none;
}

.combat-base {
  font-size: 0.68rem;
  color: var(--text-secondary);
  text-align: center;
  align-self: center;
}

/* Weapons Tables */
.weapons-section {
  margin-bottom: 1rem;
}

.weapons-table {
  width: 100%;
  border-collapse: collapse;
}

.weapons-table th,
.weapons-table td {
  padding: 0.15rem 0.2rem;
  border: 1px solid var(--border-light);
}

.weapons-table th {
  background: rgba(0,0,0,0.08);
  font-family: var(--font-header);
  font-weight: 700;
  font-size: 1rem;
  color: var(--text-header);
}

.weapons-table input {
  width: 100%;
  padding: 0.4rem 0.4rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.weapons-table input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Melee Weapons Table Column Widths */
.melee-weapons .weapons-table th:nth-child(1),
.melee-weapons .weapons-table td:nth-child(1) { width: 18%; } /* Melee Weapon name */
.melee-weapons .weapons-table th:nth-child(2),
.melee-weapons .weapons-table td:nth-child(2) { width: 6%; text-align: center; } /* Hands - smaller, centered */
.melee-weapons .weapons-table th:nth-child(3),
.melee-weapons .weapons-table td:nth-child(3) { width: 10%; text-align: center; } /* Damage - centered */
.melee-weapons .weapons-table th:nth-child(4),
.melee-weapons .weapons-table td:nth-child(4) { width: 5%; text-align: center; } /* Size - smaller, centered */
.melee-weapons .weapons-table th:nth-child(5),
.melee-weapons .weapons-table td:nth-child(5) { width: 25%; } /* Combat Special Effects - wider */
.melee-weapons .weapons-table th:nth-child(6),
.melee-weapons .weapons-table td:nth-child(6) { width: 8%; text-align: center; } /* AP/HP - smaller, centered */
.melee-weapons .weapons-table th:nth-child(7),
.melee-weapons .weapons-table td:nth-child(7) { width: 28%; } /* Weapon Traits - wider */

.melee-weapons .weapons-table td:nth-child(2) input,
.melee-weapons .weapons-table td:nth-child(3) input,
.melee-weapons .weapons-table td:nth-child(4) input,
.melee-weapons .weapons-table td:nth-child(6) input {
  text-align: center;
}

/* Ranged Weapons Table Column Widths */
.ranged-weapons .weapons-table th:nth-child(1),
.ranged-weapons .weapons-table td:nth-child(1) { width: 16%; } /* Ranged Weapon name - larger */
.ranged-weapons .weapons-table th:nth-child(2),
.ranged-weapons .weapons-table td:nth-child(2) { width: 5%; text-align: center; } /* Hands - smaller, centered */
.ranged-weapons .weapons-table th:nth-child(3),
.ranged-weapons .weapons-table td:nth-child(3) { width: 8%; text-align: center; } /* Damage - centered */
.ranged-weapons .weapons-table th:nth-child(4),
.ranged-weapons .weapons-table td:nth-child(4) { width: 6%; text-align: center; } /* Damage Mod Y/N - smaller, centered */
.ranged-weapons .weapons-table th:nth-child(5),
.ranged-weapons .weapons-table td:nth-child(5) { width: 10%; text-align: center; } /* Range - smaller, centered */
.ranged-weapons .weapons-table th:nth-child(6),
.ranged-weapons .weapons-table td:nth-child(6) { width: 5%; text-align: center; } /* Load - smaller, centered */
.ranged-weapons .weapons-table th:nth-child(7),
.ranged-weapons .weapons-table td:nth-child(7) { width: 20%; } /* Special Effects - larger */
.ranged-weapons .weapons-table th:nth-child(8),
.ranged-weapons .weapons-table td:nth-child(8) { width: 6%; text-align: center; } /* Impale Size - centered */
.ranged-weapons .weapons-table th:nth-child(9),
.ranged-weapons .weapons-table td:nth-child(9) { width: 6%; text-align: center; } /* AP/HP - smaller, centered */
.ranged-weapons .weapons-table th:nth-child(10),
.ranged-weapons .weapons-table td:nth-child(10) { width: 18%; } /* Traits - larger */

.ranged-weapons .weapons-table td:nth-child(2) input,
.ranged-weapons .weapons-table td:nth-child(3) input,
.ranged-weapons .weapons-table td:nth-child(4) input,
.ranged-weapons .weapons-table td:nth-child(5) input,
.ranged-weapons .weapons-table td:nth-child(6) input,
.ranged-weapons .weapons-table td:nth-child(8) input,
.ranged-weapons .weapons-table td:nth-child(9) input {
  text-align: center;
}

/* Movement & Fatigue Grid */
.movement-fatigue-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
}

.movement-section,
.fatigue-section {
  background: rgba(255,255,255,0.2);
  padding: 0.75rem;
  border: 1px solid var(--border-light);
}

.movement-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.movement-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0.5rem;
  background: rgba(255,255,255,0.3);
  border: 1px solid var(--border-light);
  text-align: center;
}

.movement-label {
  font-family: var(--font-header);
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-header);
}

.movement-sublabel {
  font-size: 0.85rem;
  font-weight: 400;
  color: var(--text-secondary);
  margin-bottom: 0.25rem;
}

.movement-value {
  font-size: 1.4rem;
  font-weight: 500;
}

.movement-value-input {
  width: 70px;
  padding: 0.35rem 0.3rem;
  font-size: 1.4rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-height: 2rem;
  box-sizing: border-box;
}

.movement-value-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

.jump-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.5rem;
}

.syrin-only {
  display: none;
}

[data-sheet-type="syrin"] .syrin-only {
  display: flex;
}

[data-sheet-type="syrin"] .human-only {
  display: none;
}

/* Fatigue Table */
.fatigue-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.82rem;
}

.fatigue-table th,
.fatigue-table td {
  padding: 0.3rem 0.4rem;
  border: 1px solid var(--border-light);
  text-align: center;
}

.fatigue-table th {
  background: rgba(0,0,0,0.08);
  font-weight: 600;
  font-size: 0.78rem;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

/* Radio button column */
.fatigue-col-radio {
  width: 30px;
  padding: 0 !important;
}

.fatigue-radio-cell {
  padding: 0.15rem !important;
}

.fatigue-radio-cell input[type="radio"] {
  cursor: pointer;
  width: 16px;
  height: 16px;
  accent-color: var(--border-gold, #8b6914);
}

/* State column: bold, larger, left-aligned */
.fatigue-col-state {
  text-align: left;
  width: 22%;
}

.fatigue-state-name {
  font-weight: 700;
  font-size: 0.88rem;
  text-align: left;
  font-family: var(--font-header);
  color: var(--text-header);
  cursor: pointer;
}

/* Clicking the state name also selects the radio */
.fatigue-table tbody tr {
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.fatigue-table tbody tr:hover {
  background: rgba(139, 105, 20, 0.08);
}

/* Active fatigue row highlight */
.fatigue-table tbody tr.fatigue-active {
  background: rgba(139, 105, 20, 0.15);
  box-shadow: inset 3px 0 0 var(--border-gold, #8b6914);
}

.fatigue-table tbody tr.fatigue-active .fatigue-state-name {
  color: var(--border-gold, #8b6914);
}

.fatigue-table tbody tr:nth-child(even) {
  background: rgba(255,255,255,0.3);
}

.fatigue-table tbody tr:nth-child(even).fatigue-active {
  background: rgba(139, 105, 20, 0.15);
}

/* Fatigue penalty visual styling on affected fields */
.fatigue-penalized {
  color: #b35900 !important;
  font-style: italic;
}

.fatigue-penalized.fatigue-severe {
  color: #cc0000 !important;
}

.fatigue-incapacitated {
  color: #999 !important;
  font-style: italic;
}

/* Combined ENC + Fatigue penalty styling */
.enc-penalized-value.fatigue-penalized {
  color: #8b0000 !important;
  font-weight: 600;
}

/* Fatigue penalty note next to the ENC penalty note */
.fatigue-penalty-note {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.72rem;
  color: var(--text-secondary);
  margin-top: 0.15rem;
}

.fatigue-indicator {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #b35900;
  opacity: 0.4;
}

.fatigue-indicator.fatigue-penalty-active {
  opacity: 1;
  background: #b35900;
  box-shadow: 0 0 3px rgba(179, 89, 0, 0.5);
}

.fatigue-indicator.fatigue-severe-active {
  background: #cc0000;
  box-shadow: 0 0 3px rgba(204, 0, 0, 0.5);
}

/* Fatigue Summary Widget */
.fatigue-widget-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 3px;
}

.fatigue-widget-btn {
  font-size: 0.68rem;
  padding: 3px 2px;
  border: 1px solid var(--border-light);
  background: rgba(255,255,255,0.3);
  cursor: pointer;
  border-radius: 3px;
  transition: all 0.15s ease;
  font-family: var(--font-body);
  color: var(--text-primary);
  line-height: 1.2;
}

.fatigue-widget-btn:hover {
  background: rgba(139, 105, 20, 0.12);
  border-color: var(--border-gold, #8b6914);
}

.fatigue-widget-btn.fatigue-btn-active {
  background: rgba(139, 105, 20, 0.2);
  border-color: var(--border-gold, #8b6914);
  font-weight: 700;
  box-shadow: inset 0 0 0 1px var(--border-gold, #8b6914);
}

.fatigue-widget-btn.fatigue-btn-mild {
  border-left: 2px solid #cc9900;
}

.fatigue-widget-btn.fatigue-btn-moderate {
  border-left: 2px solid #b35900;
}

.fatigue-widget-btn.fatigue-btn-severe {
  border-left: 2px solid #cc0000;
}

.fatigue-widget-btn.fatigue-btn-disabled {
  border-left: 2px solid #666;
  color: #888;
}

.fatigue-widget-btn.fatigue-btn-active.fatigue-btn-mild {
  background: rgba(204, 153, 0, 0.15);
  border-color: #cc9900;
}

.fatigue-widget-btn.fatigue-btn-active.fatigue-btn-moderate {
  background: rgba(179, 89, 0, 0.15);
  border-color: #b35900;
}

.fatigue-widget-btn.fatigue-btn-active.fatigue-btn-severe {
  background: rgba(204, 0, 0, 0.12);
  border-color: #cc0000;
}

.fatigue-widget-btn.fatigue-btn-active.fatigue-btn-disabled {
  background: rgba(100, 100, 100, 0.15);
  border-color: #666;
}

/* Fatigue Widget Rest Buttons */
.fatigue-widget-rest-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
}

.fatigue-widget-rest-btn {
  flex: 1;
  font-size: 0.75rem;
  padding: 0.4rem 0.5rem;
  border: 2px solid;
  border-radius: 5px;
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 600;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.fatigue-widget-rest-short {
  background: linear-gradient(to bottom, #fff8e6, #ffecb3);
  border-color: #d4a017;
  color: #8b6914;
}

.fatigue-widget-rest-short:hover {
  background: linear-gradient(to bottom, #ffecb3, #ffe082);
  border-color: #c49000;
}

.fatigue-widget-rest-long {
  background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
  border-color: #2e7d32;
  color: #1b5e20;
}

.fatigue-widget-rest-long:hover {
  background: linear-gradient(to bottom, #c8e6c9, #a5d6a7);
  border-color: #1b5e20;
}

/* Rest Buttons on Character Page */
.field-row-with-rest {
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
}

.field-row-with-buttons {
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
}

.field-row-with-buttons .field-input {
  flex: 1;
}

.field-row-with-buttons .game-buttons {
  margin-left: 1rem;
}

.rest-buttons {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin-left: 2.5rem;
}

.rest-btn {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.82rem;
  padding: 0.4rem 0.7rem;
  border: 2px solid;
  background: linear-gradient(to bottom, rgba(255,255,255,0.9), rgba(240,240,240,0.9));
  cursor: pointer;
  border-radius: 5px;
  font-family: var(--font-body);
  font-weight: 600;
  transition: all 0.15s ease;
  white-space: nowrap;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.rest-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

.rest-btn:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.rest-icon {
  font-size: 1.0rem;
  line-height: 1;
}

.rest-text {
  line-height: 1;
}

/* Short Rest - warm yellow/orange theme */
.rest-btn-short {
  border-color: #d4a017;
  background: linear-gradient(to bottom, #fff8e6, #ffecb3);
  color: #8b6914;
}

.rest-btn-short:hover {
  background: linear-gradient(to bottom, #ffecb3, #ffe082);
  border-color: #c49000;
}

/* Long Rest - calming green theme */
.rest-btn-long {
  border-color: #2e7d32;
  background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
  color: #1b5e20;
}

.rest-btn-long:hover {
  background: linear-gradient(to bottom, #c8e6c9, #a5d6a7);
  border-color: #1b5e20;
}

/* Game Session Buttons */
.game-buttons {
  display: flex;
  gap: 0.5rem;
  margin-left: 0.75rem;
}

.game-btn {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.35rem 0.6rem;
  border: 2px solid;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.game-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.game-btn:active {
  transform: translateY(0);
}

.game-icon {
  font-size: 1rem;
}

.game-btn-new {
  border-color: #1565c0;
  background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
  color: #0d47a1;
}

.game-btn-new:hover {
  background: linear-gradient(to bottom, #bbdefb, #90caf9);
  border-color: #0d47a1;
}

.game-btn-finish {
  border-color: #7b1fa2;
  background: linear-gradient(to bottom, #f3e5f5, #e1bee7);
  color: #4a148c;
}

.game-btn-finish:hover {
  background: linear-gradient(to bottom, #e1bee7, #ce93d8);
  border-color: #4a148c;
}

/* New Game Modal */
.new-game-modal {
  max-width: 400px;
  text-align: center;
}

.new-game-modal-header {
  background: linear-gradient(135deg, rgba(21, 101, 192, 0.2) 0%, rgba(13, 71, 161, 0.15) 100%);
  border-bottom: 2px solid #1565c0;
}

.new-game-modal-header h3 {
  color: #0d47a1;
}

.new-game-modal-body {
  padding: 1.5rem;
}

.new-game-message {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--text-header);
  margin: 0 0 0.5rem 0;
}

.new-game-effect {
  font-size: 1rem;
  color: var(--text-secondary);
  margin: 0 0 1.25rem 0;
}

.new-game-luck-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  border: 2px solid #4caf50;
  border-radius: 12px;
  padding: 1rem;
  margin: 0 auto;
  max-width: 150px;
}

.new-game-luck-display .luck-icon {
  font-size: 2rem;
}

.new-game-luck-display .luck-value {
  font-size: 2.5rem;
  font-weight: 700;
  color: #2e7d32;
  line-height: 1;
}

.new-game-luck-display .luck-label {
  font-size: 0.85rem;
  color: #1b5e20;
  font-weight: 600;
}

.new-game-modal-footer {
  border-top: 1px solid var(--border-light);
  padding: 1rem;
  background: rgba(0,0,0,0.03);
}

.new-game-modal-footer .btn-primary {
  padding: 0.6rem 2rem;
  font-size: 1rem;
}

/* Finish Game Modal */
.finish-game-modal {
  max-width: 450px;
}

.finish-game-modal-header {
  background: linear-gradient(135deg, rgba(123, 31, 162, 0.2) 0%, rgba(74, 20, 140, 0.15) 100%);
  border-bottom: 2px solid #7b1fa2;
}

.finish-game-modal-header h3 {
  color: #4a148c;
}

.finish-game-modal-body {
  padding: 1.5rem;
}

.finish-game-message {
  font-size: 1.0rem;
  color: var(--text-header);
  margin: 0 0 1.25rem 0;
  text-align: center;
}

.finish-game-input-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
}

.finish-game-input-row label {
  font-weight: 600;
  color: var(--text-header);
}

.finish-game-exp-input {
  width: 70px;
  padding: 0.5rem;
  font-size: 1.25rem;
  font-weight: 600;
  text-align: center;
  border: 2px solid #7b1fa2;
  border-radius: 6px;
  background: #faf4fc;
}

.finish-game-exp-input:focus {
  outline: none;
  border-color: #4a148c;
  box-shadow: 0 0 0 3px rgba(123, 31, 162, 0.2);
}

.finish-game-summary {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  background: rgba(0,0,0,0.03);
  padding: 0.75rem 1rem;
  border-radius: 6px;
  font-size: 1rem;
}

.finish-game-summary .exp-current {
  color: var(--text-secondary);
}

.finish-game-summary .exp-arrow {
  color: #7b1fa2;
  font-weight: bold;
}

.finish-game-summary .exp-new {
  color: #4a148c;
}

.finish-game-summary strong {
  font-size: 1.0rem;
}

.finish-game-modal-footer {
  display: flex;
  gap: 1rem;
  justify-content: center;
  padding: 1rem;
  border-top: 1px solid var(--border-light);
  background: rgba(0,0,0,0.03);
}

.btn-finish-confirm {
  background: linear-gradient(135deg, #7b1fa2 0%, #9c27b0 50%, #7b1fa2 100%);
  color: white;
  border: 1px solid #6a1b9a;
  padding: 0.5rem 1.5rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.btn-finish-confirm:hover {
  background: linear-gradient(135deg, #6a1b9a 0%, #8e24aa 50%, #6a1b9a 100%);
  box-shadow: 0 2px 8px rgba(123, 31, 162, 0.4);
}

/* Short Rest Modal */
.short-rest-modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  justify-content: center;
  align-items: center;
}

.short-rest-modal-overlay.active {
  display: flex;
}

.short-rest-modal {
  background: var(--page-bg, #f5f0e6);
  border: 3px solid var(--border-gold, #8b6914);
  border-radius: 8px;
  max-width: 600px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.short-rest-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  background: linear-gradient(to bottom, #fff8e6, #ffecb3);
  border-bottom: 2px solid var(--border-gold, #8b6914);
  border-radius: 5px 5px 0 0;
}

.short-rest-modal-header h3 {
  margin: 0;
  font-family: var(--font-header);
  font-size: 1.3rem;
  color: #8b6914;
}

.short-rest-modal-close {
  background: none;
  border: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: #8b6914;
  line-height: 1;
  padding: 0;
  opacity: 0.7;
}

.short-rest-modal-close:hover {
  opacity: 1;
}

.short-rest-modal-body {
  padding: 1.25rem;
}

.short-rest-intro {
  margin: 0 0 1rem 0;
  font-size: 0.95rem;
  color: var(--text-secondary);
}

.short-rest-options {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.short-rest-option {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.75rem;
  border: 2px solid var(--border-light);
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  transition: all 0.15s ease;
}

.short-rest-option:hover {
  background: rgba(255, 255, 255, 0.8);
  border-color: var(--border-gold, #8b6914);
}

.short-rest-option input[type="radio"] {
  margin-top: 0.25rem;
  width: 18px;
  height: 18px;
  accent-color: var(--border-gold, #8b6914);
  cursor: pointer;
  flex-shrink: 0;
}

.short-rest-option input[type="radio"]:checked + .short-rest-option-content {
  color: var(--text-header);
}

.short-rest-option:has(input:checked) {
  background: rgba(139, 105, 20, 0.1);
  border-color: var(--border-gold, #8b6914);
  box-shadow: inset 0 0 0 1px rgba(139, 105, 20, 0.2);
}

.short-rest-option-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.short-rest-option-title {
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--text-header);
}

.short-rest-option-desc {
  font-size: 0.82rem;
  color: var(--text-secondary);
  line-height: 1.4;
}

.short-rest-option-desc em {
  color: #b35900;
  font-style: italic;
}

.short-rest-result {
  margin-top: 1rem;
  padding: 0.75rem;
  border-radius: 6px;
  display: none;
  font-size: 0.9rem;
  line-height: 1.4;
}

.short-rest-result.active {
  display: block;
}

.short-rest-result.success {
  background: rgba(34, 139, 34, 0.15);
  border: 1px solid #228b22;
  color: #1b5e20;
}

.short-rest-result.info {
  background: rgba(30, 144, 255, 0.15);
  border: 1px solid #1e90ff;
  color: #0066cc;
}

.short-rest-result.warning {
  background: rgba(255, 165, 0, 0.15);
  border: 1px solid #ffa500;
  color: #cc7000;
}

.short-rest-modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  background: rgba(0, 0, 0, 0.03);
  border-top: 1px solid var(--border-light);
  border-radius: 0 0 5px 5px;
}

.short-rest-modal-footer .btn {
  padding: 0.5rem 1.25rem;
  font-size: 0.9rem;
  border-radius: 5px;
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 600;
  transition: all 0.15s ease;
}

.short-rest-modal-footer .btn-primary {
  background: linear-gradient(to bottom, #fff8e6, #ffecb3);
  border: 2px solid #d4a017;
  color: #8b6914;
}

.short-rest-modal-footer .btn-primary:hover {
  background: linear-gradient(to bottom, #ffecb3, #ffe082);
}

.short-rest-modal-footer .btn-secondary {
  background: rgba(255, 255, 255, 0.5);
  border: 2px solid var(--border-light);
  color: var(--text-secondary);
}

.short-rest-modal-footer .btn-secondary:hover {
  background: rgba(255, 255, 255, 0.8);
  border-color: var(--border-medium);
}

/* Long Rest Sleep Animation */
.long-rest-sleep-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #0a0a1a;
  z-index: 10001;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
}

.long-rest-sleep-overlay.active {
  opacity: 1;
  pointer-events: all;
}

.sleep-content {
  text-align: center;
  color: #6699cc;
}

.sleep-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  animation: sleep-bob 2s ease-in-out infinite;
}

@keyframes sleep-bob {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.sleep-text {
  font-family: var(--font-header);
  font-size: 1.5rem;
  color: #8899bb;
  margin-bottom: 1.5rem;
}

.sleep-zzz {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  font-size: 2rem;
  font-weight: bold;
}

.sleep-zzz span {
  color: #99aacc;
  opacity: 0;
  animation: zzz-float 1.5s ease-in-out infinite;
}

.sleep-zzz span:nth-child(1) {
  animation-delay: 0s;
  font-size: 1.5rem;
}

.sleep-zzz span:nth-child(2) {
  animation-delay: 0.3s;
  font-size: 2rem;
}

.sleep-zzz span:nth-child(3) {
  animation-delay: 0.6s;
  font-size: 2.5rem;
}

@keyframes zzz-float {
  0% {
    opacity: 0;
    transform: translateY(20px) rotate(-5deg);
  }
  20% {
    opacity: 1;
  }
  80% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translateY(-30px) rotate(5deg);
  }
}

.sleep-stars {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

.sleep-star {
  position: absolute;
  width: 4px;
  height: 4px;
  background: #fff;
  border-radius: 50%;
  animation: twinkle 2s ease-in-out infinite;
}

@keyframes twinkle {
  0%, 100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.2); }
}

/* ============================================
   SHORT REST ANIMATIONS
   ============================================ */
.short-rest-anim-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10001;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s ease;
}

.short-rest-anim-overlay.active {
  opacity: 1;
  pointer-events: all;
}

.short-rest-anim-content {
  text-align: center;
  z-index: 2;
}

.short-rest-anim-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.short-rest-anim-text {
  font-family: var(--font-header);
  font-size: 1.4rem;
  margin-bottom: 1rem;
}

/* Eat/Ration Theme - Warm orange/amber */
.short-rest-anim-overlay.eat-theme {
  background: linear-gradient(135deg, #2d1f0f 0%, #4a3218 50%, #2d1f0f 100%);
}

.short-rest-anim-overlay.eat-theme .short-rest-anim-icon {
  animation: steam-rise 1.5s ease-in-out infinite;
}

.short-rest-anim-overlay.eat-theme .short-rest-anim-text {
  color: #e8b86d;
}

/* Campfire particles */
.campfire-particles {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

.ember {
  position: absolute;
  width: 6px;
  height: 6px;
  background: radial-gradient(circle, #ff6600 0%, #ff3300 50%, transparent 100%);
  border-radius: 50%;
  animation: ember-float 2s ease-out infinite;
}

@keyframes ember-float {
  0% { opacity: 1; transform: translateY(0) scale(1); }
  100% { opacity: 0; transform: translateY(-80px) scale(0.3); }
}

@keyframes steam-rise {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* Pray/Study Theme - Purple/gold arcane */
.short-rest-anim-overlay.study-theme {
  background: linear-gradient(135deg, #1a1025 0%, #2d1f4a 50%, #1a1025 100%);
}

.short-rest-anim-overlay.study-theme .short-rest-anim-icon {
  animation: magic-glow 2s ease-in-out infinite;
}

.short-rest-anim-overlay.study-theme .short-rest-anim-text {
  color: #c9a0dc;
}

.magic-runes {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

.rune {
  position: absolute;
  font-size: 1.5rem;
  color: #9966cc;
  opacity: 0;
  animation: rune-fade 3s ease-in-out infinite;
}

@keyframes rune-fade {
  0%, 100% { opacity: 0; transform: scale(0.8) rotate(-10deg); }
  50% { opacity: 0.7; transform: scale(1.1) rotate(10deg); }
}

@keyframes magic-glow {
  0%, 100% { filter: drop-shadow(0 0 10px #9966cc); }
  50% { filter: drop-shadow(0 0 25px #cc99ff); }
}

/* Tend Wounds Theme - Soft green/white medicinal */
.short-rest-anim-overlay.heal-theme {
  background: linear-gradient(135deg, #0f1f15 0%, #1a3025 50%, #0f1f15 100%);
}

.short-rest-anim-overlay.heal-theme .short-rest-anim-icon {
  animation: pulse-heal 1.5s ease-in-out infinite;
}

.short-rest-anim-overlay.heal-theme .short-rest-anim-text {
  color: #8fbc8f;
}

.healing-particles {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

.heal-cross {
  position: absolute;
  font-size: 1.2rem;
  color: #90ee90;
  opacity: 0;
  animation: heal-float 2.5s ease-out infinite;
}

@keyframes heal-float {
  0% { opacity: 0; transform: translateY(20px) scale(0.5); }
  30% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-60px) scale(1.2); }
}

@keyframes pulse-heal {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Cast Spell Theme - Bright cyan/white magical */
.short-rest-anim-overlay.magic-theme {
  background: linear-gradient(135deg, #0a1520 0%, #0f2535 50%, #0a1520 100%);
}

.short-rest-anim-overlay.magic-theme .short-rest-anim-icon {
  animation: sparkle-spin 2s linear infinite;
}

.short-rest-anim-overlay.magic-theme .short-rest-anim-text {
  color: #87ceeb;
}

.sparkle-particles {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

.sparkle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: #fff;
  border-radius: 50%;
  box-shadow: 0 0 6px #00ffff, 0 0 12px #00ffff;
  animation: sparkle-burst 1.5s ease-out infinite;
}

@keyframes sparkle-burst {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0) translateY(-30px); }
}

@keyframes sparkle-spin {
  0% { transform: rotate(0deg); filter: drop-shadow(0 0 15px #00ffff); }
  100% { transform: rotate(360deg); filter: drop-shadow(0 0 15px #00ffff); }
}

/* Dither Theme - Soft pastels, lazy afternoon */
.short-rest-anim-overlay.dither-theme {
  background: linear-gradient(135deg, #1a1a1f 0%, #252530 50%, #1a1a1f 100%);
}

.short-rest-anim-overlay.dither-theme .short-rest-anim-icon {
  animation: lazy-bob 3s ease-in-out infinite;
}

.short-rest-anim-overlay.dither-theme .short-rest-anim-text {
  color: #a0a0b0;
}

.cloud-particles {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

.cloud {
  position: absolute;
  font-size: 2rem;
  color: rgba(200, 200, 220, 0.3);
  animation: cloud-drift 8s linear infinite;
}

@keyframes cloud-drift {
  0% { transform: translateX(-50px); opacity: 0; }
  20% { opacity: 0.5; }
  80% { opacity: 0.5; }
  100% { transform: translateX(calc(100vw + 50px)); opacity: 0; }
}

@keyframes lazy-bob {
  0%, 100% { transform: translateY(0) rotate(-2deg); }
  50% { transform: translateY(-5px) rotate(2deg); }
}

/* Short Rest Toast Notification */
.short-rest-toast {
  position: fixed;
  top: 20px;
  right: 20px;
  min-width: 300px;
  max-width: 400px;
  background: var(--page-bg, #f5f0e6);
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  z-index: 10002;
  opacity: 0;
  transform: translateX(100%);
  transition: all 0.4s ease;
  pointer-events: none;
}

.short-rest-toast.active {
  opacity: 1;
  transform: translateX(0);
  pointer-events: all;
}

.short-rest-toast-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  border-radius: 8px 8px 0 0;
  border-bottom: 1px solid rgba(0,0,0,0.1);
}

.short-rest-toast.success .short-rest-toast-header {
  background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
  color: #1b5e20;
}

.short-rest-toast.info .short-rest-toast-header {
  background: linear-gradient(to bottom, #e3f2fd, #bbdefb);
  color: #0d47a1;
}

.short-rest-toast.warning .short-rest-toast-header {
  background: linear-gradient(to bottom, #fff3e0, #ffe0b2);
  color: #e65100;
}

.short-rest-toast-title {
  font-family: var(--font-header);
  font-size: 1.0rem;
  font-weight: bold;
}

.short-rest-toast-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  opacity: 0.6;
  line-height: 1;
  padding: 0;
  color: inherit;
}

.short-rest-toast-close:hover {
  opacity: 1;
}

.short-rest-toast-body {
  padding: 1rem;
  font-size: 0.9rem;
  line-height: 1.5;
  color: var(--text-primary);
}

.short-rest-toast-body strong {
  color: var(--text-header);
}

.short-rest-toast-body em {
  color: var(--text-secondary);
}

/* Long Rest Modal */
.long-rest-modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  justify-content: center;
  align-items: center;
}

.long-rest-modal-overlay.active {
  display: flex;
}

.long-rest-modal {
  background: var(--page-bg, #f5f0e6);
  border: 3px solid #2e7d32;
  border-radius: 8px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.long-rest-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
  border-bottom: 2px solid #2e7d32;
  border-radius: 5px 5px 0 0;
}

.long-rest-modal-header h3 {
  margin: 0;
  font-family: var(--font-header);
  font-size: 1.3rem;
  color: #1b5e20;
}

.long-rest-modal-close {
  background: none;
  border: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: #2e7d32;
  line-height: 1;
  padding: 0;
  opacity: 0.7;
}

.long-rest-modal-close:hover {
  opacity: 1;
}

.long-rest-modal-body {
  padding: 1.25rem;
  font-size: 0.95rem;
  line-height: 1.6;
}

.long-rest-modal-body strong {
  color: var(--text-header);
}

.long-rest-modal-body em {
  color: var(--text-secondary);
}

.long-rest-modal-footer {
  display: flex;
  justify-content: flex-end;
  padding: 1rem 1.25rem;
  background: rgba(0, 0, 0, 0.03);
  border-top: 1px solid var(--border-light);
  border-radius: 0 0 5px 5px;
}

.long-rest-modal-footer .btn-primary {
  padding: 0.5rem 1.5rem;
  font-size: 0.9rem;
  border-radius: 5px;
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 600;
  background: linear-gradient(to bottom, #e8f5e9, #c8e6c9);
  border: 2px solid #2e7d32;
  color: #1b5e20;
  transition: all 0.15s ease;
}

.long-rest-modal-footer .btn-primary:hover {
  background: linear-gradient(to bottom, #c8e6c9, #a5d6a7);
}

/* ============================================
   WOODLAND LANGUAGES MODAL
   ============================================ */
.woodland-languages-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.woodland-languages-modal.hidden {
  display: none;
}

.woodland-languages-modal-content {
  background: linear-gradient(135deg, #1a2a1a 0%, #2d3d2d 100%);
  border: 2px solid #4a7a4a;
  border-radius: 10px;
  padding: 1.5rem;
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.woodland-languages-modal-content h3 {
  color: #8fbc8f;
  text-align: center;
  margin: 0 0 1rem 0;
  font-size: 1.3rem;
  text-shadow: 0 0 10px rgba(143, 188, 143, 0.5);
}

.woodland-modal-description {
  color: #aaa;
  font-size: 0.85rem;
  line-height: 1.5;
  margin-bottom: 1rem;
  text-align: center;
}

.woodland-modal-description strong {
  color: #8fbc8f;
}

.woodland-custom-input {
  margin-bottom: 1rem;
}

.woodland-custom-input label {
  display: block;
  color: #aaa;
  font-size: 0.85rem;
  margin-bottom: 0.4rem;
}

.woodland-input-row {
  display: flex;
  gap: 0.5rem;
}

.woodland-input-row input,
.woodland-languages-modal-content .woodland-input-row input,
#woodland-custom-lang {
  flex: 1;
  padding: 0.5rem;
  border: 1px solid #4a7a4a;
  border-radius: 5px;
  background: #1a2a1a !important;
  color: #ddd !important;
  font-size: 0.9rem;
}

.woodland-input-row input:focus,
#woodland-custom-lang:focus {
  outline: none;
  border-color: #6a9a6a;
  box-shadow: 0 0 5px rgba(106, 154, 106, 0.4);
}

.woodland-input-row input::placeholder,
#woodland-custom-lang::placeholder {
  color: #666 !important;
}

.btn-add-lang {
  background: linear-gradient(135deg, #2a5a2a 0%, #3a7a3a 100%);
  border: 1px solid #4a8a4a;
  color: #fff;
  padding: 0.5rem 1rem;
  font-size: 0.85rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-add-lang:hover {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a9a4a 100%);
  box-shadow: 0 0 10px rgba(74, 138, 74, 0.4);
}

.woodland-examples-label {
  color: #888;
  font-size: 0.8rem;
  text-align: center;
  margin: 0.5rem 0;
}

.woodland-lang-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.woodland-lang-btn {
  background: linear-gradient(135deg, #2a4a2a 0%, #3a5a3a 100%);
  border: 1px solid #4a7a4a;
  color: #ccc;
  padding: 0.6rem 0.5rem;
  font-size: 0.8rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.woodland-lang-btn:hover:not(.disabled) {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a8a4a 100%);
  border-color: #6a9a6a;
  color: #fff;
  box-shadow: 0 0 10px rgba(106, 154, 106, 0.4);
}

.woodland-lang-btn.disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: linear-gradient(135deg, #2a3a2a 0%, #3a4a3a 100%);
  color: #888;
}

.woodland-modal-footer {
  display: flex;
  justify-content: center;
  padding-top: 0.5rem;
}

.woodland-modal-footer .btn-cancel {
  background: linear-gradient(135deg, #4a4a4a 0%, #5a5a5a 100%);
  border: 1px solid #666;
  color: #ccc;
  padding: 0.5rem 1.5rem;
  font-size: 0.85rem;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.woodland-modal-footer .btn-cancel:hover {
  background: linear-gradient(135deg, #5a5a5a 0%, #6a6a6a 100%);
  border-color: #888;
}

/* Special Abilities & Notes */
/* Abilities Sections Container - holds abilities in two columns */
.abilities-sections-container {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 1rem;
  width: 100%;
  align-items: start;
}

.abilities-left-column {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.abilities-right-column {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Grid layout for ability cards in right column */
.ability-cards-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
}

/* Divider before spell-like abilities */
.ability-cards-divider {
  border: none;
  border-top: 1px solid rgba(139, 74, 139, 0.5);
  margin: 0.25rem 0;
}

.class-abilities-section {
  background: rgba(255,255,255,0.2);
  padding: 0.5rem;
  border: 1px solid var(--border-light);
}

.class-abilities-section.full-width {
  grid-column: 1 / -1;
}

.species-abilities-section {
  background: rgba(255,255,255,0.2);
  padding: 0.5rem;
  border: 1px solid var(--border-light);
}

.species-abilities-list {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}

.species-ability-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.species-ability-input {
  flex: 1;
  padding: 0.35rem 0.3rem;
  font-size: 0.85rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-height: 1.8rem;
  box-sizing: border-box;
  color: var(--text-color);
}

.species-ability-input:read-only {
  background: rgba(255,255,255,0.5);
  cursor: default;
}

.species-ability-info-btn {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid var(--accent-color);
  background: white;
  color: var(--accent-color);
  font-size: 0.75rem;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.species-ability-info-btn:hover {
  background: var(--accent-color);
  color: white;
}

/* Dynamic Class Abilities List */
.class-abilities-list {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.15rem 0.4rem;
  padding-right: 0.25rem;
}

.class-ability-row {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.class-ability-input {
  flex: 1;
  padding: 0.35rem 0.3rem;
  font-size: 0.85rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-height: 1.8rem;
  box-sizing: border-box;
}

.class-ability-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

.class-ability-input.duplicate-warning {
  background-color: #fff3cd;
  border-color: #ffc107;
}

.class-ability-info-btn {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid var(--accent-color);
  background: white;
  color: var(--accent-color);
  font-size: 0.75rem;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.class-ability-info-btn:hover {
  background: var(--accent-color);
  color: white;
}

/* Add/Remove row buttons */
.btn-add-row, .btn-remove-row {
  width: 24px;
  height: 24px;
  padding: 0;
  font-size: 1.0rem;
  font-weight: bold;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-add-row {
  background: #5a8f5a;
  color: white;
  border: none;
}

.btn-add-row:hover {
  background: #4a7f4a;
}

.btn-remove-row {
  background: #8f5a5a;
  color: white;
  border: none;
}

.btn-remove-row:hover {
  background: #7f4a4a;
}

/* Class Abilities - bottom layout with scroll (legacy - keep for compatibility) */
.abilities-columns {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.4rem;
  margin-bottom: 0.5rem;
  max-height: 520px;
  overflow-y: auto;
  padding-right: 0.25rem;
}

/* Scrollbar styling for abilities */
.abilities-columns::-webkit-scrollbar {
  width: 8px;
}

.abilities-columns::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
  border-radius: 4px;
}

.abilities-columns::-webkit-scrollbar-thumb {
  background: var(--accent-color);
  border-radius: 4px;
}

.abilities-columns::-webkit-scrollbar-thumb:hover {
  background: var(--accent-dark);
}

.abilities-column {
  display: flex;
  flex-direction: column;
  gap: 0.08rem;
}

.ability-input {
  padding: 0.35rem 0.3rem;
  font-size: 0.85rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  min-height: 1.8rem;
  box-sizing: border-box;
}

.ability-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

.ability-input.duplicate-warning {
  background-color: #fff3cd;
  border-color: #ffc107;
}

.ability-input.duplicate-warning:focus {
  border-color: #e0a800;
}

.notes-textarea {
  width: 100%;
  min-height: 120px;
  padding: 0.4rem;
  font-family: var(--font-body);
  font-size: 0.82rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  resize: vertical;
}

.notes-textarea:focus {
  outline: none;
  border-color: var(--input-focus);
}

.notes-textarea.full-page {
  min-height: calc(100vh - 180px);
}

/* ============================================
   Notes Page - Rich Text Sections
   ============================================ */
.notes-page-content {
  padding: 1rem;
}

/* Rich Text Toolbar */
.notes-toolbar {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background: linear-gradient(to bottom, #f8f5f0, #ebe6dc);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  margin-bottom: 1rem;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.toolbar-group {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.toolbar-separator {
  width: 1px;
  height: 24px;
  background: var(--border-color);
  margin: 0 0.25rem;
}

.toolbar-btn {
  width: 32px;
  height: 32px;
  border: 1px solid var(--border-color);
  background: white;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  transition: all 0.15s ease;
}

.toolbar-btn:hover {
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

.toolbar-btn.active {
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

.toolbar-select {
  height: 32px;
  padding: 0 0.5rem;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: white;
  font-size: 0.85rem;
  cursor: pointer;
}

.toolbar-color {
  width: 32px;
  height: 32px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  cursor: pointer;
  padding: 2px;
}

/* Notes Layout Controls */
.notes-layout-controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
  padding: 0.5rem 0.75rem;
  background: rgba(0,0,0,0.03);
  border-radius: 6px;
  border: 1px dashed var(--border-color);
}

.notes-palette {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
  flex: 1;
}

.palette-label {
  font-size: 0.8rem;
  color: var(--text-secondary);
  font-weight: 500;
}

.palette-items {
  display: flex;
  flex-wrap: wrap;
  gap: 0.35rem;
}

.palette-item {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.5rem;
  background: white;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  font-size: 0.75rem;
  cursor: grab;
  transition: all 0.15s ease;
}

.palette-item:hover {
  background: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

.palette-item.dragging {
  opacity: 0.5;
}

.palette-item-icon {
  font-size: 0.85rem;
}

.palette-empty {
  font-size: 0.75rem;
  color: #999;
  font-style: italic;
}

.notes-layout-buttons {
  display: flex;
  gap: 0.5rem;
}

/* Notes Grid Layout */
.notes-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  min-height: 200px;
}

.notes-grid.drag-over {
  background: rgba(100, 149, 237, 0.1);
  border-radius: 8px;
}

@media (max-width: 900px) {
  .notes-grid {
    grid-template-columns: 1fr;
  }
}

/* Notes Section */
.notes-section {
  background: white;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  position: relative;
  transition: box-shadow 0.15s ease;
}

.notes-section.dragging {
  opacity: 0.5;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.notes-section.drag-over {
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px rgba(100, 149, 237, 0.3);
}

.notes-section-wide {
  grid-column: 1 / -1;
}

.notes-section-header {
  background: linear-gradient(to bottom, #f5f0e6, #ebe6dc);
  padding: 0.6rem 0.8rem;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 0.5rem;
}

.notes-section-drag-handle {
  cursor: grab;
  color: #999;
  font-size: 1rem;
  padding: 0.1rem 0.25rem;
  user-select: none;
  transition: color 0.15s;
}

.notes-section-drag-handle:hover {
  color: var(--accent-color);
}

.notes-section-drag-handle:active {
  cursor: grabbing;
}

.notes-section-header h3 {
  margin: 0;
  font-size: 1rem;
  color: var(--text-primary);
  font-family: var(--font-heading);
  flex: 1;
}

.notes-section-hint {
  font-size: 0.75rem;
  color: var(--text-secondary);
  font-style: italic;
  flex-basis: 100%;
  order: 10;
}

.notes-section-controls {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-left: auto;
}

.notes-section-btn {
  width: 24px;
  height: 24px;
  border: none;
  background: transparent;
  color: #888;
  font-size: 0.85rem;
  cursor: pointer;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}

.notes-section-btn:hover {
  background: rgba(0,0,0,0.08);
  color: var(--text-primary);
}

.notes-section-btn.btn-delete:hover {
  background: rgba(200, 0, 0, 0.1);
  color: #c00;
}

.notes-section-btn.btn-width.is-wide {
  color: var(--accent-color);
}

.notes-section-header .btn-add-entry {
  margin-left: 0;
}

/* Rich Text Editor - resizable */
.notes-editor {
  min-height: 100px;
  height: 180px;
  overflow-y: auto;
  padding: 0.75rem;
  font-family: var(--font-body);
  font-size: 0.9rem;
  line-height: 1.6;
  color: var(--text-primary);
  background: #fffef9;
  resize: vertical;
}

.notes-editor:focus {
  outline: none;
  background: #fffff5;
}

.notes-editor:empty:before {
  content: attr(data-placeholder);
  color: #999;
  font-style: italic;
  pointer-events: none;
}

.notes-editor h3 {
  font-size: 1.0rem;
  margin: 0.5rem 0;
  color: var(--accent-color);
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 0.25rem;
}

.notes-editor ul, .notes-editor ol {
  margin: 0.5rem 0;
  padding-left: 1.5rem;
}

.notes-editor li {
  margin-bottom: 0.25rem;
}

.notes-editor hr {
  border: none;
  border-top: 1px solid var(--border-color);
  margin: 0.75rem 0;
}

/* Journal section - resizable container */
.journal-section .journal-container {
  min-height: 200px;
  height: 350px;
  overflow-y: auto;
  resize: vertical;
}

/* Rich Text Editor */
/* Journal Section - Special Styling */
.journal-section {
  background: #f9f6f0;
}

.journal-container {
  max-height: 500px;
  overflow-y: auto;
  padding: 0;
}

.journal-page {
  background: linear-gradient(to right, #f5f0e0 0%, #faf8f2 2%, #faf8f2 98%, #f5f0e0 100%);
  min-height: 400px;
  position: relative;
}

.journal-page::before {
  content: '';
  position: absolute;
  left: 40px;
  top: 0;
  bottom: 0;
  width: 1px;
  background: rgba(200, 100, 100, 0.3);
}

.journal-entries {
  padding: 1rem 1rem 1rem 50px;
}

/* Journal Entry */
.journal-entry {
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px dashed #ccc;
  position: relative;
}

.journal-entry:last-child {
  border-bottom: none;
}

.journal-entry-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.journal-entry-date {
  font-family: 'Cinzel', var(--font-heading), serif;
  font-size: 0.85rem;
  color: #8b4513;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.journal-entry-date input {
  border: none;
  background: transparent;
  font-family: inherit;
  font-size: inherit;
  color: inherit;
  font-weight: inherit;
  width: 140px;
  padding: 0.1rem 0.25rem;
  border-bottom: 1px dashed transparent;
}

.journal-entry-date input:focus {
  outline: none;
  border-bottom-color: #8b4513;
}

.journal-entry-title {
  flex: 1;
}

.journal-entry-title input {
  width: 100%;
  border: none;
  background: transparent;
  font-family: 'Cinzel', var(--font-heading), serif;
  font-size: 1rem;
  font-weight: 600;
  color: #5d4037;
  padding: 0.1rem 0.25rem;
  border-bottom: 1px dashed transparent;
}

.journal-entry-title input:focus {
  outline: none;
  border-bottom-color: #5d4037;
}

.journal-entry-title input::placeholder {
  color: #a99;
  font-style: italic;
}

.btn-delete-entry {
  width: 24px;
  height: 24px;
  border: none;
  background: transparent;
  color: #c00;
  font-size: 1.0rem;
  cursor: pointer;
  opacity: 0.5;
  transition: opacity 0.15s;
  border-radius: 4px;
}

.btn-delete-entry:hover {
  opacity: 1;
  background: rgba(200, 0, 0, 0.1);
}

.journal-entry-content {
  min-height: 60px;
  font-family: 'Georgia', var(--font-body), serif;
  font-size: 0.95rem;
  line-height: 1.8;
  color: #333;
  background: linear-gradient(transparent, transparent 1.7em, #e8e4da 1.7em);
  background-size: 100% 1.8em;
  padding: 0.25rem;
}

.journal-entry-content:focus {
  outline: none;
  background-color: rgba(255, 255, 200, 0.2);
}

.journal-entry-content:empty:before {
  content: 'Write about this session...';
  color: #a99;
  font-style: italic;
}

/* Journal decorative elements */
.journal-entry::before {
  content: '';
  position: absolute;
  left: -30px;
  top: 0.4rem;
  color: #8b4513;
  font-size: 0.8rem;
}

/* Empty journal state */
.journal-empty {
  text-align: center;
  padding: 3rem 1rem;
  color: #999;
  font-style: italic;
}

.journal-empty-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

/* Add Entry Button */
.btn-add-entry {
  background: var(--btn-primary-bg);
  color: white;
  border: none;
  padding: 0.3rem 0.6rem;
  border-radius: 4px;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.15s;
}

.btn-add-entry:hover {
  background: var(--btn-primary-hover);
}

/* Dark theme adjustments */
[data-theme="dark"] .notes-layout-controls {
  background: rgba(255,255,255,0.03);
  border-color: #444;
}

[data-theme="dark"] .palette-item {
  background: #444;
  border-color: #555;
  color: #ddd;
}

[data-theme="dark"] .palette-item:hover {
  background: var(--accent-color);
  border-color: var(--accent-color);
}

[data-theme="dark"] .notes-toolbar {
  background: linear-gradient(to bottom, #3a3a3a, #2d2d2d);
}

[data-theme="dark"] .toolbar-btn {
  background: #444;
  border-color: #555;
  color: #ddd;
}

[data-theme="dark"] .toolbar-btn:hover {
  background: var(--accent-color);
}

[data-theme="dark"] .toolbar-select {
  background: #444;
  border-color: #555;
  color: #ddd;
}

[data-theme="dark"] .notes-section {
  background: #2d2d2d;
  border-color: #444;
}

[data-theme="dark"] .notes-section-header {
  background: linear-gradient(to bottom, #3a3a3a, #333);
  border-color: #444;
}

[data-theme="dark"] .notes-editor {
  background: #252525;
  color: #ddd;
}

[data-theme="dark"] .notes-editor:focus {
  background: #2a2a2a;
}

[data-theme="dark"] .journal-page {
  background: linear-gradient(to right, #2a2520 0%, #332d28 2%, #332d28 98%, #2a2520 100%);
}

[data-theme="dark"] .journal-page::before {
  background: rgba(200, 100, 100, 0.2);
}

[data-theme="dark"] .journal-entry-date,
[data-theme="dark"] .journal-entry-date input {
  color: #c9a86c;
}

[data-theme="dark"] .journal-entry-title input {
  color: #d4c4a8;
}

[data-theme="dark"] .journal-entry-content {
  background: linear-gradient(transparent, transparent 1.7em, #3a352f 1.7em);
  color: #ccc;
}

/* ============================================
   Page 4 & 5: Magic
   ============================================ */
/* Magic Points Display Bar (shown on spell pages) */
.magic-mp-bar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  margin: 0.3rem auto 0.6rem;
  padding: 0.4rem 1.2rem;
  background: linear-gradient(135deg, #2a1f0f 0%, #3d2e1a 100%);
  border: 2px solid #8b7332;
  border-radius: 8px;
  width: fit-content;
  box-shadow: 0 0 12px rgba(139, 115, 50, 0.3), inset 0 1px 0 rgba(255, 215, 0, 0.1);
}

.magic-mp-label {
  font-family: var(--font-header);
  font-size: 0.85rem;
  color: #c0a858;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.magic-mp-current {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1a1a1a;
  min-width: 3.5rem;
  width: 3.5rem;
  text-align: center;
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 215, 0, 0.4);
  border-radius: 4px;
  padding: 0.15rem 0.25rem;
  font-family: inherit;
  -moz-appearance: textfield;
}

.magic-mp-current::-webkit-inner-spin-button,
.magic-mp-current::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.magic-mp-current:focus {
  outline: none;
  border-color: #ffd700;
  background: rgba(255, 255, 255, 0.25);
}

.magic-mp-separator {
  font-size: 1.1rem;
  color: #8b7332;
}

.magic-mp-max {
  font-size: 1rem;
  color: #a08840;
  min-width: 2ch;
}

.magic-mp-bar.mp-low .magic-mp-current {
  color: #cc3333;
}

.magic-mp-bar.mp-empty .magic-mp-current {
  color: #cc0000;
  animation: mpPulse 1.5s ease-in-out infinite;
}

@keyframes mpPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.magic-skills-section {
  margin-bottom: 1rem;
}

.magic-skills-table {
  width: 100%;
  border-collapse: collapse;
}

.magic-skills-table th,
.magic-skills-table td {
  padding: 0.15rem 0.2rem;
  border: 1px solid var(--border-light);
}

.magic-skills-table th {
  background: rgba(0,0,0,0.08);
  font-family: var(--font-header);
  font-weight: 700;
  font-size: 1rem;
  color: var(--text-header);
}

.magic-skills-table td {
  font-size: 0.95rem;
  color: var(--text-secondary);
}

.class-note {
  font-size: 0.7rem;
  font-style: italic;
  color: var(--text-secondary);
}

.base-calc {
  font-size: 0.9rem;
  color: var(--text-secondary);
  text-align: center;
}

.magic-skill-input {
  width: 100%;
  padding: 0.4rem 0.4rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.magic-skill-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Casting skill name with prereq key */
.casting-skill-name {
  margin-right: 0.25rem;
}

.prereq-key-slot {
  display: inline-flex;
  gap: 2px;
  vertical-align: middle;
}

.prereq-key-slot .prereq-key {
  width: 14px;
  height: 14px;
  vertical-align: middle;
}

.deity-input {
  /* Only used in magic table - header deity uses field-input naturally */
}

.deity-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Magic table deity column  compact */
.magic-deity-col {
  min-width: 80px;
  max-width: 120px;
}

.magic-deity-col .deity-input {
  padding: 0.2rem 0.3rem;
  font-size: 0.78rem;
}

.syrin-note {
  font-size: 0.85rem;
  font-style: italic;
  color: var(--text-secondary);
  margin-top: 0.25rem;
}

/* Rank 1 Paladin/Ranger cannot cast magic note */
.rank1-spell-note {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  background: #fff8e1;
  border: 1px solid #f9a825;
  border-left: 4px solid #e65100;
  border-radius: 4px;
  padding: 0.6rem 1rem;
  margin: 0.5rem 0;
  font-size: 0.9rem;
  color: #4e342e;
}

.rank1-spell-note-icon {
  font-size: 1.2rem;
  flex-shrink: 0;
}

.rank1-spell-note-text {
  line-height: 1.4;
}

/* Spell Actions */
.spell-actions {
  margin-bottom: 0.5rem;
  text-align: right;
}

.btn-alphabetize {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  background: var(--bg-medium);
  border: 1px solid var(--border-dark);
  color: var(--text-dark);
  cursor: pointer;
  border-radius: 3px;
}

.btn-alphabetize:hover {
  background: var(--bg-dark);
  color: white;
}

/* Spell Columns */
.spell-columns {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
}

.spell-column {
  background: rgba(255,255,255,0.2);
  padding: 0.5rem;
  border: 1px solid var(--border-light);
}

.spell-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.25rem;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid var(--border-gold);
}

.spell-header-row .spell-rank-header {
  margin: 0;
  padding: 0;
  border: none;
  text-align: left;
}

.spell-header-row .btn-alphabetize {
  padding: 0.15rem 0.4rem;
  font-size: 0.7rem;
}

.spell-rank-header {
  font-family: var(--font-header);
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text-header);
  text-align: center;
  margin: 0 0 0.25rem 0;
  padding-bottom: 0.25rem;
  border-bottom: 1px solid var(--border-gold);
}

.memorize-count {
  font-size: 0.72rem;
  text-align: center;
  margin-bottom: 0.25rem;
}

.memorize-input {
  width: 45px;
  padding: 0.2rem 0.3rem;
  font-size: 0.85rem;
  text-align: center;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
}

.memorize-input[readonly] {
  background: var(--row-alt);
  cursor: default;
  font-weight: 600;
}

.memorize-input:focus {
  outline: none;
  border-color: var(--input-focus);
}

/* Spell Fill/Clear Action Buttons */
.spell-actions-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  margin-bottom: 0.35rem;
  padding: 0.25rem 0;
}

.spell-actions-bar .btn-fill-spells,
.spell-actions-bar .btn-clear-spells {
  font-size: 0.65rem;
  padding: 0.15rem 0.4rem;
  border-radius: 3px;
  cursor: pointer;
  border: 1px solid var(--border-light);
  line-height: 1.2;
  white-space: nowrap;
}

.spell-actions-bar .btn-fill-spells {
  background: var(--input-bg);
  color: var(--text-primary);
}

.spell-actions-bar .btn-fill-spells:hover {
  background: var(--highlight-bg, #e8f0fe);
  border-color: var(--input-focus);
}

.spell-actions-bar .btn-clear-spells {
  background: var(--input-bg);
  color: #a33;
  border-color: #d8a0a0;
  margin-left: auto;
}

.spell-actions-bar .btn-clear-spells:hover {
  background: #fde8e8;
  border-color: #c66;
}

/* Swap Spell Button */
.spell-actions-bar .btn-swap-spell {
  font-size: 0.65rem;
  padding: 0.15rem 0.4rem;
  border-radius: 3px;
  cursor: pointer;
  border: 1px solid rgba(80, 160, 255, 0.4);
  line-height: 1.2;
  white-space: nowrap;
  background: rgba(80, 160, 255, 0.08);
  color: #1a5aa0;
}

.spell-actions-bar .btn-swap-spell:hover {
  background: rgba(80, 160, 255, 0.18);
  border-color: rgba(80, 160, 255, 0.6);
}

/*  Spell Picker Modal  */
.spell-picker-modal-content {
  max-width: 480px;
  width: 90vw;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
}

.spell-picker-toolbar {
  padding: 0.5rem 1rem;
  border-bottom: 1px solid var(--border-light, rgba(139, 115, 85, 0.2));
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.spell-picker-search {
  flex: 1;
  padding: 0.35rem 0.6rem;
  border: 1px solid var(--border-light, rgba(139, 115, 85, 0.3));
  border-radius: 5px;
  font-size: 0.85rem;
  background: var(--input-bg, #fff);
  color: var(--text-primary, #333);
}

.spell-picker-search:focus {
  outline: none;
  border-color: var(--input-focus, #6a5acd);
  box-shadow: 0 0 0 2px rgba(106, 90, 205, 0.15);
}

.spell-picker-count {
  font-size: 0.78rem;
  color: #888;
  white-space: nowrap;
}

.spell-picker-list {
  flex: 1;
  overflow-y: auto;
  padding: 0.4rem 0.6rem;
  max-height: 50vh;
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
}

.spell-pick-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.3rem 0.5rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.88rem;
  transition: background 0.1s;
}

.spell-pick-row:hover {
  background: rgba(106, 90, 205, 0.08);
}

.spell-pick-row.spell-pick-existing {
  opacity: 0.5;
  cursor: default;
}

.spell-pick-row.spell-pick-existing:hover {
  background: transparent;
}

.spell-pick-cb,
.spell-swap-radio {
  width: 16px;
  height: 16px;
  accent-color: #6a5acd;
  cursor: pointer;
  flex-shrink: 0;
}

.spell-pick-name {
  flex: 1;
}

.spell-pick-tag {
  font-size: 0.68rem;
  color: #999;
  font-style: italic;
}

.spell-swap-step-label {
  padding: 0.5rem 1rem;
  font-size: 0.88rem;
  color: #6b5344;
  background: rgba(139, 115, 85, 0.06);
  border-bottom: 1px solid rgba(139, 115, 85, 0.15);
}

/*  Add Sorcerer Spell Button  */
.spell-actions-bar .btn-add-sorcerer-spell {
  font-size: 0.65rem;
  padding: 0.15rem 0.4rem;
  border-radius: 3px;
  cursor: pointer;
  border: 1px solid rgba(138, 80, 220, 0.4);
  line-height: 1.2;
  white-space: nowrap;
  background: rgba(138, 80, 220, 0.1);
  color: #9070c0;
}

.spell-actions-bar .btn-add-sorcerer-spell:hover {
  background: rgba(138, 80, 220, 0.2);
  border-color: rgba(138, 80, 220, 0.6);
}

/*  Sorcerer Add Spell Options  */
.sorc-add-options {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.sorc-add-option-btn {
  display: flex;
  align-items: center;
  gap: 0.7rem;
  padding: 0.6rem 0.8rem;
  background: rgba(138, 80, 220, 0.08);
  border: 1px solid rgba(138, 80, 220, 0.25);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
}

.sorc-add-option-btn:hover {
  background: rgba(138, 80, 220, 0.18);
  border-color: rgba(138, 80, 220, 0.45);
}

.sorc-add-icon {
  font-size: 1.3rem;
  flex-shrink: 0;
}

.sorc-add-label {
  font-weight: 700;
  font-size: 0.90rem;
  color: #c0a0e0;
  display: block;
}

.sorc-add-desc {
  font-size: 0.75rem;
  color: #999;
  display: block;
}

.spell-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95rem;
}

.spell-table th,
.spell-table td {
  padding: 0.15rem 0.2rem;
  border: 1px solid var(--border-light);
}

.spell-table th {
  background: rgba(0,0,0,0.08);
  font-weight: 600;
  font-size: 0.8rem;
}

.col-memorized {
  width: 22px;
  text-align: center;
}

.col-spell {
  text-align: left;
}

.col-cost {
  width: auto;
  min-width: 100px;
  text-align: center;
}

.spell-table input[type="checkbox"] {
  width: 14px;
  height: 14px;
  cursor: pointer;
}

.spell-table input[type="text"] {
  width: 100%;
  padding: 0.4rem 0.4rem;
  border: 1px solid var(--input-border);
  background: var(--input-bg);
  box-sizing: border-box;
}

.spell-table input[type="text"]:focus {
  outline: none;
  border-color: var(--input-focus);
}

.spell-table input.spell-cost {
  text-align: center;
}

/* Cast Spell Button */
.col-cast {
  width: 36px;
  text-align: center;
}

.spell-cast-cell {
  text-align: center;
  padding: 0.1rem !important;
}

.btn-cast-spell {
  width: 28px;
  height: 28px;
  padding: 0;
  border: 1px solid var(--border-light);
  background: var(--input-bg);
  color: var(--text-secondary);
  font-size: 0.9rem;
  line-height: 1;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.15s ease;
}

.btn-cast-spell:hover {
  background: #e8e0d0;
  border-color: var(--border-gold);
  color: var(--text-header);
}

.btn-cast-spell.cast-success {
  background: #d4edda;
  border-color: #28a745;
  color: #155724;
}

.btn-cast-spell.cast-fail {
  background: #f8d7da;
  border-color: #dc3545;
  color: #721c24;
}

.btn-cast-spell.cast-no-cost {
  background: #fff3cd;
  border-color: #ffc107;
  color: #856404;
}

/* ==================== SPELL SUCCESS FULLSCREEN ANIMATIONS ==================== */

.spell-success-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10001;
  opacity: 0;
  transition: opacity 0.25s ease;
  pointer-events: none;
}
.spell-success-overlay.active { opacity: 1; }
.spell-success-overlay.fade-out { opacity: 0; transition: opacity 0.35s ease; }

/* Background tints per casting type */
.spell-anim-divine { background: radial-gradient(ellipse at center, rgba(255,215,0,0.25), rgba(0,0,0,0.6) 70%); }
.spell-anim-arcane { background: radial-gradient(ellipse at center, rgba(106,90,205,0.25), rgba(0,0,0,0.6) 70%); }
.spell-anim-sorcery { background: radial-gradient(ellipse at center, rgba(178,34,34,0.25), rgba(0,0,0,0.6) 70%); }
.spell-anim-bardic { background: radial-gradient(ellipse at center, rgba(46,139,87,0.25), rgba(0,0,0,0.6) 70%); }
.spell-anim-critical { background: radial-gradient(ellipse at center, rgba(255,255,200,0.35), rgba(0,0,0,0.5) 70%) !important; }

.spell-success-content {
  position: relative;
  width: 280px; height: 280px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/* Central burst */
.spell-burst {
  position: absolute;
  width: 120px; height: 120px;
  border-radius: 50%;
  animation: spellBurstPulse 0.7s ease-out infinite alternate;
}
.spell-anim-divine .spell-burst { background: radial-gradient(circle, #fff8dc 0%, #ffd700 40%, transparent 70%); }
.spell-anim-arcane .spell-burst { background: radial-gradient(circle, #e8e0ff 0%, #6a5acd 40%, transparent 70%); }
.spell-anim-sorcery .spell-burst { background: radial-gradient(circle, #ffe0e0 0%, #dc143c 40%, transparent 70%); }
.spell-anim-bardic .spell-burst { background: radial-gradient(circle, #e0ffe0 0%, #2e8b57 40%, transparent 70%); }
.spell-anim-critical .spell-burst {
  width: 160px; height: 160px;
  background: radial-gradient(circle, #ffffff 0%, #ffd700 30%, #ff8c00 60%, transparent 70%) !important;
}

@keyframes spellBurstPulse {
  from { transform: scale(0.6); opacity: 1; }
  to { transform: scale(1.3); opacity: 0.7; }
}

/* Expanding ring */
.spell-ring {
  position: absolute;
  width: 80px; height: 80px;
  border-radius: 50%;
  border: 3px solid;
  animation: spellRingExpand 1.2s ease-out forwards;
}
.spell-anim-divine .spell-ring { border-color: rgba(255,215,0,0.8); box-shadow: 0 0 15px rgba(255,215,0,0.5); }
.spell-anim-arcane .spell-ring { border-color: rgba(138,43,226,0.8); box-shadow: 0 0 15px rgba(138,43,226,0.5); }
.spell-anim-sorcery .spell-ring { border-color: rgba(220,20,60,0.8); box-shadow: 0 0 15px rgba(220,20,60,0.5); }
.spell-anim-bardic .spell-ring { border-color: rgba(60,179,113,0.8); box-shadow: 0 0 15px rgba(60,179,113,0.5); }
.spell-anim-critical .spell-ring {
  border-width: 4px;
  border-color: rgba(255,255,200,0.9) !important;
  box-shadow: 0 0 25px rgba(255,215,0,0.7), 0 0 50px rgba(255,200,0,0.3) !important;
}

@keyframes spellRingExpand {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(4); opacity: 0; }
}

/* Particles container */
.spell-particles-container {
  position: absolute;
  width: 200px; height: 200px;
}

/* Individual particles */
.spell-particle {
  position: absolute;
  width: 6px; height: 6px;
  border-radius: 50%;
  left: 50%; top: 50%;
  animation: spellParticleFly 1s ease-out forwards;
  animation-delay: calc(var(--i) * 0.06s);
  opacity: 0;
}

.sp-divine { background: #ffd700; box-shadow: 0 0 6px #ffd700; }
.sp-arcane { background: #b088ff; box-shadow: 0 0 6px #8a2be2; }
.sp-sorcery { background: #ff4444; box-shadow: 0 0 6px #dc143c; }
.sp-bardic { background: #50c878; box-shadow: 0 0 6px #2e8b57; }

.spell-anim-critical .spell-particle {
  width: 8px; height: 8px;
  background: #fff8dc !important;
  box-shadow: 0 0 10px #ffd700 !important;
}

@keyframes spellParticleFly {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) rotate(calc(var(--i) * 45deg)) translateY(0);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) rotate(calc(var(--i) * 45deg)) translateY(-120px);
  }
}

/* Icon */
.spell-success-icon {
  font-size: 3rem;
  z-index: 1;
  animation: spellIconPulse 0.4s ease-in-out infinite alternate;
}
.spell-anim-divine .spell-success-icon { filter: drop-shadow(0 0 15px #ffd700); color: #ffd700; }
.spell-anim-arcane .spell-success-icon { filter: drop-shadow(0 0 15px #8a2be2); color: #b088ff; }
.spell-anim-sorcery .spell-success-icon { filter: drop-shadow(0 0 15px #dc143c); color: #ff6666; }
.spell-anim-bardic .spell-success-icon { filter: drop-shadow(0 0 15px #2e8b57); color: #50c878; }
.spell-anim-critical .spell-success-icon {
  font-size: 4rem;
  filter: drop-shadow(0 0 25px #ffd700) drop-shadow(0 0 50px #ff8c00) !important;
  color: #fff8dc !important;
}

@keyframes spellIconPulse {
  from { transform: scale(1); }
  to { transform: scale(1.15); }
}

/* Text */
.spell-success-text {
  margin-top: 0.8rem;
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 0.05em;
  z-index: 1;
}
.spell-anim-divine .spell-success-text { color: #ffffff; text-shadow: 0 0 10px #ffd700, 0 0 20px #ff8c00, 0 1px 3px rgba(0,0,0,0.6); }
.spell-anim-arcane .spell-success-text { color: #d4c4ff; text-shadow: 0 0 10px #8a2be2, 0 0 20px #6a5acd; }
.spell-anim-sorcery .spell-success-text { color: #ff9999; text-shadow: 0 0 10px #dc143c, 0 0 20px #b22222; }
.spell-anim-bardic .spell-success-text { color: #90eeb0; text-shadow: 0 0 10px #2e8b57, 0 0 20px #3cb371; }
.spell-anim-critical .spell-success-text {
  font-size: 1.3rem;
  color: #ffffff !important;
  text-shadow: 0 0 15px #ffd700, 0 0 30px #ff8c00, 0 0 50px #ffd700, 0 1px 3px rgba(0,0,0,0.6) !important;
}

/* ==================== SPELL CASTING MODAL ==================== */
.cast-modal-content {
  max-width: 420px;
  width: 94%;
  min-height: auto;
  max-height: 90vh;
  overflow: hidden;
  position: relative;
  border: none;
  border-radius: 10px;
  box-shadow: 0 12px 50px rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
}

.cast-modal-scroll {
  overflow-y: auto;
  flex: 1;
  position: relative;
  z-index: 2;
}

.cast-modal-theme-border {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border-radius: 10px;
  pointer-events: none;
  z-index: 1;
  border: 2px solid var(--border-gold);
  transition: border-color 0.3s, box-shadow 0.3s;
}

/* Casting type themes */
.cast-modal-content.theme-divine .cast-modal-theme-border {
  border-color: #daa520;
  box-shadow: inset 0 0 20px rgba(218, 165, 32, 0.15), 0 0 15px rgba(218, 165, 32, 0.2);
}
.cast-modal-content.theme-arcane .cast-modal-theme-border {
  border-color: #6a5acd;
  box-shadow: inset 0 0 20px rgba(106, 90, 205, 0.15), 0 0 15px rgba(106, 90, 205, 0.2);
}
.cast-modal-content.theme-sorcery .cast-modal-theme-border {
  border-color: #b22222;
  box-shadow: inset 0 0 20px rgba(178, 34, 34, 0.15), 0 0 15px rgba(178, 34, 34, 0.2);
}
.cast-modal-content.theme-bardic .cast-modal-theme-border {
  border-color: #2e8b57;
  box-shadow: inset 0 0 20px rgba(46, 139, 87, 0.15), 0 0 15px rgba(46, 139, 87, 0.2);
}

/* Header */
.cast-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 0.75rem 1rem 0.6rem;
  border-bottom: 1px solid rgba(139, 115, 85, 0.3);
  position: relative;
  z-index: 2;
}

/* Multiclass selector */
.cast-modal-class-select {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.35rem 1rem;
  border-bottom: 1px solid rgba(139, 115, 85, 0.2);
  background: rgba(139, 115, 85, 0.06);
  position: relative;
  z-index: 2;
}

.cast-class-label {
  font-size: 0.78rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #8b7355;
  white-space: nowrap;
}

.cast-class-options {
  display: flex;
  gap: 0.3rem;
  flex-wrap: wrap;
}

.cast-class-btn {
  padding: 0.2rem 0.6rem;
  border: 1px solid rgba(139, 115, 85, 0.3);
  background: rgba(255, 255, 255, 0.4);
  color: #6b5344;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 12px;
  transition: all 0.15s;
}
.cast-class-btn:hover {
  background: rgba(139, 115, 85, 0.12);
  border-color: rgba(139, 115, 85, 0.5);
}
.cast-class-btn.active {
  background: rgba(139, 115, 85, 0.2);
  border-color: #8b7355;
  color: #4a3a2a;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
/* Theme-colored active states */
.theme-divine .cast-class-btn.active { border-color: #daa520; background: rgba(218,165,32,0.15); }
.theme-arcane .cast-class-btn.active { border-color: #6a5acd; background: rgba(106,90,205,0.15); }
.theme-sorcery .cast-class-btn.active { border-color: #b22222; background: rgba(178,34,34,0.15); }
.theme-bardic .cast-class-btn.active { border-color: #2e8b57; background: rgba(46,139,87,0.15); }

.cast-modal-title-row {
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
  flex: 1;
}

.cast-modal-school {
  font-size: 0.78rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #8b7355;
  font-weight: 600;
}

.cast-modal-spell-name {
  font-family: var(--font-header);
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-header);
  margin: 0;
  line-height: 1.2;
}

.cast-modal-rank-badge {
  display: inline-block;
  font-size: 0.72rem;
  font-weight: 700;
  padding: 0.15rem 0.5rem;
  border-radius: 10px;
  background: rgba(139, 115, 85, 0.15);
  color: #6b5344;
  align-self: flex-start;
  margin-top: 0.2rem;
  letter-spacing: 0.03em;
}

/* Stat Block */
.cast-modal-stats {
  padding: 0.5rem 1rem;
  border-bottom: 1px solid rgba(139, 115, 85, 0.2);
  background: rgba(139, 115, 85, 0.04);
  position: relative;
  z-index: 2;
}

.cast-stat-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0.3rem 0.8rem;
}

.cast-stat {
  display: flex;
  flex-direction: column;
}

.cast-stat-label {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: #8b7355;
  font-weight: 600;
  line-height: 1;
}

.cast-stat-value {
  font-size: 0.88rem;
  color: #2a2520;
  font-weight: 500;
  line-height: 1.3;
}

.cast-stat-value.scaled {
  color: #6a5acd;
  font-weight: 700;
}

.cast-stat-value.stat-time-increased {
  color: #c8503c;
  font-weight: 700;
}

.stat-time-stepped {
  color: #c8503c;
  font-weight: 700;
}

/* Intensity Controls */
.cast-modal-intensity {
  padding: 0.5rem 1rem;
  border-bottom: 1px solid rgba(139, 115, 85, 0.2);
  background: rgba(139, 115, 85, 0.06);
  position: relative;
  z-index: 2;
}

.intensity-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.intensity-label {
  font-size: 0.82rem;
  font-weight: 700;
  text-transform: uppercase;
  color: #6b5344;
  letter-spacing: 0.05em;
  min-width: 60px;
}

.btn-intensity {
  width: 26px;
  height: 26px;
  border: 1px solid rgba(139, 115, 85, 0.4);
  background: rgba(255, 255, 255, 0.5);
  color: #6b5344;
  font-size: 0.7rem;
  cursor: pointer;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}
.btn-intensity:hover { background: rgba(139, 115, 85, 0.15); }
.btn-intensity:disabled { opacity: 0.3; cursor: not-allowed; }

.intensity-value {
  font-size: 1.2rem;
  font-weight: 800;
  color: #2a2520;
  min-width: 24px;
  text-align: center;
}

.intensity-max {
  font-size: 0.82rem;
  color: #8b7355;
}

.intensity-info-row {
  display: flex;
  gap: 1rem;
  margin-top: 0.25rem;
  font-size: 0.8rem;
  color: #6b5344;
}

.intensity-cost-display { font-weight: 600; }
.intensity-magnitude-display { opacity: 0.8; }

/* Armor Warning */
.cast-modal-armor-warning {
  padding: 0.5rem 1rem;
  background: #fff3cd;
  border-bottom: 1px solid #ffc107;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  position: relative;
  z-index: 2;
}
.cast-modal-armor-warning.blocked {
  background: #f8d7da;
  border-bottom-color: #dc3545;
}
.armor-warning-icon { font-size: 1rem; }
.armor-warning-text { font-size: 0.82rem; color: #856404; font-weight: 500; }
.cast-modal-armor-warning.blocked .armor-warning-text { color: #721c24; }

/* Non-Memorized Casting Info */
.cast-modal-nonmem {
  padding: 0.5rem 1rem;
  border-bottom: 1px solid rgba(139, 115, 85, 0.2);
  background: rgba(200, 120, 50, 0.08);
  position: relative;
  z-index: 2;
}

.cast-nonmem-badge {
  display: inline-block;
  padding: 0.15rem 0.5rem;
  background: rgba(200, 120, 50, 0.2);
  border: 1px solid rgba(200, 120, 50, 0.4);
  border-radius: 10px;
  font-size: 0.68rem;
  font-weight: 800;
  letter-spacing: 0.08em;
  color: #a0522d;
  margin-bottom: 0.3rem;
}

.cast-nonmem-details {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  font-size: 0.8rem;
  margin-bottom: 0.4rem;
}

.cast-nonmem-difficulty {
  font-weight: 700;
  color: #c8503c;
  font-size: 0.82rem;
  background: rgba(200, 80, 60, 0.08);
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
  border-left: 3px solid rgba(200, 80, 60, 0.4);
}

.cast-nonmem-time {
  color: #6b5344;
  font-style: normal;
  display: flex;
  align-items: center;
  gap: 0.35rem;
  flex-wrap: wrap;
}

.cast-nonmem-time-label {
  font-weight: 600;
  color: #7a6652;
  font-size: 0.8rem;
}

.cast-nonmem-time-base {
  text-decoration: line-through;
  color: #a09080;
  font-size: 0.8rem;
}

.cast-nonmem-time-arrow {
  color: #c8503c;
  font-weight: 700;
  font-size: 0.85rem;
  animation: time-arrow-pulse 1.5s ease-in-out 3;
}

.cast-nonmem-time-stepped {
  font-weight: 800;
  color: #c8503c;
  font-size: 0.85rem;
  background: rgba(200, 80, 60, 0.1);
  padding: 0.1rem 0.4rem;
  border-radius: 4px;
  border: 1px solid rgba(200, 80, 60, 0.25);
}

@keyframes time-arrow-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

.cast-nonmem-rules {
  font-size: 0.78rem;
  color: #7a6652;
  line-height: 1.3;
}

/*  Fumble Skill Loss Overlay  */
.fumble-skill-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(20, 10, 5, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10100;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

.fumble-skill-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

.fumble-skill-content {
  background: linear-gradient(135deg, #2a1a10 0%, #1a0e08 100%);
  border: 2px solid #8b2500;
  border-radius: 12px;
  padding: 2rem 2.5rem;
  text-align: center;
  max-width: 360px;
  width: 90%;
  box-shadow: 0 0 40px rgba(139, 37, 0, 0.4), 0 0 80px rgba(139, 37, 0, 0.15);
  animation: fumble-overlay-appear 0.5s ease;
}

@keyframes fumble-overlay-appear {
  from { transform: scale(0.8) translateY(20px); opacity: 0; }
  to { transform: scale(1) translateY(0); opacity: 1; }
}

.fumble-skill-icon {
  font-size: 2.5rem;
  margin-bottom: 0.8rem;
  filter: drop-shadow(0 0 8px rgba(255, 120, 0, 0.6));
}

.fumble-skill-message {
  color: #e8c8a0;
  font-size: 1rem;
  font-style: italic;
  line-height: 1.5;
  margin-bottom: 1.2rem;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

.fumble-skill-roll-section {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.fumble-skill-roll-label {
  color: #a08060;
  font-size: 0.9rem;
  font-weight: 600;
}

.fumble-skill-roll-number {
  font-size: 2rem;
  font-weight: 900;
  color: #ff4444;
  min-width: 2.5rem;
  text-align: center;
  text-shadow: 0 0 12px rgba(255, 68, 68, 0.6);
  transition: color 0.3s ease;
}

.fumble-skill-roll-number.rolling {
  animation: fumble-roll-flash 0.12s steps(1) infinite;
}

@keyframes fumble-roll-flash {
  0% { color: #ff4444; text-shadow: 0 0 12px rgba(255, 68, 68, 0.6); }
  50% { color: #ffaa44; text-shadow: 0 0 12px rgba(255, 170, 68, 0.6); }
}

.fumble-skill-result {
  color: #ff6b6b;
  font-size: 0.95rem;
  font-weight: 700;
  min-height: 1.4rem;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.fumble-skill-result.visible {
  opacity: 1;
}

.fumble-skill-close {
  margin-top: 1.2rem;
  padding: 0.5rem 2rem;
  background: rgba(139, 37, 0, 0.3);
  border: 1px solid rgba(139, 37, 0, 0.6);
  border-radius: 6px;
  color: #e8c8a0;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.fumble-skill-close:hover {
  background: rgba(139, 37, 0, 0.5);
  border-color: #c84000;
}

/* Description */
.cast-modal-description {
  padding: 0.6rem 1rem;
  border-bottom: 1px solid rgba(139, 115, 85, 0.2);
  position: relative;
  z-index: 2;
}

.cast-flavor-text {
  font-size: 0.78rem;
  font-style: italic;
  color: #5a4a3a;
  line-height: 1.4;
  margin-bottom: 0.3rem;
}

.btn-toggle-desc {
  background: none;
  border: none;
  color: #8b7355;
  font-size: 0.7rem;
  cursor: pointer;
  padding: 0.2rem 0;
  text-decoration: underline;
  font-weight: 500;
}
.btn-toggle-desc:hover { color: #6b5344; }

.cast-full-desc {
  font-size: 0.75rem;
  color: #3a3025;
  line-height: 1.5;
  margin-top: 0.4rem;
  padding: 0.5rem;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 4px;
  border: 1px solid rgba(139, 115, 85, 0.15);
  max-height: 180px;
  overflow-y: auto;
}

/* Spell description HTML tables */
.cast-full-desc table {
  width: 100%;
  border-collapse: collapse;
  margin: 0.4rem 0 0.2rem;
  font-size: 0.7rem;
}
.cast-full-desc table caption {
  text-align: left;
  font-weight: 700;
  font-size: 0.72rem;
  color: #5a4a3a;
  padding-bottom: 0.2rem;
}
.cast-full-desc th,
.cast-full-desc td {
  border: 1px solid rgba(139, 115, 85, 0.3);
  padding: 0.15rem 0.35rem;
  text-align: left;
  vertical-align: top;
}
.cast-full-desc th {
  background: rgba(139, 115, 85, 0.12);
  font-weight: 600;
  white-space: nowrap;
}
.cast-full-desc p { margin: 0.3rem 0; }
.cast-full-desc strong { font-weight: 700; }
.cast-full-desc .desc-continue {
  font-style: italic;
  color: #6b5344;
  font-size: 0.68rem;
  padding-top: 0.1rem;
}

/* EXP cost display in casting modal */
.cast-exp-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.78rem;
  margin-top: 0.15rem;
}
.cast-exp-label { color: #5a4a3a; font-weight: 600; }
.cast-exp-current { font-weight: 700; color: #3a3025; }
.cast-exp-arrow { color: #8b7355; }
.cast-exp-after { font-weight: 700; }
.cast-exp-after.insufficient { color: #dc3545; }
.cast-exp-cost-note {
  font-size: 0.68rem;
  color: #8b7355;
  font-style: italic;
}

/* Casting Controls */
.cast-modal-casting {
  padding: 0.6rem 1rem 0.75rem;
  position: relative;
  z-index: 2;
}

.cast-skill-row {
  display: flex;
  align-items: baseline;
  gap: 0.5rem;
  margin-bottom: 0.3rem;
}

.cast-skill-name {
  font-size: 0.85rem;
  font-weight: 600;
  color: #6b5344;
}

.cast-skill-percent {
  font-size: 1.1rem;
  font-weight: 800;
  color: #2a2520;
}

.cast-difficulty-note {
  font-size: 0.78rem;
  color: #2e7d32;
  font-weight: 600;
  font-style: italic;
}
.cast-difficulty-note.penalty {
  color: #c62828;
}

.cast-mp-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  margin-bottom: 0.6rem;
  font-size: 0.88rem;
}

.cast-mp-label {
  color: #8b7355;
  font-weight: 600;
  font-size: 0.78rem;
  text-transform: uppercase;
}

.cast-mp-current { font-weight: 700; color: #2a2520; }
.cast-mp-arrow { color: #8b7355; font-size: 0.82rem; }
.cast-mp-after { font-weight: 700; color: #6a5acd; }
.cast-mp-after.insufficient { color: #dc3545; }

/* Main Cast Button */
.btn-cast-main {
  width: 100%;
  padding: 0.6rem 1rem;
  border: 2px solid #8b7355;
  background: linear-gradient(to bottom, #f5f0e8, #e8dfd0);
  color: #4a3a2a;
  font-family: var(--font-header);
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  transition: all 0.2s ease;
  letter-spacing: 0.02em;
}
.btn-cast-main:hover:not(:disabled) {
  background: linear-gradient(to bottom, #fff8f0, #f0e8d8);
  border-color: #6b5344;
  box-shadow: 0 2px 8px rgba(139, 115, 85, 0.3);
}
.btn-cast-main:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
.cast-btn-icon { font-size: 1.1rem; }

/* Theme-colored cast buttons */
.theme-divine .btn-cast-main { border-color: #daa520; }
.theme-divine .btn-cast-main:hover:not(:disabled) { border-color: #b8860b; box-shadow: 0 2px 12px rgba(218, 165, 32, 0.3); }
.theme-arcane .btn-cast-main { border-color: #6a5acd; }
.theme-arcane .btn-cast-main:hover:not(:disabled) { border-color: #483d8b; box-shadow: 0 2px 12px rgba(106, 90, 205, 0.3); }
.theme-sorcery .btn-cast-main { border-color: #b22222; }
.theme-sorcery .btn-cast-main:hover:not(:disabled) { border-color: #8b0000; box-shadow: 0 2px 12px rgba(178, 34, 34, 0.3); }
.theme-bardic .btn-cast-main { border-color: #2e8b57; }
.theme-bardic .btn-cast-main:hover:not(:disabled) { border-color: #1a5632; box-shadow: 0 2px 12px rgba(46, 139, 87, 0.3); }

/* Roll Result */
.cast-modal-result {
  padding: 0.6rem 1rem 0.75rem;
  text-align: center;
  position: relative;
  z-index: 2;
}

.cast-roll-display {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.6rem;
  margin-bottom: 0.5rem;
}

.cast-roll-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  font-weight: 700;
  color: #8b7355;
}

.cast-roll-number {
  font-size: 2rem;
  font-weight: 900;
  font-family: 'Courier New', monospace;
  color: #2a2520;
  min-width: 60px;
  text-align: center;
  transition: color 0.3s;
}
.cast-roll-number.rolling {
  animation: rollFlash 0.08s infinite;
}

@keyframes rollFlash {
  0% { opacity: 1; }
  50% { opacity: 0.6; }
  100% { opacity: 1; }
}

.cast-roll-target {
  font-size: 0.82rem;
  color: #8b7355;
  font-weight: 600;
}

.cast-result-banner {
  padding: 0.4rem 1rem;
  border-radius: 6px;
  margin-bottom: 0.4rem;
  font-family: var(--font-header);
  font-weight: 800;
  font-size: 1.1rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.cast-result-banner.critical {
  background: linear-gradient(135deg, #ffd700, #ffed4a);
  color: #5a4a00;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.cast-result-banner.success {
  background: linear-gradient(135deg, #d4edda, #c3e6cb);
  color: #155724;
}
.cast-result-banner.failure {
  background: linear-gradient(135deg, #f8d7da, #f1c2c7);
  color: #721c24;
}
.cast-result-banner.fumble {
  background: linear-gradient(135deg, #721c24, #a02030);
  color: #fff;
  box-shadow: 0 0 15px rgba(114, 28, 36, 0.5);
}

.cast-result-details {
  font-size: 0.82rem;
  color: #5a4a3a;
  line-height: 1.4;
  margin-bottom: 0.4rem;
  min-height: 1em;
}

/* Force Failed Spell */
.cast-force-section {
  margin-top: 0.4rem;
  padding: 0.5rem;
  background: rgba(255, 243, 205, 0.5);
  border: 1px solid rgba(255, 193, 7, 0.3);
  border-radius: 6px;
}

.cast-force-explain {
  font-size: 0.8rem;
  color: #856404;
  margin: 0 0 0.4rem 0;
  line-height: 1.3;
}

.cast-force-buttons {
  display: flex;
  gap: 0.4rem;
}

.btn-force-spell, .btn-force-luck {
  flex: 1;
  padding: 0.35rem 0.5rem;
  border: 1px solid rgba(139, 115, 85, 0.4);
  background: rgba(255, 255, 255, 0.6);
  color: #4a3a2a;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.15s;
}
.btn-force-spell:hover { background: #fff3cd; border-color: #ffc107; }
.btn-force-luck:hover { background: #d4edda; border-color: #28a745; }
.btn-force-luck:disabled { opacity: 0.35; cursor: not-allowed; }

.btn-cast-done {
  width: 100%;
  padding: 0.5rem;
  margin-top: 0.5rem;
  border: 1px solid rgba(139, 115, 85, 0.3);
  background: rgba(139, 115, 85, 0.1);
  color: #6b5344;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.15s;
}
.btn-cast-done:hover { background: rgba(139, 115, 85, 0.2); }

/* Animation Overlay */
.cast-animation-overlay {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  border-radius: 10px;
  pointer-events: none;
  z-index: 10;
  overflow: hidden;
}

/* Success animations per casting type */
@keyframes divineGlow {
  0% { opacity: 0; }
  20% { opacity: 1; }
  50% { opacity: 0.8; }
  100% { opacity: 0; }
}
@keyframes arcaneRunes {
  0% { opacity: 0; transform: rotate(0deg) scale(0.8); }
  25% { opacity: 1; transform: rotate(5deg) scale(1.02); }
  50% { opacity: 0.85; transform: rotate(10deg) scale(1.05); }
  100% { opacity: 0; transform: rotate(15deg) scale(1.08); }
}
@keyframes sorceryPulse {
  0% { opacity: 0; }
  20% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 0; }
}
@keyframes bardicWave {
  0% { opacity: 0; background-position: 0% 50%; }
  25% { opacity: 1; }
  60% { opacity: 0.7; }
  100% { opacity: 0; background-position: 200% 50%; }
}

.cast-animation-overlay.anim-divine-success {
  background: radial-gradient(ellipse at center top, rgba(255, 215, 0, 0.5), rgba(255, 255, 200, 0.3), rgba(255, 200, 50, 0.1), transparent 75%);
  animation: divineGlow 2s ease-out forwards;
}
.cast-animation-overlay.anim-arcane-success {
  background: radial-gradient(circle at center, rgba(106, 90, 205, 0.45), rgba(138, 43, 226, 0.25), rgba(75, 0, 130, 0.1), transparent 75%);
  animation: arcaneRunes 2s ease-out forwards;
}
.cast-animation-overlay.anim-sorcery-success {
  background: radial-gradient(circle at center, rgba(178, 34, 34, 0.4), rgba(220, 20, 60, 0.2), rgba(139, 0, 0, 0.1), transparent 70%);
  animation: sorceryPulse 2s ease-out forwards;
}
.cast-animation-overlay.anim-bardic-success {
  background: linear-gradient(90deg, transparent, rgba(46, 139, 87, 0.35), rgba(60, 179, 113, 0.25), rgba(34, 139, 34, 0.15), transparent);
  background-size: 200% 100%;
  animation: bardicWave 2s ease-out forwards;
}

/* Fizzle animation for failures */
@keyframes fizzle {
  0% { opacity: 0; }
  15% { opacity: 0.7; }
  30% { opacity: 0.3; }
  50% { opacity: 0.5; }
  70% { opacity: 0.15; }
  100% { opacity: 0; }
}
.cast-animation-overlay.anim-fizzle {
  background: radial-gradient(circle at center, rgba(128, 128, 128, 0.4), rgba(80, 80, 80, 0.2), transparent 65%);
  animation: fizzle 1.2s ease-out forwards;
}

/* Fumble animation */
@keyframes fumbleFlash {
  0% { opacity: 0; }
  10% { opacity: 0.9; }
  25% { opacity: 0.3; }
  40% { opacity: 0.8; }
  60% { opacity: 0.2; }
  80% { opacity: 0.5; }
  100% { opacity: 0; }
}
.cast-animation-overlay.anim-fumble {
  background: radial-gradient(circle at center, rgba(200, 30, 30, 0.5), rgba(139, 0, 0, 0.3), rgba(80, 0, 0, 0.15), transparent 70%);
  animation: fumbleFlash 1.5s ease-out forwards;
}

/* Critical animation */
@keyframes criticalBurst {
  0% { opacity: 0; transform: scale(0.5); }
  20% { opacity: 1; transform: scale(1.02); }
  40% { opacity: 0.9; transform: scale(1.05); }
  60% { opacity: 0.7; }
  100% { opacity: 0; transform: scale(1.08); }
}
.cast-animation-overlay.anim-critical {
  background: radial-gradient(circle at center, rgba(255, 215, 0, 0.6), rgba(255, 255, 100, 0.35), rgba(255, 200, 0, 0.15), transparent 70%);
  animation: criticalBurst 2.2s ease-out forwards;
}

/* ========== DIALOG-LEVEL CASTING ANIMATIONS (box-shadow based) ========== */
/* These animate on the modal dialog itself, ensuring visibility regardless of overflow/stacking */

@keyframes castGlowDivine {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(218,165,32,0); }
  15% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 60px rgba(218,165,32,0.7), 0 0 120px rgba(255,215,0,0.3), inset 0 0 40px rgba(255,215,0,0.15); }
  40% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 40px rgba(218,165,32,0.5), 0 0 80px rgba(255,215,0,0.2), inset 0 0 25px rgba(255,215,0,0.1); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(218,165,32,0); }
}
.cast-modal-content.casting-anim-divine-success {
  animation: castGlowDivine 2s ease-out forwards;
}

@keyframes castGlowArcane {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(106,90,205,0); }
  15% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 60px rgba(106,90,205,0.7), 0 0 120px rgba(138,43,226,0.3), inset 0 0 40px rgba(138,43,226,0.15); }
  40% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 40px rgba(106,90,205,0.5), 0 0 80px rgba(138,43,226,0.2), inset 0 0 25px rgba(138,43,226,0.1); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(106,90,205,0); }
}
.cast-modal-content.casting-anim-arcane-success {
  animation: castGlowArcane 2s ease-out forwards;
}

@keyframes castGlowSorcery {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(178,34,34,0); }
  15% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 60px rgba(178,34,34,0.7), 0 0 120px rgba(220,20,60,0.3), inset 0 0 40px rgba(178,34,34,0.15); }
  40% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 40px rgba(178,34,34,0.5), 0 0 80px rgba(220,20,60,0.2), inset 0 0 25px rgba(178,34,34,0.1); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(178,34,34,0); }
}
.cast-modal-content.casting-anim-sorcery-success {
  animation: castGlowSorcery 2s ease-out forwards;
}

@keyframes castGlowBardic {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(46,139,87,0); }
  15% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 60px rgba(46,139,87,0.7), 0 0 120px rgba(60,179,113,0.3), inset 0 0 40px rgba(46,139,87,0.15); }
  40% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 40px rgba(46,139,87,0.5), 0 0 80px rgba(60,179,113,0.2), inset 0 0 25px rgba(46,139,87,0.1); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(46,139,87,0); }
}
.cast-modal-content.casting-anim-bardic-success {
  animation: castGlowBardic 2s ease-out forwards;
}

@keyframes castGlowCritical {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(255,215,0,0); }
  10% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 80px rgba(255,215,0,0.9), 0 0 160px rgba(255,255,100,0.4), inset 0 0 50px rgba(255,215,0,0.2); }
  30% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 60px rgba(255,215,0,0.7), 0 0 120px rgba(255,255,100,0.3), inset 0 0 35px rgba(255,215,0,0.15); }
  60% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 30px rgba(255,215,0,0.4), 0 0 60px rgba(255,255,100,0.15); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(255,215,0,0); }
}
.cast-modal-content.casting-anim-critical {
  animation: castGlowCritical 2.2s ease-out forwards;
}

@keyframes castGlowFizzle {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5); }
  15% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 30px rgba(128,128,128,0.4), inset 0 0 20px rgba(128,128,128,0.1); }
  40% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 15px rgba(128,128,128,0.2); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5); }
}
.cast-modal-content.casting-anim-fizzle {
  animation: castGlowFizzle 1.2s ease-out forwards;
}

@keyframes castGlowFumble {
  0% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(200,30,30,0); }
  10% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 60px rgba(200,30,30,0.8), 0 0 100px rgba(139,0,0,0.3), inset 0 0 30px rgba(200,30,30,0.15); }
  25% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 20px rgba(200,30,30,0.3); }
  40% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 50px rgba(200,30,30,0.6), 0 0 80px rgba(139,0,0,0.2), inset 0 0 25px rgba(200,30,30,0.1); }
  60% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 15px rgba(200,30,30,0.2); }
  100% { box-shadow: 0 12px 50px rgba(0,0,0,0.5), 0 0 0 rgba(200,30,30,0); }
}
.cast-modal-content.casting-anim-fumble {
  animation: castGlowFumble 1.5s ease-out forwards;
}

/* Add Spell Button */
.btn-add-spell {
  background: #e8f5e9;
  border: 1px solid #81c784;
  color: #2e7d32;
  cursor: pointer;
  border-radius: 4px;
  font-size: 0.85rem;
  padding: 0.25rem 0.6rem;
  transition: all 0.15s ease;
}

.btn-add-spell:hover {
  background: #c8e6c9;
  border-color: #4caf50;
}

/* Sorcerer Weaving Effects Chart */
.weaving-effects-section {
  margin-top: 1rem;
  padding: 0.6rem 0.8rem;
  border: 1px solid rgba(139, 69, 139, 0.3);
  border-radius: 6px;
  background: rgba(75, 0, 110, 0.06);
}

.weaving-effects-section .section-header {
  color: #7b3f9e;
  font-size: 1rem;
  margin-bottom: 0.3rem;
}

.weaving-intro {
  font-size: 0.78rem;
  color: #888;
  margin-bottom: 0.5rem;
  font-style: italic;
}

.weaving-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.82rem;
}

.weaving-table th {
  background: rgba(123, 63, 158, 0.15);
  font-weight: 600;
  font-size: 0.75rem;
  padding: 0.3rem 0.4rem;
  border: 1px solid rgba(139, 69, 139, 0.25);
  text-align: center;
  color: #7b3f9e;
}

.weaving-table th:first-child {
  text-align: left;
}

.weaving-table td {
  padding: 0.25rem 0.4rem;
  border: 1px solid rgba(139, 69, 139, 0.15);
  text-align: center;
}

.weaving-table td:first-child {
  text-align: left;
}

.weaving-table tbody tr:nth-child(even) {
  background: rgba(123, 63, 158, 0.04);
}

.weaving-table tbody tr:hover {
  background: rgba(123, 63, 158, 0.1);
}

.weaving-desc {
  font-size: 0.72rem;
  color: #999;
}

.weaving-footnotes {
  margin-top: 0.4rem;
  padding-top: 0.3rem;
  border-top: 1px solid rgba(139, 69, 139, 0.15);
}

.weaving-footnote {
  font-size: 0.68rem;
  color: #888;
  margin-bottom: 0.25rem;
  line-height: 1.4;
}

/* Magic skill reference (page 5) */
.magic-skill-ref {
  font-weight: 500;
}

/* ============================================
   Responsive Design
   ============================================ */
@media (max-width: 1100px) {
  .main-content-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .column-right {
    grid-column: span 2;
    position: static;
    max-height: none;
    overflow-y: visible;
  }
  
  .sheet-header {
    grid-template-columns: 1fr 1fr;
  }
  
  .header-logo {
    grid-column: span 2;
    flex-direction: row;
    justify-content: space-between;
    padding-top: 0.5rem;
    border-top: 1px solid var(--border-light);
  }
  
  .abilities-sections-container {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 800px) {
  .page-content {
    padding: 1rem;
  }
  
  .sheet-navigation {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .tab-list {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .sheet-controls {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .main-content-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .column-right {
    grid-column: auto;
  }
  
  .sheet-header {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .header-logo {
    grid-column: auto;
  }
  
  .attributes-row {
    flex-direction: column;
  }
  
  .combat-header-grid,
  .movement-fatigue-grid {
    grid-template-columns: 1fr;
  }
  
  .spell-columns {
    grid-template-columns: 1fr;
  }
  
  .ability-cards-grid {
    grid-template-columns: 1fr;
  }
  
  .class-abilities-list {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .page-content {
    padding: 0.75rem 0.5rem;
  }
  
  .class-abilities-list {
    grid-template-columns: 1fr;
  }
  
  .money-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .sheet-header {
    gap: 0.75rem;
  }
}

/* Evocative Name Selector Dropdown */
.evocative-selector {
  background: white;
  border: 2px solid var(--primary-color);
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  min-width: 200px;
  max-width: 300px;
  font-family: var(--font-body);
}

.evocative-header {
  background: var(--primary-color);
  color: white;
  padding: 0.5rem 0.75rem;
  font-weight: 600;
  font-size: 0.9rem;
}

.evocative-options {
  max-height: 250px;
  overflow-y: auto;
}

.evocative-option {
  padding: 0.5rem 0.75rem;
  cursor: pointer;
  border-bottom: 1px solid #eee;
  transition: background-color 0.15s;
}

.evocative-option:hover {
  background-color: rgba(106, 64, 41, 0.1);
}

.evocative-option:last-child {
  border-bottom: none;
}

.evocative-cancel {
  padding: 0.5rem 0.75rem;
  text-align: center;
  color: #666;
  cursor: pointer;
  border-top: 1px solid #ddd;
  font-size: 0.85rem;
}

.evocative-cancel:hover {
  background-color: #f5f5f5;
}


/* Multiclass Warning Popup */
.multiclass-warning {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  border: 3px solid #c0392b;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  padding: 1.5rem 2rem;
  z-index: 10001;
  text-align: center;
  min-width: 300px;
  max-width: 400px;
}

.multiclass-warning-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.multiclass-warning-title {
  font-size: 1.2rem;
  font-weight: 700;
  color: #c0392b;
  margin-bottom: 0.75rem;
}

.multiclass-warning-message {
  font-size: 1rem;
  color: #333;
  margin-bottom: 1.25rem;
  line-height: 1.4;
}

.multiclass-warning-close {
  background: #c0392b;
  color: white;
  border: none;
  padding: 0.5rem 2rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.multiclass-warning-close:hover {
  background: #a93226;
}

/* Rank Prompt Dialog */
.rank-prompt-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.rank-prompt-dialog {
  background: white;
  border: 3px solid #b8960c;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  padding: 1.5rem 2rem;
  text-align: center;
  min-width: 300px;
  max-width: 400px;
}

.rank-prompt-title {
  font-family: var(--font-header);
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-header);
  margin-bottom: 0.75rem;
}

.rank-prompt-message {
  font-size: 1rem;
  color: #333;
  margin-bottom: 1rem;
  line-height: 1.4;
}

.rank-prompt-input {
  width: 80px;
  padding: 0.5rem;
  font-size: 1.5rem;
  text-align: center;
  border: 2px solid var(--input-border);
  border-radius: 4px;
  margin-bottom: 1.25rem;
}

.rank-prompt-input:focus {
  outline: none;
  border-color: #b8960c;
}

.rank-prompt-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
}

.rank-prompt-cancel,
.rank-prompt-ok {
  padding: 0.5rem 1.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.rank-prompt-cancel {
  background: #e0e0e0;
  color: #333;
  border: 1px solid #ccc;
}

.rank-prompt-cancel:hover {
  background: #d0d0d0;
}

.rank-prompt-ok {
  background: #b8960c;
  color: white;
  border: none;
}

.rank-prompt-ok:hover {
  background: #9a7b0a;
}

/* Disabled fields for non-multiclass classes */
.field-disabled {
  background-color: #e9e9e9 !important;
  color: #999 !important;
  cursor: not-allowed !important;
}

.field-disabled::placeholder {
  color: #bbb !important;
}

/* ============================================
   EXP Spending Modal
   ============================================ */
.exp-modal-content {
  max-width: 400px;
  width: 90%;
}

.exp-rolls-display {
  text-align: center;
  padding: 1rem;
  background: rgba(139, 115, 85, 0.1);
  border-radius: 8px;
  margin-bottom: 1.5rem;
}

.exp-rolls-label {
  font-size: 1rem;
  color: var(--text-secondary);
  margin-right: 0.5rem;
}

.exp-rolls-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-header);
}

.exp-options {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.exp-option-btn {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem 1.25rem;
  background: var(--bg-parchment);
  border: 2px solid var(--border-gold);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: left;
}

.exp-option-btn:hover {
  background: rgba(139, 115, 85, 0.15);
  border-color: var(--accent-color);
  transform: translateX(4px);
}

.exp-option-icon {
  font-size: 1.5rem;
  width: 2rem;
  text-align: center;
}

.exp-option-text {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
}

/* Improve Existing Skills Modal */
.improve-skills-modal-content {
  max-width: 950px;
  width: 95%;
  max-height: 85vh;
}

/* Add Subclass Modal */
.add-subclass-modal-content {
  max-width: 500px;
  width: 90%;
}

.subclass-cost-display {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  background: rgba(0, 0, 0, 0.03);
  border-radius: 5px;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.subclass-cost-label {
  font-weight: 600;
  color: var(--text-header);
}

.subclass-cost-value {
  font-weight: 700;
  color: #c62828;
  font-size: 1.0rem;
}

.subclass-cost-note {
  color: var(--text-secondary);
  font-size: 0.85rem;
  font-style: italic;
}

.subclass-error {
  padding: 1rem;
  background: #ffebee;
  border: 1px solid #ef9a9a;
  border-radius: 5px;
  color: #c62828;
  text-align: center;
  margin-bottom: 1rem;
}

.subclass-selection {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.subclass-selection label {
  font-weight: 600;
  color: var(--text-header);
}

.subclass-select {
  padding: 0.5rem;
  font-size: 1rem;
  border: 2px solid var(--border-medium);
  border-radius: 5px;
  background: white;
  font-family: var(--font-body);
}

.subclass-select:focus {
  border-color: var(--border-gold);
  outline: none;
}

.subclass-restriction-note {
  font-size: 0.8rem;
  color: var(--text-secondary);
  background: rgba(0, 0, 0, 0.03);
  padding: 0.5rem 0.75rem;
  border-radius: 4px;
  line-height: 1.4;
}

/* Unlock Class Abilities Modal */
.unlock-abilities-modal-content {
  max-width: 700px;
  width: 95%;
  max-height: 85vh;
}

/* Pending Automatic Abilities Section */
.pending-automatic-section {
  background: linear-gradient(to bottom, #fff8e1, #fff3cd);
  border: 2px solid #f9a825;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}

.pending-automatic-section h4 {
  margin: 0 0 0.25rem 0;
  color: #e65100;
  font-size: 1rem;
}

.pending-automatic-subtitle {
  margin: 0 0 0.75rem 0;
  font-size: 0.85rem;
  color: #795548;
  font-style: italic;
}

.pending-automatic-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.pending-automatic-item {
  background: white;
  border: 1px solid #ffcc80;
  border-radius: 5px;
  padding: 0.75rem;
}

.pending-automatic-name {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  flex-wrap: wrap;
}

.pending-automatic-name strong {
  color: #e65100;
}

.pending-class-badge {
  font-size: 0.75rem;
  background: #fff3e0;
  color: #e65100;
  padding: 0.15rem 0.5rem;
  border-radius: 3px;
  border: 1px solid #ffcc80;
}

.pending-automatic-prereqs {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding-left: 0.5rem;
}

.prereq-missing {
  font-size: 0.85rem;
  color: #c62828;
}

.class-tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  flex-wrap: wrap;
}

.class-tab {
  padding: 0.5rem 1rem;
  border: 2px solid var(--border-medium);
  border-radius: 5px 5px 0 0;
  background: rgba(0, 0, 0, 0.03);
  cursor: pointer;
  font-family: var(--font-body);
  font-size: 0.9rem;
  color: var(--text-body);
  transition: all 0.15s ease;
}

.class-tab:hover {
  background: rgba(0, 0, 0, 0.06);
}

.class-tab.active {
  background: var(--border-gold);
  border-color: var(--border-gold);
  color: white;
  font-weight: 600;
}

.class-tab .rank-badge {
  font-size: 0.75rem;
  background: rgba(255, 255, 255, 0.3);
  padding: 0.1rem 0.4rem;
  border-radius: 3px;
  margin-left: 0.5rem;
}

.class-tab.active .rank-badge {
  background: rgba(0, 0, 0, 0.2);
}

.rank-tabs {
  display: flex;
  gap: 0.25rem;
  margin-bottom: 1rem;
  border-bottom: 2px solid var(--border-light);
  padding-bottom: 0.5rem;
}

.rank-tab {
  padding: 0.35rem 0.75rem;
  border: 1px solid transparent;
  border-radius: 4px;
  background: transparent;
  cursor: pointer;
  font-family: var(--font-body);
  font-size: 0.85rem;
  color: var(--text-secondary);
  transition: all 0.15s ease;
}

.rank-tab:hover {
  background: rgba(0, 0, 0, 0.05);
  color: var(--text-body);
}

.rank-tab.active {
  background: var(--page-bg);
  border-color: var(--border-medium);
  color: var(--text-header);
  font-weight: 600;
}

.abilities-container {
  max-height: 50vh;
  overflow-y: auto;
}

.abilities-section h4 {
  font-family: var(--font-header);
  font-size: 0.95rem;
  color: var(--text-header);
  margin: 0 0 0.5rem 0;
}

.available-abilities h4 {
  color: #2e7d32;
}

.unqualified-abilities h4 {
  color: #b71c1c;
}

.acquired-abilities h4 {
  color: #546e7a;
}

.no-ranks-message {
  display: block;
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-style: italic;
  text-align: center;
}

.abilities-divider {
  border: none;
  border-top: 2px dashed var(--border-medium);
  margin: 1rem 0;
}

.abilities-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.ability-row {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.75rem;
  border: 2px solid var(--border-light);
  border-radius: 5px;
  background: white;
  cursor: pointer;
  transition: all 0.15s ease;
}

.ability-row:hover:not(.disabled):not(.acquired) {
  border-color: var(--border-gold);
  background: #fffef5;
}

.ability-row.disabled {
  opacity: 0.7;
  cursor: not-allowed;
  background: #f5f5f5;
}

.ability-row.acquired {
  opacity: 0.6;
  cursor: default;
  background: #e8f5e9;
  border-color: #a5d6a7;
}

.ability-row input[type="checkbox"] {
  margin-top: 0.25rem;
  width: 18px;
  height: 18px;
  accent-color: var(--border-gold);
}

.ability-info {
  flex: 1;
}

.ability-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.25rem;
}

.ability-name {
  font-weight: 600;
  color: var(--text-header);
  font-size: 0.95rem;
}

.ability-cost {
  font-size: 0.8rem;
  font-weight: 600;
  color: #c62828;
  background: #ffebee;
  padding: 0.15rem 0.5rem;
  border-radius: 3px;
}

.ability-summary {
  font-size: 0.85rem;
  color: var(--text-body);
  line-height: 1.4;
}

.ability-status {
  font-size: 0.8rem;
  margin-top: 0.35rem;
  padding: 0.25rem 0.5rem;
  border-radius: 3px;
}

.ability-status.acquired {
  color: #2e7d32;
  background: #c8e6c9;
}

.ability-status.missing {
  color: #b71c1c;
  background: #ffcdd2;
}

.no-abilities {
  color: var(--text-secondary);
  font-style: italic;
  padding: 1rem;
  text-align: center;
}

/* Ability Input Wrapper with Info Button */
.ability-input-wrapper {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  position: relative;
}

.ability-input-wrapper .ability-input {
  flex: 1;
}

.ability-info-btn {
  width: 20px;
  height: 20px;
  min-width: 20px;
  padding: 0;
  border: 1px solid var(--border-medium);
  border-radius: 50%;
  background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
  color: var(--text-secondary);
  font-size: 0.7rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ability-info-btn:hover {
  background: linear-gradient(135deg, var(--border-gold) 0%, #b8860b 100%);
  color: white;
  border-color: var(--border-gold);
  transform: scale(1.1);
}

/* Ability Detail Popup Overlay */
.ability-detail-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s ease;
}

.ability-detail-overlay.active {
  opacity: 1;
  visibility: visible;
}

.ability-detail-popup {
  background: linear-gradient(180deg, #fefdfb 0%, #f9f6f0 100%);
  border: 3px solid var(--border-gold);
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(184, 134, 11, 0.2);
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow: hidden;
  transform: scale(0.9);
  transition: transform 0.2s ease;
}

.ability-detail-overlay.active .ability-detail-popup {
  transform: scale(1);
}

.ability-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.25rem;
  background: linear-gradient(135deg, var(--border-gold) 0%, #b8860b 100%);
  border-bottom: 2px solid rgba(0, 0, 0, 0.1);
}

.ability-detail-title {
  font-family: var(--font-header);
  font-size: 1.3rem;
  color: white;
  margin: 0;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

.ability-detail-close {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  font-size: 1.5rem;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
  line-height: 1;
}

.ability-detail-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

.ability-detail-body {
  padding: 1.5rem;
  max-height: 60vh;
  overflow-y: auto;
}

.ability-detail-description {
  font-size: 1.05rem;
  line-height: 1.7;
  color: var(--text-body);
  margin: 0;
}

/* Attribute info modal specific styling */
.attr-info-popup {
  max-width: 500px;
}

.attr-info-popup .ability-detail-description {
  font-size: 0.95rem;
  line-height: 1.6;
}

.attr-info-popup .ability-detail-description p {
  margin: 0 0 0.75rem 0;
}

.attr-info-popup .ability-detail-description ul {
  margin: 0 0 0.75rem 0;
  padding-left: 1.5rem;
}

.attr-info-popup .ability-detail-description li {
  margin-bottom: 0.35rem;
}

.attr-info-table {
  width: 100%;
  border-collapse: collapse;
  margin: 0.75rem 0;
  font-size: 0.9rem;
}

.attr-info-table th,
.attr-info-table td {
  padding: 0.4rem 0.6rem;
  text-align: left;
  border: 1px solid var(--border-color, #ddd);
}

.attr-info-table th {
  background: var(--header-bg, #f5f0e6);
  font-weight: 600;
  color: var(--text-primary, #333);
}

.attr-info-table tr:nth-child(even) {
  background: rgba(0, 0, 0, 0.03);
}

.attr-info-table td:first-child {
  font-weight: 500;
}

.ability-intro {
  font-size: 1.05rem;
  line-height: 1.6;
  color: var(--text-body);
  margin: 0 0 0.75rem 0;
  font-weight: 500;
}

.ability-bullets {
  margin: 0;
  padding: 0 0 0 1.25rem;
  list-style-type: disc;
}

.ability-bullets li {
  font-size: 0.95rem;
  line-height: 1.5;
  color: var(--text-body);
  margin-bottom: 0.4rem;
  padding-left: 0.25rem;
}

.ability-bullets li:last-child {
  margin-bottom: 0;
}

.ability-description-text {
  font-size: 1.05rem;
  line-height: 1.7;
  color: var(--text-body);
  margin: 0 0 1rem 0;
}

.ability-source {
  font-size: 0.95rem;
  color: var(--text-secondary);
  margin: 0.75rem 0;
  padding-top: 0.75rem;
  border-top: 1px solid var(--border-light);
}

.ability-note {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin: 0.5rem 0 0 0;
  padding: 0.5rem;
  background: rgba(184, 134, 11, 0.1);
  border-radius: 4px;
}

.ability-callout {
  margin: 1rem 0 0.5rem 0;
  padding: 0.6rem 0.8rem;
  background: rgba(70, 130, 180, 0.12);
  border-left: 3px solid steelblue;
  border-radius: 4px;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.ability-nav-btn {
  padding: 0.25rem 0.6rem;
  font-size: 0.85rem;
  background: steelblue;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  white-space: nowrap;
}

.ability-nav-btn:hover {
  background: #3a7bb8;
}

.short-rest-divider {
  border: none;
  border-top: 1px solid var(--border-light);
  margin: 0.75rem 0;
}

.skirmish-combat-skill,
.skirmish-athletics-skill {
  font-weight: 700;
  color: var(--text-header);
}

.skirmish-roll-section {
  margin-top: 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
}

.skirmish-effective {
  font-size: 0.95rem;
}

.skirmish-limited-by {
  font-size: 0.85rem;
  color: var(--text-secondary);
  font-style: italic;
}

.skirmish-roll-btn {
  font-size: 0.95rem !important;
  padding: 0.35rem 0.8rem !important;
}

.ability-detail-no-desc {
  color: var(--text-secondary);
  font-style: italic;
}

/* Characteristic Increase Modal */
.characteristic-increase-modal-content {
  max-width: 400px;
  width: 90%;
}

.char-increase-instructions {
  text-align: center;
  font-size: 1rem;
  color: var(--text-body);
  margin-bottom: 1rem;
}

.char-increase-options {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.char-option {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.6rem 1rem;
  border: 2px solid var(--border-light);
  border-radius: 6px;
  background: white;
  cursor: pointer;
  transition: all 0.15s ease;
}

.char-option:hover {
  border-color: var(--border-gold);
  background: #fffef5;
}

.char-option input[type="radio"] {
  width: 18px;
  height: 18px;
  accent-color: var(--border-gold);
}

.char-option .char-label {
  font-weight: 700;
  font-size: 1.0rem;
  color: var(--text-header);
  min-width: 40px;
}

.char-option .char-current {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-left: auto;
}

.char-increase-note {
  text-align: center;
  font-size: 0.85rem;
  color: var(--text-secondary);
  font-style: italic;
  margin-top: 1rem;
}

.char-option.at-max {
  opacity: 0.5;
  cursor: not-allowed;
  background: #f5f5f5;
}

.char-option.at-max:hover {
  border-color: var(--border-light);
  background: #f5f5f5;
}

.char-option.at-max .char-current {
  color: #cc0000;
  font-weight: 600;
}

.no-char-options-msg {
  text-align: center;
  padding: 1rem;
  color: #cc0000;
  font-style: italic;
}

.improve-skills-instructions {
  text-align: center;
  color: var(--text-secondary);
  margin-bottom: 0.75rem;
  font-style: italic;
  font-size: 0.9rem;
}

.skills-columns {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 1.25rem;
  max-height: 55vh;
  overflow-y: auto;
}

.skills-columns-4 {
  grid-template-columns: 1fr 1fr auto 1fr;
}

.skills-columns-3 {
  grid-template-columns: 1fr 1fr 1fr;
}

.skill-column {
  display: flex;
  flex-direction: column;
}

.skill-column h4 {
  font-family: var(--font-header);
  font-size: 0.95rem;
  color: var(--text-header);
  margin: 0 0 0.5rem 0;
  padding-bottom: 0.35rem;
  border-bottom: 2px solid var(--border-gold);
}

.skill-list {
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.skill-checkbox-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  cursor: pointer;
  transition: background 0.15s;
}

.skill-checkbox-row:hover {
  background: rgba(139, 115, 85, 0.1);
}

.skill-checkbox-row input[type="checkbox"] {
  width: 14px;
  height: 14px;
  cursor: pointer;
  flex-shrink: 0;
}

.skill-checkbox-row .skill-name {
  flex: 1;
  font-size: 0.85rem;
}

.skill-checkbox-row .skill-value {
  font-weight: 600;
  color: var(--text-header);
  font-size: 0.85rem;
}

.no-skills-message {
  color: var(--text-secondary);
  font-style: italic;
  font-size: 0.85rem;
  padding: 0.3rem;
}

/* Prereq skill coloring */
.skill-checkbox-row.prereq-class-1 {
  background: rgba(201, 162, 39, 0.2);
  border-left: 3px solid #c9a227;
}

.skill-checkbox-row.prereq-class-2 {
  background: rgba(128, 128, 128, 0.2);
  border-left: 3px solid #808080;
}

.skill-checkbox-row.prereq-class-3 {
  background: rgba(74, 144, 226, 0.2);
  border-left: 3px solid #4a90e2;
}

/* Prereq legend */
.skills-prereq-legend {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  margin-top: 1rem;
  background: rgba(0, 0, 0, 0.03);
  border-radius: 6px;
  font-size: 0.85rem;
  flex-wrap: wrap;
}

.legend-label {
  font-weight: 600;
  color: var(--text-secondary);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.legend-color {
  width: 14px;
  height: 14px;
  border-radius: 3px;
}

.legend-color.prereq-class-1 {
  background: rgba(201, 162, 39, 0.4);
  border: 2px solid #c9a227;
}

.legend-color.prereq-class-2 {
  background: rgba(128, 128, 128, 0.4);
  border: 2px solid #808080;
}

.legend-color.prereq-class-3 {
  background: rgba(74, 144, 226, 0.4);
  border: 2px solid #4a90e2;
}

/* Roll Method Modal */
.roll-method-modal-content,
.dice-type-modal-content,
.manual-entry-modal-content {
  max-width: 500px;
  width: 90%;
}

.roll-results-modal-content {
  max-width: 600px;
  width: 95%;
  max-height: 80vh;
}

.selected-skills-list {
  background: rgba(0,0,0,0.03);
  border-radius: 6px;
  padding: 0.75rem;
  margin-bottom: 1.5rem;
  max-height: 200px;
  overflow-y: auto;
}

.selected-skill-item {
  display: flex;
  justify-content: space-between;
  padding: 0.3rem 0.5rem;
  border-bottom: 1px solid rgba(0,0,0,0.05);
}

.selected-skill-item:last-child {
  border-bottom: none;
}

.roll-method-choice {
  text-align: center;
}

.roll-method-choice p {
  margin-bottom: 1rem;
  font-weight: 600;
}

.roll-method-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
}

.roll-method-buttons .btn {
  padding: 0.75rem 1.5rem;
  font-size: 1rem;
}

/* Dice Type Modal */
.dice-type-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
}

.dice-type-buttons .exp-option-btn {
  flex-direction: column;
  padding: 1.5rem 2rem;
  min-width: 140px;
}

.dice-type-label {
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
}

.dice-type-value {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-header);
}

/* Roll Results Modal */
.roll-results-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  max-height: 50vh;
  overflow-y: auto;
}

.roll-result-item {
  background: rgba(0,0,0,0.03);
  border-radius: 8px;
  padding: 0.75rem 1rem;
  border-left: 4px solid #ccc;
}

.roll-result-item.success {
  border-left-color: #27ae60;
  background: rgba(39, 174, 96, 0.08);
}

.roll-result-item.failure {
  border-left-color: #c0392b;
  background: rgba(192, 57, 43, 0.08);
}

.roll-result-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.roll-result-header .skill-name {
  font-weight: 600;
  font-size: 1rem;
}

.roll-outcome {
  font-weight: 600;
  font-size: 0.9rem;
}

.roll-outcome.success {
  color: #27ae60;
}

.roll-outcome.failure {
  color: #c0392b;
}

.roll-result-details {
  display: flex;
  justify-content: space-between;
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 0.25rem;
}

.roll-result-improvement {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
}

.roll-result-improvement .new-value {
  font-weight: 600;
  color: #27ae60;
}

/* Manual Entry Modal */
.manual-entry-instructions {
  margin-bottom: 1rem;
  color: var(--text-secondary);
}

.manual-entry-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-height: 50vh;
  overflow-y: auto;
}

.manual-entry-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem;
  background: rgba(0,0,0,0.03);
  border-radius: 6px;
}

.manual-entry-row .skill-name {
  flex: 1;
  font-weight: 500;
}

.manual-entry-row .skill-current {
  color: var(--text-secondary);
  min-width: 50px;
  text-align: right;
}

.manual-entry-row .entry-plus {
  font-weight: 600;
  color: var(--text-secondary);
}

.manual-entry-input {
  width: 60px;
  padding: 0.4rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  text-align: center;
  font-size: 1rem;
}

/* Learn New Skills Modal */
.learn-skills-modal-content {
  max-width: 550px;
  width: 95%;
  max-height: 80vh;
}

.learn-skills-instructions {
  text-align: center;
  color: var(--text-secondary);
  margin-bottom: 1rem;
  font-style: italic;
}

.learn-skills-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
  max-height: 45vh;
  overflow-y: auto;
  padding-right: 4px;
}

.learn-skill-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.35rem 0.5rem;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.15s;
}

.learn-skill-row:hover {
  background: rgba(139, 115, 85, 0.1);
}

.learn-skill-row input[type="checkbox"] {
  width: 16px;
  height: 16px;
  cursor: pointer;
}

.learn-skill-row .skill-name {
  flex: 1;
  font-weight: 500;
}

.learn-skill-row .skill-formula {
  color: var(--text-secondary);
  font-size: 0.85rem;
}

.learn-skills-cost-note {
  text-align: center;
  margin-top: 1rem;
  padding: 0.75rem;
  background: rgba(201, 162, 39, 0.15);
  border: 1px solid var(--border-gold);
  border-radius: 6px;
  font-size: 0.9rem;
}

/* Specialty Input Modal */
.specialty-input-modal-content {
  max-width: 450px;
  width: 90%;
}

.specialty-input-list {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.specialty-input-row {
  background: rgba(0,0,0,0.03);
  padding: 1rem;
  border-radius: 8px;
}

.specialty-label {
  font-weight: 600;
  font-size: 1.0rem;
  color: var(--text-header);
  display: block;
  margin-bottom: 0.25rem;
}

.specialty-prompt {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-bottom: 0.5rem;
  font-style: italic;
}

.specialty-input {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  border-top: 1px solid var(--border-gold);
  background: linear-gradient(to top, rgba(139,115,85,0.1), transparent);
}

.modal-footer .btn {
  padding: 0.5rem 1.25rem;
  font-size: 0.95rem;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}

.modal-footer .btn-secondary {
  background: #f5f5f5;
  border: 1px solid #ccc;
  color: var(--text-primary);
}

.modal-footer .btn-secondary:hover {
  background: #e8e8e8;
}

.modal-footer .btn-primary {
  background: var(--accent-color, #8B4513);
  border: 1px solid var(--accent-color, #8B4513);
  color: white;
}

.modal-footer .btn-primary:hover:not(:disabled) {
  background: #a0522d;
}

.modal-footer .btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Prerequisite Status Modal */
.prereq-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.prereq-modal {
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  min-width: 400px;
  max-width: 550px;
  max-height: 90vh;
  overflow: hidden;
}

.prereq-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--accent-color, #8B4513);
  color: white;
}

.prereq-modal-header h3 {
  margin: 0;
  font-size: 1.0rem;
}

.prereq-modal-close {
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0 4px;
  line-height: 1;
}

.prereq-modal-close:hover {
  opacity: 0.8;
}

.prereq-modal-content {
  padding: 16px;
}

.prereq-info {
  margin-bottom: 12px;
}

.prereq-info p {
  margin: 4px 0;
  font-size: 0.95rem;
}

.prereq-progress {
  background: #f0f0f0;
  padding: 10px 12px;
  border-radius: 4px;
  font-weight: bold;
  margin-bottom: 16px;
  text-align: center;
}

.prereq-progress.ready {
  background: #d4edda;
  color: #155724;
}

.prereq-section {
  margin-bottom: 12px;
}

.prereq-section h4 {
  margin: 0 0 8px 0;
  font-size: 0.95rem;
  padding-bottom: 4px;
  border-bottom: 1px solid #ddd;
}

.prereq-section.met h4 {
  color: #28a745;
}

.prereq-section.unmet h4 {
  color: #dc3545;
}

.prereq-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.prereq-section li {
  display: flex;
  justify-content: space-between;
  padding: 4px 8px;
  font-size: 0.9rem;
}

.prereq-section li:nth-child(odd) {
  background: #f8f8f8;
}

.prereq-section .skill-name {
  flex: 1;
}

.prereq-section .skill-value {
  font-weight: 500;
  text-align: right;
}

.prereq-section.met .skill-value {
  color: #28a745;
}

.prereq-section.unmet .skill-value {
  color: #dc3545;
}

.prereq-section .needed {
  font-size: 0.85em;
  opacity: 0.8;
}

/* ==================== SUMMARY PAGE ==================== */
.page-summary .summary-instructions {
  text-align: center;
  color: #666;
  margin-bottom: 16px;
  font-style: italic;
}

.summary-container {
  display: flex;
  gap: 20px;
  min-height: 600px;
}

.widget-palette {
  width: 180px;
  flex-shrink: 0;
  background: #f5f5f5;
  border-radius: 8px;
  padding: 12px;
  border: 1px solid #ddd;
  position: sticky;
  top: 20px;
  max-height: calc(100vh - 200px);
  overflow-y: auto;
}

.widget-palette h3 {
  margin: 0 0 12px 0;
  font-size: 0.95rem;
  color: var(--accent-color, #8B4513);
  border-bottom: 1px solid #ddd;
  padding-bottom: 8px;
}

.palette-widgets {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.widget-item {
  background: white;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 14px 16px;
  cursor: grab;
  font-size: 0.95rem;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.widget-item:hover {
  border-color: var(--accent-color, #8B4513);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.widget-item:active {
  cursor: grabbing;
}

.widget-item.dragging {
  opacity: 0.5;
}

.widget-item .widget-icon {
  font-size: 1.1em;
}

.summary-canvas {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.canvas-grid {
  flex: 1;
  background: #fafafa;
  border: 2px dashed #ccc;
  border-radius: 8px;
  padding: 16px;
  min-height: 500px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
  align-content: start;
}

.canvas-grid.drag-over {
  border-color: var(--accent-color, #8B4513);
  background: #fff8f0;
}

.canvas-grid .widget-item {
  cursor: default;
  position: relative;
  transition: transform 0.15s ease;
  flex-direction: column;
  align-items: stretch;
}

.canvas-grid .widget-item.dragging {
  opacity: 0.5;
  transform: scale(0.98);
}

.canvas-grid .widget-item.drop-before {
  box-shadow: 0 -3px 0 0 var(--accent-color, #8B4513);
}

.canvas-grid .widget-item.drop-after {
  box-shadow: 0 3px 0 0 var(--accent-color, #8B4513);
}

.widget-drag-handle {
  position: absolute;
  top: 8px;
  left: 8px;
  color: #aaa;
  cursor: grab;
  font-size: 14px;
  line-height: 1;
  user-select: none;
}

.widget-drag-handle:hover {
  color: var(--accent-color, #8B4513);
}

.widget-drag-handle:active {
  cursor: grabbing;
}

.canvas-grid .widget-item .widget-content {
  padding-left: 20px;
}

.canvas-grid .widget-item .widget-remove {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 20px;
  height: 20px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.2s;
}

.canvas-grid .widget-item:hover .widget-remove {
  opacity: 1;
}

.canvas-grid .widget-item .widget-remove:hover {
  background: #c82333;
}

/* Widget Content Styles */
.widget-content {
  width: 100%;
}

.widget-content h4 {
  margin: 0 0 10px 0;
  font-size: 1.0rem;
  color: var(--accent-color, #8B4513);
  border-bottom: 2px solid #ddd;
  padding-bottom: 6px;
}

.widget-content .stat-row {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  font-size: 1rem;
}

.widget-content .stat-row .stat-label {
  color: #666;
}

.widget-content .stat-row .stat-value {
  font-weight: 600;
}

.widget-content .stat-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
  text-align: center;
}

.widget-content .stat-grid .stat-box {
  background: #f0f0f0;
  padding: 6px;
  border-radius: 4px;
}

.widget-content .stat-grid .stat-box .label {
  font-size: 0.8rem;
  color: #666;
}

.widget-content .stat-grid .stat-box .value {
  font-size: 1.15rem;
  font-weight: 600;
}

.widget-content .skill-list {
  font-size: 1rem;
}

.widget-content .skill-list .skill-item {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  border-bottom: 1px dotted #eee;
}

.widget-content .skill-list .skill-item:last-child {
  border-bottom: none;
}

/* Beliefs widget sections */
.widget-content .beliefs-section {
  margin-bottom: 0.75rem;
}

.widget-content .beliefs-section:last-child {
  margin-bottom: 0;
}

.widget-content .beliefs-section strong {
  display: block;
  font-size: 0.85rem;
  color: #666;
  margin-bottom: 0.25rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.widget-content .beliefs-section .skill-item {
  display: flex;
  justify-content: space-between;
  padding: 3px 0;
  border-bottom: 1px dotted #eee;
  font-size: 0.95rem;
}

.widget-content .beliefs-section .skill-item:last-child {
  border-bottom: none;
}

.widget-content .belief-roll-item {
  cursor: default;
}

.widget-content .belief-roll-group {
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.widget-content .btn-belief-roll {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  padding: 0;
  opacity: 0.6;
  transition: opacity 0.2s, transform 0.2s;
}

.widget-content .btn-belief-roll:hover {
  opacity: 1;
  transform: scale(1.15);
}

/* Bold styles for skill names and values */
.widget-content .skill-name-bold {
  font-weight: 700;
}

.widget-content .skill-value-bold {
  font-weight: 700;
}

.widget-content .stat-value-bold,
.widget-content .stat-row .stat-value-bold {
  font-weight: 700 !important;
}

/* Spell widget header */
.widget-content .spell-widget-header {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  font-size: 0.85rem;
  font-weight: 600;
  color: #888;
  border-bottom: 1px solid #ccc;
  margin-bottom: 4px;
}

/* Spell hover for tooltips */
.widget-content .spell-hover {
  cursor: help;
}

.widget-content .spell-hover:hover {
  background: rgba(139, 69, 19, 0.1);
}

/* Expandable widget lists */
.abilities-widget-list,
.spell-widget-list {
  max-height: none;
}

.abilities-widget-list.collapsed .hidden-ability,
.spell-widget-list.collapsed .hidden-spell {
  display: none;
}

.abilities-widget-list.collapsed .ability-group-label.hidden-ability {
  display: none;
}

.ability-widget-item {
  padding: 4px 0;
  font-size: 0.85rem;
  border-bottom: 1px solid #eee;
  cursor: help;
}

.ability-widget-item:last-child {
  border-bottom: none;
}

.ability-group-label {
  font-weight: bold;
  font-size: 0.8rem;
  color: #666;
  padding: 6px 0 2px 0;
  margin-top: 4px;
  border-top: 1px solid #ddd;
}

.ability-group-label:first-child {
  margin-top: 0;
  border-top: none;
}

/* Equipment widget */
.equipment-widget-list {
  max-height: none;
}

.equipment-widget-list.collapsed .hidden-equipment {
  display: none;
}

.equipment-widget-item {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  font-size: 0.85rem;
  border-bottom: 1px solid #eee;
}

.equipment-widget-item:last-child {
  border-bottom: none;
}

.equipment-widget-item .equip-name {
  flex: 1;
}

.equipment-widget-item .equip-enc {
  width: 40px;
  text-align: right;
  color: #666;
  font-size: 0.8rem;
}

.widget-expand-btn {
  display: block;
  width: 100%;
  padding: 6px;
  margin-top: 8px;
  background: linear-gradient(to bottom, #f5f5f5, #e8e8e8);
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 0.8rem;
  color: #666;
  cursor: pointer;
  text-align: center;
  transition: all 0.15s ease;
}

.widget-expand-btn:hover {
  background: linear-gradient(to bottom, #fff, #f0f0f0);
  border-color: var(--border-gold);
  color: var(--text-header);
}

.widget-content .hp-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: 6px;
  font-size: 0.9rem;
}

.widget-content .hp-location {
  background: #f0f0f0;
  padding: 6px;
  border-radius: 4px;
  text-align: center;
}

.widget-content .hp-location .loc-name {
  font-size: 0.75rem;
  color: #666;
}

.widget-content .hp-location .loc-hp {
  font-weight: 600;
  font-size: 1rem;
}

.widget-content .hp-location.damaged {
  background: #ffe0e0;
}

/* Combat Stats Grid in Widget */
.combat-stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 8px;
}

.combat-stats-grid.two-col {
  grid-template-columns: repeat(2, 1fr);
}

.combat-skill-header {
  display: flex;
  justify-content: space-between;
  font-size: 0.75rem;
  color: var(--text-secondary);
  padding: 0 0 4px 0;
  margin-bottom: 4px;
  border-bottom: 1px solid var(--border-light);
}

.combat-stat {
  text-align: center;
  padding: 4px;
  background: rgba(0,0,0,0.03);
  border-radius: 4px;
}

.combat-stat .stat-label {
  display: block;
  font-size: 0.7rem;
  color: var(--text-secondary);
  margin-bottom: 2px;
}

.combat-stat .stat-value {
  font-weight: 700;
  font-size: 1.0rem;
}

.stat-spinner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

.spin-btn {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid var(--border-gold);
  background: var(--button-bg, #5a4a3a);
  color: var(--text-light, #fff);
  font-size: 0.9rem;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
  z-index: 10;
  pointer-events: auto;
}

.spin-btn:hover {
  background: #6b5a4a;
}

.spin-btn:active {
  transform: scale(0.95);
}

/* Dice button for weapon damage */
.dice-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 2px 4px;
  font-size: 1rem;
  opacity: 0.7;
  transition: opacity 0.15s, transform 0.15s;
  z-index: 10;
  pointer-events: auto;
}

.dice-btn:hover {
  opacity: 1;
  transform: scale(1.2);
}

.damage-roll {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Damage Result Overlay */
.damage-result-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
}

.damage-result-overlay.visible {
  opacity: 1;
  visibility: visible;
}

.damage-result-content {
  background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
  border: 2px solid var(--border-gold);
  border-radius: 16px;
  padding: 24px 40px;
  text-align: center;
  color: #fff;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  animation: damagePopIn 0.3s ease-out;
}

@keyframes damagePopIn {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.damage-formula {
  font-size: 0.9rem;
  color: #aaa;
  margin-bottom: 8px;
}

.damage-breakdown {
  font-size: 0.85rem;
  color: #888;
  margin-bottom: 12px;
}

.damage-total {
  font-size: 4rem;
  font-weight: 700;
  color: #e94560;
  text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
  margin-bottom: 16px;
}

.damage-close {
  background: var(--border-gold);
  color: #1a1a1a;
  border: none;
  padding: 8px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.15s;
}

.damage-close:hover {
  background: #d4b44a;
}

/* Memorize Warning Overlay */
.memorize-warning-content {
  text-align: center;
}

.memorize-warning-icon {
  font-size: 3rem;
  margin-bottom: 12px;
}

.memorize-warning-message {
  font-size: 1.0rem;
  color: #eee;
  margin-bottom: 20px;
  line-height: 1.5;
  max-width: 320px;
}

/* D100 Skill Roll Result Overlay */
.d100-result-content {
  text-align: center;
}

.d100-skill-name {
  font-size: 1.2rem;
  color: #ccc;
  margin-bottom: 4px;
}

.d100-target {
  font-size: 0.9rem;
  color: #888;
  margin-bottom: 12px;
}

.d100-roll {
  font-size: 4rem;
  font-weight: 700;
  color: #fff;
  text-shadow: 0 2px 8px rgba(0,0,0,0.5);
  margin-bottom: 8px;
  font-family: monospace;
}

.d100-result {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 16px;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.d100-result.roll-critical {
  color: #ffd700;
  text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
}

.d100-result.roll-success {
  color: #4ade80;
  text-shadow: 0 0 15px rgba(74, 222, 128, 0.5);
}

.d100-result.roll-failure {
  color: #f87171;
}

.d100-result.roll-fumble {
  color: #e94560;
  text-shadow: 0 0 20px rgba(233, 69, 96, 0.7);
}

.d100-fumble-content {
  max-width: 380px;
}

.d100-fumble-text {
  font-size: 0.82rem;
  color: #bbb;
  line-height: 1.5;
  margin: 0.75rem 0;
  text-align: left;
  padding: 0.75rem;
  background: rgba(233, 69, 96, 0.1);
  border-left: 3px solid #e94560;
  border-radius: 4px;
}

.d100-fumble-question {
  font-size: 0.9rem;
  color: #ddd;
  margin: 0.75rem 0;
  font-weight: 500;
}

.d100-fumble-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  margin-top: 0.5rem;
}

.d100-fumble-btn {
  padding: 0.5rem 1rem;
  font-size: 0.85rem;
  border-radius: 6px;
  cursor: pointer;
  border: none;
  font-weight: 600;
  transition: transform 0.1s, opacity 0.2s;
}

.d100-fumble-btn:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

.d100-fumble-btn#d100-fumble-auto {
  background: #4caf50;
  color: #fff;
}

.d100-fumble-btn.d100-fumble-manual {
  background: rgba(255, 255, 255, 0.15);
  color: #ccc;
  border: 1px solid #666;
}

/* D100 Outcome Text (skill-specific result descriptions) */
.d100-outcome-text {
  font-size: 0.82rem;
  color: #ccc;
  line-height: 1.5;
  margin: 0.5rem 0;
  padding: 0.6rem 0.75rem;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 6px;
  text-align: left;
  max-width: 380px;
}

/* Skill Info Button ( next to skill names) */
.skill-info-btn {
  width: 16px;
  height: 16px;
  min-width: 16px;
  min-height: 16px;
  border-radius: 50%;
  border: 1px solid #c4a265;
  background: #f5f0e6;
  color: #8b7355;
  font-size: 0.6rem;
  font-weight: bold;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
  transition: background 0.2s, color 0.2s;
  flex-shrink: 0;
  vertical-align: middle;
  position: relative;
  z-index: 1;
}

.skill-info-btn:hover {
  background: var(--accent-color, #8b7355);
  color: white;
}

/* Skill Outcomes in info modal */
.skill-outcomes {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.skill-outcome {
  font-size: 0.85rem;
  line-height: 1.5;
}

.outcome-label {
  display: inline-block;
  font-weight: 700;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 0.1rem 0.4rem;
  border-radius: 3px;
  margin-right: 0.4rem;
  vertical-align: middle;
}

.outcome-label.outcome-critical {
  background: rgba(255, 215, 0, 0.15);
  color: #b8860b;
  border: 1px solid rgba(255, 215, 0, 0.3);
}

.outcome-label.outcome-failure {
  background: rgba(248, 113, 113, 0.1);
  color: #c62828;
  border: 1px solid rgba(248, 113, 113, 0.2);
}

.outcome-label.outcome-fumble {
  background: rgba(233, 69, 96, 0.12);
  color: #b71c1c;
  border: 1px solid rgba(233, 69, 96, 0.25);
}

.outcome-text {
  color: var(--text-primary, #3a3228);
}

/* Weapon section labels */
.weapon-section-label {
  font-size: 0.75rem;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 4px;
  font-weight: 600;
}

/* D100 button styling */
.d100-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 2px 4px;
  opacity: 0.7;
  transition: opacity 0.15s, transform 0.15s;
  z-index: 10;
  pointer-events: auto;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.d100-btn:hover {
  opacity: 1;
}

.d10-icon {
  width: 18px;
  height: 18px;
  opacity: 0.5;
  transition: opacity 0.15s, transform 0.15s, filter 0.15s;
}

.d100-btn:hover .d10-icon {
  opacity: 0.8;
}

/* Damage dice button styling */
.dice-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 2px 4px;
  font-size: 0.95rem;
  color: var(--text-secondary);
  opacity: 0.7;
  transition: opacity 0.15s, transform 0.15s, color 0.15s;
  z-index: 10;
  pointer-events: auto;
}

.dice-btn:hover {
  opacity: 1;
  transform: scale(1.2);
  color: #e94560;
}

/* Weapon table damage cell with dice button */
.damage-cell {
  display: flex;
  align-items: center;
  gap: 4px;
  width: 100%;
}

.damage-cell input.weapon-damage {
  flex: 1;
  min-width: 0;
  width: auto !important;
}

.weapon-dice-btn {
  flex-shrink: 0;
  padding: 0 2px;
  font-size: 0.85rem;
}

.skill-roll {
  display: flex;
  align-items: center;
  gap: 4px;
}

#btn-reset-summary {
  align-self: flex-start;
}

/* Theme toggle button */
#btn-theme {
  font-size: 1.0rem;
  padding: 4px 10px;
  min-width: auto;
}

/* ============================================
   CLASS THEME SYSTEM
   ============================================ */

/* Class Theme Toggle Button */
#btn-class-theme {
  font-size: 0.85rem;
  padding: 4px 10px;
  min-width: auto;
  transition: all 0.3s ease;
}

#btn-class-theme.active {
  background: linear-gradient(135deg, #4a7c59 0%, #2d5a3d 100%);
  border-color: #5a9a6a;
  color: #fff;
}

/* Base class theme variables */
[data-class-theme] {
  --class-primary: #8b7355;
  --class-secondary: #6b5344;
  --class-accent: #a08060;
  --class-glow: rgba(139, 115, 85, 0.3);
  --class-border: #8b7355;
  --class-bg-gradient-start: #2a2520;
  --class-bg-gradient-end: #1a1815;
  --class-tab-text: #fff;
  --class-decor: ""; /* Decorative character */
}

/* ===== BERSERKER - Blood Red ===== */
[data-class-theme="berserker"] {
  --class-primary: #b22222;
  --class-secondary: #8b0000;
  --class-accent: #dc143c;
  --class-glow: rgba(178, 34, 34, 0.4);
  --class-border: #b22222;
  --class-bg-gradient-start: #2a1515;
  --class-bg-gradient-end: #1a0a0a;
  --class-tab-text: #fff;
}

/* ===== BARD - Warm Gold/Purple ===== */
[data-class-theme="bard"] {
  --class-primary: #daa520;
  --class-secondary: #b8860b;
  --class-accent: #9370db;
  --class-glow: rgba(218, 165, 32, 0.4);
  --class-border: #daa520;
  --class-bg-gradient-start: #2a2515;
  --class-bg-gradient-end: #1a1810;
  --class-tab-text: #1a1a1a;
}

/* ===== CAVALIER - Noble Silver/Blue ===== */
[data-class-theme="cavalier"] {
  --class-primary: #4682b4;
  --class-secondary: #36648b;
  --class-accent: #c0c0c0;
  --class-glow: rgba(70, 130, 180, 0.4);
  --class-border: #4682b4;
  --class-bg-gradient-start: #1a2530;
  --class-bg-gradient-end: #101820;
  --class-tab-text: #fff;
}

/* ===== CLERIC - Holy Gold/White ===== */
[data-class-theme="cleric"] {
  --class-primary: #daa520;
  --class-secondary: #cd950c;
  --class-accent: #fffaf0;
  --class-glow: rgba(218, 165, 32, 0.5);
  --class-border: #daa520;
  --class-bg-gradient-start: #2a2820;
  --class-bg-gradient-end: #1a1a15;
  --class-tab-text: #1a1a1a;
}

/* ===== DRUID - Forest Green ===== */
[data-class-theme="druid"] {
  --class-primary: #228b22;
  --class-secondary: #006400;
  --class-accent: #90ee90;
  --class-glow: rgba(34, 139, 34, 0.4);
  --class-border: #228b22;
  --class-bg-gradient-start: #1a2a1a;
  --class-bg-gradient-end: #101810;
  --class-tab-text: #fff;
}

/* ===== FIGHTER - Steel Gray/Brown ===== */
[data-class-theme="fighter"] {
  --class-primary: #708090;
  --class-secondary: #556b6f;
  --class-accent: #8b7355;
  --class-glow: rgba(112, 128, 144, 0.4);
  --class-border: #708090;
  --class-bg-gradient-start: #252525;
  --class-bg-gradient-end: #181818;
  --class-tab-text: #fff;
}

/* ===== MAGE / MAGIC-USER - Arcane Blue/Purple ===== */
[data-class-theme="mage"],
[data-class-theme="magic-user"] {
  --class-primary: #6a5acd;
  --class-secondary: #483d8b;
  --class-accent: #00bfff;
  --class-glow: rgba(106, 90, 205, 0.5);
  --class-border: #6a5acd;
  --class-bg-gradient-start: #1a1a2e;
  --class-bg-gradient-end: #101018;
  --class-tab-text: #fff;
}

/* ===== MONK - Saffron Orange ===== */
[data-class-theme="monk"] {
  --class-primary: #ff8c00;
  --class-secondary: #cd6600;
  --class-accent: #ffd700;
  --class-glow: rgba(255, 140, 0, 0.4);
  --class-border: #ff8c00;
  --class-bg-gradient-start: #2a2015;
  --class-bg-gradient-end: #1a1510;
  --class-tab-text: #1a1a1a;
}

/* ===== PALADIN - Radiant Gold/Silver ===== */
[data-class-theme="paladin"] {
  --class-primary: #b8860b;
  --class-secondary: #8b6914;
  --class-accent: #f5f5f5;
  --class-glow: rgba(184, 134, 11, 0.5);
  --class-border: #b8860b;
  --class-bg-gradient-start: #2a2820;
  --class-bg-gradient-end: #1a1a18;
  --class-tab-text: #fff;
}

/* ===== RANGER - Forest Brown/Green ===== */
[data-class-theme="ranger"] {
  --class-primary: #556b2f;
  --class-secondary: #3d4f22;
  --class-accent: #8fbc8f;
  --class-glow: rgba(85, 107, 47, 0.4);
  --class-border: #556b2f;
  --class-bg-gradient-start: #1f2518;
  --class-bg-gradient-end: #151810;
  --class-tab-text: #fff;
}

/* ===== ROGUE / THIEF - Shadow Purple ===== */
[data-class-theme="rogue"],
[data-class-theme="thief"] {
  --class-primary: #6a4c93;
  --class-secondary: #4a3070;
  --class-accent: #9d7fd3;
  --class-glow: rgba(106, 76, 147, 0.5);
  --class-border: #6a4c93;
  --class-bg-gradient-start: #1a1525;
  --class-bg-gradient-end: #100d18;
  --class-tab-text: #fff;
}

/* ===== SORCERER - Wild Magic Red/Purple ===== */
[data-class-theme="sorcerer"] {
  --class-primary: #8b008b;
  --class-secondary: #660066;
  --class-accent: #ff1493;
  --class-glow: rgba(139, 0, 139, 0.5);
  --class-border: #8b008b;
  --class-bg-gradient-start: #251525;
  --class-bg-gradient-end: #180d18;
  --class-tab-text: #fff;
}

/* ===== ANTI-PALADIN - Dark Crimson ===== */
[data-class-theme="anti-paladin"] {
  --class-primary: #8b0000;
  --class-secondary: #5c0000;
  --class-accent: #ff4444;
  --class-glow: rgba(139, 0, 0, 0.5);
  --class-border: #8b0000;
  --class-bg-gradient-start: #200808;
  --class-bg-gradient-end: #100404;
  --class-tab-text: #fff;
}

/* ============================================
   CLASS THEME APPLICATION - LIGHT MODE
   ============================================ */

/* Apply class theme to major UI elements */
[data-class-theme] .sheet-navigation {
  background: linear-gradient(135deg, var(--class-bg-gradient-start) 0%, var(--class-bg-gradient-end) 100%);
  border-bottom: 2px solid var(--class-border);
}

[data-class-theme] .tab-btn.active {
  background: var(--class-primary);
  border-color: var(--class-border);
  box-shadow: 0 0 10px var(--class-glow);
  color: var(--class-tab-text);
}

[data-class-theme] .tab-btn:hover:not(.active) {
  background: var(--class-secondary);
  border-color: var(--class-border);
  color: var(--class-tab-text);
}

[data-class-theme] .section-header {
  color: var(--class-primary);
  text-shadow: 0 0 8px var(--class-glow);
}

[data-class-theme] .ornate-border {
  border-color: var(--class-border);
  box-shadow: 0 0 15px var(--class-glow);
}

[data-class-theme] .btn-primary {
  background: linear-gradient(135deg, var(--class-primary) 0%, var(--class-secondary) 100%);
  border-color: var(--class-border);
}

[data-class-theme] .btn-primary:hover {
  box-shadow: 0 0 12px var(--class-glow);
}

[data-class-theme] .section-title {
  color: var(--class-primary);
  border-bottom-color: var(--class-border);
}

[data-class-theme] .page-header h1 {
  color: var(--class-primary);
  text-shadow: 0 0 15px var(--class-glow);
}

[data-class-theme] input:focus,
[data-class-theme] select:focus,
[data-class-theme] textarea:focus {
  border-color: var(--class-primary);
  box-shadow: 0 0 5px var(--class-glow);
}

[data-class-theme] .subsection-header {
  color: var(--class-primary);
  border-bottom-color: var(--class-border);
}

[data-class-theme] .ability-cards-divider {
  border-color: var(--class-border);
}

[data-class-theme] .xp-section {
  border-color: var(--class-border);
}

[data-class-theme] .notes-tab-btn.active {
  background: var(--class-primary);
  border-color: var(--class-border);
}

/* ============================================
   CLASS THEME APPLICATION - DARK MODE
   ============================================ */

body.dark-mode[data-class-theme] {
  background: linear-gradient(135deg, var(--class-bg-gradient-start) 0%, var(--class-bg-gradient-end) 100%);
}

body.dark-mode[data-class-theme] .sheet-navigation {
  background: linear-gradient(135deg, 
    color-mix(in srgb, var(--class-bg-gradient-start) 80%, black) 0%, 
    color-mix(in srgb, var(--class-bg-gradient-end) 80%, black) 100%);
}

body.dark-mode[data-class-theme] .ornate-border {
  background: linear-gradient(135deg, var(--class-bg-gradient-start) 0%, var(--class-bg-gradient-end) 100%);
}

body.dark-mode[data-class-theme] .section-header {
  color: var(--class-accent);
}

body.dark-mode[data-class-theme] .tab-btn.active {
  background: var(--class-secondary);
  color: var(--class-accent);
}

body.dark-mode[data-class-theme] .page-header h1 {
  color: var(--class-accent);
}

body.dark-mode[data-class-theme] .section-title {
  color: var(--class-accent);
}

body.dark-mode[data-class-theme] .subsection-header {
  color: var(--class-accent);
}

/* Class theme indicator in header */
.class-theme-indicator {
  font-size: 0.7rem;
  opacity: 0.8;
  margin-left: 4px;
}

/* ============================================
   Modal Result/Confirm Content - Theme-safe colors
   ============================================ */
.modal-result-body {
  text-align: center;
  padding: 1rem 0;
}

.modal-result-body .result-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.modal-result-body .result-title {
  font-size: 1.3rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
  font-family: var(--font-header);
}

.modal-result-body .result-title.success { color: #2e7d32; }
.modal-result-body .result-title.critical { color: #b8860b; }
.modal-result-body .result-title.failure { color: #c62828; }
.modal-result-body .result-title.info { color: var(--accent-color, #8b7355); }

.modal-result-body .result-text {
  font-size: 0.95rem;
  color: var(--text-primary, #3a3228);
  margin: 0.5rem 0;
  line-height: 1.6;
}

.modal-result-body .result-detail {
  font-size: 0.85rem;
  color: var(--text-secondary, #6b6055);
  margin-top: 0.5rem;
}

.modal-result-body .result-meta {
  font-size: 0.8rem;
  color: #8a7d6f;
  margin-top: 0.75rem;
}

.modal-confirm-body {
  padding: 0.5rem 0;
}

.modal-confirm-body .confirm-icon {
  text-align: center;
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.modal-confirm-body .confirm-text {
  font-size: 0.95rem;
  color: var(--text-primary, #3a3228);
  text-align: center;
  margin-bottom: 0.75rem;
}

.modal-confirm-body .confirm-details {
  font-size: 0.85rem;
  color: var(--text-secondary, #5a5045);
  line-height: 1.8;
  padding-left: 0.5rem;
}

.modal-confirm-body .confirm-details strong {
  color: var(--text-primary, #3a3228);
}

/* Specialist II pulse animation */
@keyframes spec-ii-pulse {
  0%, 100% { box-shadow: 0 0 8px currentColor; }
  50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
}

/* 
   ROGUE ABILITY SECTIONS
    */

/* Climb Walls */
.climb-walls-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #25352a 100%);
  border: 2px solid #4a8a4a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.climb-walls-section .section-header {
  color: #7dcc7d;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.climb-walls-content {
  display: flex; flex-direction: column; gap: 0.4rem; align-items: center; text-align: center;
}

.climb-walls-info { width: 100%; }

.climb-walls-label {
  color: #88aa88; font-size: 0.72rem; font-style: italic;
}

.btn-climb-walls {
  width: 100%;
  background: linear-gradient(135deg, #2a4a2a 0%, #3a6a3a 50%, #2a4a2a 100%);
  color: white;
  border: 1px solid #4a8a4a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(45, 90, 45, 0.4);
}

.btn-climb-walls:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a5a3a 0%, #4a7a4a 50%, #3a5a3a 100%);
  box-shadow: 0 4px 12px rgba(92, 184, 92, 0.5);
  transform: translateY(-1px);
}

.btn-climb-walls:disabled {
  opacity: 0.4; cursor: not-allowed; filter: grayscale(0.5);
}

.climb-walls-active-btn {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a8a4a 50%, #3a6a3a 100%) !important;
  border-color: #7dcc7d !important;
  color: #aaffaa !important;
  box-shadow: 0 0 15px rgba(125, 204, 125, 0.4) !important;
  animation: climbPulse 2s ease-in-out infinite;
}

@keyframes climbPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(125, 204, 125, 0.3); }
  50% { box-shadow: 0 0 20px rgba(125, 204, 125, 0.6); }
}

/* Hide in Shadows */
.hide-in-shadows-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a1a2a 0%, #252535 100%);
  border: 2px solid #6a5aaa;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.hide-in-shadows-section .section-header {
  color: #b09ae0;
  text-shadow: 0 0 10px rgba(160, 140, 220, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.hide-in-shadows-content {
  display: flex; flex-direction: column; gap: 0.4rem; align-items: center; text-align: center;
}

.hide-in-shadows-info { width: 100%; }

.hide-in-shadows-label {
  color: #8888aa; font-size: 0.72rem; font-style: italic;
}

.btn-hide-in-shadows {
  width: 100%;
  background: linear-gradient(135deg, #2a2a4a 0%, #3a3a6a 50%, #2a2a4a 100%);
  color: white;
  border: 1px solid #6a5aaa;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(80, 60, 140, 0.4);
}

.btn-hide-in-shadows:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a3a5a 0%, #4a4a7a 50%, #3a3a5a 100%);
  box-shadow: 0 4px 12px rgba(128, 90, 213, 0.5);
  transform: translateY(-1px);
}

.hide-in-shadows-active-btn {
  background: linear-gradient(135deg, #3a3a6a 0%, #4a4a8a 50%, #3a3a6a 100%) !important;
  border-color: #b09ae0 !important;
  color: #d4c4ff !important;
  box-shadow: 0 0 15px rgba(128, 90, 213, 0.4) !important;
  animation: shadowPulse 2s ease-in-out infinite;
}

@keyframes shadowPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(128, 90, 213, 0.3); }
  50% { box-shadow: 0 0 20px rgba(128, 90, 213, 0.6); }
}

/* Sneak Attack Info Card */
.sneak-attack-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a1a1a 0%, #352025 100%);
  border: 2px solid #8a3a3a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.sneak-attack-section .section-header {
  color: #e06060;
  text-shadow: 0 0 10px rgba(220, 80, 80, 0.4);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.sneak-attack-card {
  font-size: 0.78rem; color: #cca; line-height: 1.5;
}

.sneak-attack-req { margin-bottom: 0.2rem; }

.sneak-attack-divider {
  height: 1px; background: rgba(220, 80, 80, 0.2); margin: 0.4rem 0;
}

.sneak-attack-effect { margin-bottom: 0.2rem; }

.sneak-attack-bullets {
  display: flex; flex-direction: column; gap: 0.1rem;
  padding-left: 0.5rem; color: #e06060; font-size: 0.75rem;
}

.sneak-attack-defense {
  font-size: 0.73rem; color: #998;
}

/* Subterfuge boost indicator on skills */
.subterfuge-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

.subterfuge-boosted::after {
  content: '';
}

/* Climb Walls / Hide in Shadows boost indicator on skills */
.cw-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

.his-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* Rogue ability full-page activation animations */
.climb-walls-anim-overlay {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.7);
  display: flex; justify-content: center; align-items: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.climb-walls-anim-overlay.active { opacity: 1; }
.climb-walls-anim-overlay.fade-out { opacity: 0; }

.climb-walls-anim-content {
  position: relative;
  width: 300px; height: 300px;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
}

.cw-glow {
  position: absolute;
  width: 150px; height: 150px;
  background: radial-gradient(circle, rgba(125, 204, 125, 0.5) 0%, rgba(92, 184, 92, 0.3) 40%, transparent 70%);
  border-radius: 50%;
  animation: cwGlowPulse 0.8s ease-out infinite;
}

@keyframes cwGlowPulse {
  0% { transform: scale(0.6); opacity: 1; }
  50% { transform: scale(1.3); opacity: 0.7; }
  100% { transform: scale(0.6); opacity: 1; }
}

.cw-rocks {
  position: absolute; width: 200px; height: 200px;
}

.cw-rocks .rock {
  position: absolute; font-size: 1.4rem; opacity: 0;
  animation: cwRockFloat 1.5s ease-out forwards;
}
.cw-rocks .rock:nth-child(1) { left: 20%; top: 70%; animation-delay: 0s; }
.cw-rocks .rock:nth-child(2) { left: 65%; top: 65%; animation-delay: 0.15s; }
.cw-rocks .rock:nth-child(3) { left: 10%; top: 40%; animation-delay: 0.3s; }
.cw-rocks .rock:nth-child(4) { left: 75%; top: 35%; animation-delay: 0.45s; }
.cw-rocks .rock:nth-child(5) { left: 40%; top: 15%; animation-delay: 0.6s; }

@keyframes cwRockFloat {
  0% { opacity: 0; transform: translateY(20px) scale(0.5); }
  30% { opacity: 1; transform: translateY(0) scale(1); }
  80% { opacity: 1; transform: translateY(-10px) scale(1); }
  100% { opacity: 0; transform: translateY(-30px) scale(0.7); }
}

.climb-walls-icon {
  font-size: 4rem; z-index: 1;
  animation: cwIconPulse 0.5s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(92, 184, 92, 0.8));
}

@keyframes cwIconPulse {
  from { transform: scale(1); }
  to { transform: scale(1.15); }
}

.climb-walls-anim-text {
  font-size: 1.4rem; font-weight: bold; z-index: 1;
  color: #7dcc7d;
  text-shadow: 0 0 15px rgba(125, 204, 125, 0.6);
  margin-top: 0.5rem;
}

/* Hide in Shadows full-page animation */
.hide-in-shadows-anim-overlay {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.85);
  display: flex; justify-content: center; align-items: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.hide-in-shadows-anim-overlay.active { opacity: 1; }
.hide-in-shadows-anim-overlay.fade-out { opacity: 0; }

.hide-in-shadows-anim-content {
  position: relative;
  width: 300px; height: 300px;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
}

.his-void {
  position: absolute;
  width: 180px; height: 180px;
  background: radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(50, 30, 80, 0.5) 50%, transparent 70%);
  border-radius: 50%;
  animation: hisVoidPulse 1s ease-in-out infinite;
}

@keyframes hisVoidPulse {
  0% { transform: scale(0.7); opacity: 0.8; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(0.7); opacity: 0.8; }
}

.his-wisps {
  position: absolute; width: 250px; height: 250px;
  animation: hisWispRotate 4s linear infinite;
}

@keyframes hisWispRotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.his-wisps .wisp {
  position: absolute;
  width: 3px; height: 60px;
  background: linear-gradient(to top, transparent, rgba(128, 90, 213, 0.6), transparent);
  left: 50%; top: 10%;
  transform-origin: bottom center;
  opacity: 0.6;
}

.his-wisps .wisp:nth-child(1) { transform: translateX(-50%) rotate(0deg); }
.his-wisps .wisp:nth-child(2) { transform: translateX(-50%) rotate(60deg); }
.his-wisps .wisp:nth-child(3) { transform: translateX(-50%) rotate(120deg); }
.his-wisps .wisp:nth-child(4) { transform: translateX(-50%) rotate(180deg); }
.his-wisps .wisp:nth-child(5) { transform: translateX(-50%) rotate(240deg); }
.his-wisps .wisp:nth-child(6) { transform: translateX(-50%) rotate(300deg); }

.hide-in-shadows-icon {
  font-size: 4rem; z-index: 1;
  animation: hisIconPulse 0.6s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 25px rgba(128, 90, 213, 0.9));
}

@keyframes hisIconPulse {
  from { transform: scale(1); opacity: 1; }
  to { transform: scale(1.1); opacity: 0.7; }
}

.hide-in-shadows-anim-text {
  font-size: 1.4rem; font-weight: bold; z-index: 1;
  color: #b09ae0;
  text-shadow: 0 0 15px rgba(128, 90, 213, 0.6);
  margin-top: 0.5rem;
}

/* ===== Great Hearing Section ===== */
.great-hearing-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #25352a 100%);
  border: 2px solid #4a8a4a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.great-hearing-section .section-header {
  color: #7dcc7d;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.great-hearing-content {
  display: flex; flex-direction: column; gap: 0.4rem; align-items: center; text-align: center;
}

.great-hearing-label {
  color: #88aa88; font-size: 0.72rem; font-style: italic;
}

.btn-great-hearing {
  width: 100%;
  background: linear-gradient(135deg, #2a4a2a 0%, #3a6a3a 50%, #2a4a2a 100%);
  color: white;
  border: 1px solid #4a8a4a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(45, 90, 45, 0.4);
}

.btn-great-hearing:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a5a3a 0%, #4a7a4a 50%, #3a5a3a 100%);
  box-shadow: 0 4px 12px rgba(92, 184, 92, 0.5);
  transform: translateY(-1px);
}

.great-hearing-active-btn {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a8a4a 50%, #3a6a3a 100%) !important;
  border-color: #7dcc7d !important;
  color: #aaffaa !important;
  box-shadow: 0 0 15px rgba(125, 204, 125, 0.4) !important;
  animation: ghPulse 2s ease-in-out infinite;
}

@keyframes ghPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(125, 204, 125, 0.3); }
  50% { box-shadow: 0 0 20px rgba(125, 204, 125, 0.6); }
}

.gh-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ===== Sharp Eyed Section ===== */
.sharp-eyed-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a1a 0%, #25352a 100%);
  border: 2px solid #4a8a4a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.sharp-eyed-section .section-header {
  color: #7dcc7d;
  text-shadow: 0 0 10px rgba(125, 204, 125, 0.5);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.sharp-eyed-content {
  display: flex; flex-direction: column; gap: 0.4rem; align-items: center; text-align: center;
}

.sharp-eyed-label {
  color: #88aa88; font-size: 0.72rem; font-style: italic;
}

.btn-sharp-eyed {
  width: 100%;
  background: linear-gradient(135deg, #2a4a2a 0%, #3a6a3a 50%, #2a4a2a 100%);
  color: white;
  border: 1px solid #4a8a4a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(45, 90, 45, 0.4);
}

.btn-sharp-eyed:hover:not(:disabled) {
  background: linear-gradient(135deg, #3a5a3a 0%, #4a7a4a 50%, #3a5a3a 100%);
  box-shadow: 0 4px 12px rgba(92, 184, 92, 0.5);
  transform: translateY(-1px);
}

.sharp-eyed-active-btn {
  background: linear-gradient(135deg, #3a6a3a 0%, #4a8a4a 50%, #3a6a3a 100%) !important;
  border-color: #7dcc7d !important;
  color: #aaffaa !important;
  box-shadow: 0 0 15px rgba(125, 204, 125, 0.4) !important;
  animation: sePulseRogue 2s ease-in-out infinite;
}

@keyframes sePulseRogue {
  0%, 100% { box-shadow: 0 0 10px rgba(125, 204, 125, 0.3); }
  50% { box-shadow: 0 0 20px rgba(125, 204, 125, 0.6); }
}

.se-boosted-rogue {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ===== Vaulting Section ===== */
.vaulting-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a2a1a 0%, #353520 100%);
  border: 2px solid #8a8a4a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.vaulting-section .section-header {
  color: #cccc7d;
  text-shadow: 0 0 10px rgba(200, 200, 100, 0.4);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.vaulting-content {
  display: flex; flex-direction: column; gap: 0.4rem; align-items: center; text-align: center;
}

.vaulting-label {
  color: #aaaa88; font-size: 0.72rem; font-style: italic;
}

.btn-vaulting {
  width: 100%;
  background: linear-gradient(135deg, #3a3a1a 0%, #5a5a2a 50%, #3a3a1a 100%);
  color: white;
  border: 1px solid #8a8a4a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(100, 100, 50, 0.4);
}

.btn-vaulting:hover:not(:disabled) {
  background: linear-gradient(135deg, #4a4a2a 0%, #6a6a3a 50%, #4a4a2a 100%);
  box-shadow: 0 4px 12px rgba(150, 150, 75, 0.5);
  transform: translateY(-1px);
}

.btn-vaulting:disabled {
  opacity: 0.4; cursor: not-allowed; filter: grayscale(0.5);
}

.vaulting-active-btn {
  background: linear-gradient(135deg, #5a5a2a 0%, #7a7a3a 50%, #5a5a2a 100%) !important;
  border-color: #cccc7d !important;
  color: #ffffaa !important;
  box-shadow: 0 0 15px rgba(200, 200, 100, 0.4) !important;
  animation: vaultPulse 2s ease-in-out infinite;
}

@keyframes vaultPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(200, 200, 100, 0.3); }
  50% { box-shadow: 0 0 20px rgba(200, 200, 100, 0.6); }
}

.vault-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

/* ===== Unarmored Defense (auto-passive) ===== */
.unarmored-defense-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a2a 0%, #253535 100%);
  border: 2px solid #4a8a8a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.unarmored-defense-section .section-header {
  color: #7dccc0;
  text-shadow: 0 0 10px rgba(100, 200, 180, 0.4);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.unarmored-defense-content {
  text-align: center;
}

.unarmored-defense-label {
  color: #88aaaa; font-size: 0.72rem; font-style: italic;
}

.ud-boosted {
  background-color: rgba(34, 139, 34, 0.2) !important;
  border-color: #228b22 !important;
  color: #1a6b1a !important;
}

.ud-active-indicator {
  display: inline-block;
  padding: 0.15rem 0.5rem;
  background: rgba(92, 188, 176, 0.15);
  border: 1px solid #4a8a8a;
  border-radius: 4px;
  color: #7dccc0;
  font-size: 0.72rem;
  font-weight: bold;
  margin-top: 0.3rem;
  animation: udPulse 2s ease-in-out infinite;
}

@keyframes udPulse {
  0%, 100% { opacity: 0.8; }
  50% { opacity: 1; box-shadow: 0 0 8px rgba(92, 188, 176, 0.4); }
}

/* ===== Sneak Attack Bonus Damage ===== */
.sneak-attack-bonus-area {
  margin-top: 0.3rem;
}

.sneak-attack-bonus-label {
  color: #e06060;
  font-size: 0.78rem;
  font-weight: bold;
  margin-bottom: 0.3rem;
}

.btn-sneak-damage {
  width: 100%;
  background: linear-gradient(135deg, #4a1a1a 0%, #6a2a2a 50%, #4a1a1a 100%);
  color: white;
  border: 1px solid #8a3a3a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(100, 30, 30, 0.4);
}

.btn-sneak-damage:hover {
  background: linear-gradient(135deg, #5a2a2a 0%, #7a3a3a 50%, #5a2a2a 100%);
  box-shadow: 0 4px 12px rgba(180, 50, 50, 0.5);
  transform: translateY(-1px);
}

.sneak-damage-active-btn {
  background: linear-gradient(135deg, #6a2a2a 0%, #8a3a3a 50%, #6a2a2a 100%) !important;
  border-color: #e06060 !important;
  color: #ffaaaa !important;
  box-shadow: 0 0 15px rgba(220, 80, 80, 0.4) !important;
  animation: sneakDmgPulse 2s ease-in-out infinite;
}

@keyframes sneakDmgPulse {
  0%, 100% { box-shadow: 0 0 10px rgba(220, 80, 80, 0.3); }
  50% { box-shadow: 0 0 20px rgba(220, 80, 80, 0.6); }
}

/* ===== Weapon Precision Info Card ===== */
.weapon-precision-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #2a2a1a 0%, #35352a 100%);
  border: 2px solid #7a7a5a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.weapon-precision-section .section-header {
  color: #ccbb88;
  text-shadow: 0 0 8px rgba(200, 180, 120, 0.3);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.weapon-precision-card {
  font-size: 0.78rem;
  color: #bba;
}

.wp-calc-row {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  flex-wrap: wrap;
  justify-content: center;
  margin-bottom: 0.3rem;
}

.wp-calc-label { color: #998; font-size: 0.72rem; }
.wp-calc-value { color: #ccbb88; font-weight: bold; font-size: 0.85rem; }
.wp-calc-sep { color: #776; font-size: 0.7rem; font-style: italic; }

.wp-active-indicator {
  font-size: 0.7rem;
  font-weight: bold;
  padding: 0.1rem 0.4rem;
  border-radius: 3px;
}

.wp-active-indicator.wp-better {
  color: #7dcc7d;
  background: rgba(92, 184, 92, 0.15);
  border: 1px solid rgba(92, 184, 92, 0.3);
}

.wp-active-indicator.wp-worse {
  color: #998;
  background: rgba(100, 100, 80, 0.15);
  border: 1px solid rgba(100, 100, 80, 0.2);
}

.wp-weapons-list {
  font-size: 0.68rem;
  color: #887;
  font-style: italic;
  text-align: center;
}

/* ===== Skirmishing / Swashbuckling / Arcane Scrolls Info Cards ===== */
.skirmishing-section, .swashbuckling-section, .arcane-scrolls-section, .read-languages-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2020 0%, #252a2a 100%);
  border: 2px solid #5a7a7a;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.skirmishing-section .section-header,
.swashbuckling-section .section-header,
.arcane-scrolls-section .section-header,
.read-languages-section .section-header {
  color: #8ab8b8;
  text-shadow: 0 0 8px rgba(120, 170, 170, 0.3);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.skirmishing-card, .swashbuckling-card, .arcane-scrolls-card {
  font-size: 0.78rem;
  color: #aab8b8;
  text-align: center;
  line-height: 1.5;
}

.arcane-scrolls-warning {
  color: #e06060;
  font-weight: bold;
  font-size: 0.75rem;
  margin-top: 0.3rem;
}

.arcane-scrolls-detail {
  color: #aa8888;
  font-size: 0.72rem;
  font-style: italic;
  margin-top: 0.15rem;
}

.btn-arcane-scroll-roll {
  width: 100%;
  margin-top: 0.4rem;
  background: linear-gradient(135deg, #2a1a4a 0%, #3a2a5a 50%, #2a1a4a 100%);
  color: #d4b0ff;
  border: 1px solid #6a4a9a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(80, 40, 120, 0.4);
}

.btn-arcane-scroll-roll:hover {
  background: linear-gradient(135deg, #3a2a5a 0%, #4a3a6a 50%, #3a2a5a 100%);
  box-shadow: 0 4px 12px rgba(120, 60, 180, 0.5);
  transform: translateY(-1px);
}

/* --- Read Languages Pending --- */
.read-languages-content {
  display: flex; flex-direction: column; gap: 0.4rem; align-items: center; text-align: center;
}

.read-languages-label {
  color: #8888aa; font-size: 0.72rem; font-style: italic;
}

.btn-read-languages {
  width: 100%;
  background: linear-gradient(135deg, #2a2a3a 0%, #3a3a5a 50%, #2a2a3a 100%);
  color: white;
  border: 1px solid #5a7a7a;
  padding: 0.4rem 0.6rem;
  font-size: 0.85rem;
  font-weight: bold;
  cursor: pointer;
  border-radius: 5px;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  box-shadow: 0 2px 8px rgba(60, 80, 100, 0.4);
}

.btn-read-languages:hover {
  background: linear-gradient(135deg, #3a3a4a 0%, #4a4a6a 50%, #3a3a4a 100%);
  box-shadow: 0 4px 12px rgba(80, 100, 140, 0.5);
  transform: translateY(-1px);
}

/* --- Defensive Reflexes --- */
.defensive-reflexes-section {
  padding: 0.5rem;
  background: linear-gradient(135deg, #1a2a2a 0%, #253035 100%);
  border: 2px solid #4a8aaa;
  border-radius: 6px;
  margin-top: 0.75rem;
}

.defensive-reflexes-section .section-header {
  color: #7dcced;
  text-shadow: 0 0 10px rgba(125, 204, 237, 0.4);
  font-size: 0.85rem;
  margin-bottom: 0.25rem;
}

.defensive-reflexes-content {
  display: flex; flex-direction: column; gap: 0.3rem; align-items: center; text-align: center;
}

.dr-info-row {
  display: flex; align-items: baseline; gap: 0.4rem;
}

.dr-bonus-value {
  font-size: 1.3rem; font-weight: bold; color: #7dcced;
  text-shadow: 0 0 10px rgba(125, 204, 237, 0.5);
}

.dr-bonus-label {
  font-size: 0.8rem; color: #aacccc;
}

.dr-uses-label {
  font-size: 0.75rem; color: #88aaaa; font-style: italic;
}

.dr-rules {
  font-size: 0.7rem; color: #778; line-height: 1.3;
}

/* ===== Rogue full-page animations: Great Hearing, Sharp Eyed, Vaulting ===== */
.great-hearing-anim-overlay,
.sharp-eyed-anim-overlay,
.vaulting-anim-overlay {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.7);
  display: flex; justify-content: center; align-items: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.great-hearing-anim-overlay.active,
.sharp-eyed-anim-overlay.active,
.vaulting-anim-overlay.active { opacity: 1; }

.great-hearing-anim-overlay.fade-out,
.sharp-eyed-anim-overlay.fade-out,
.vaulting-anim-overlay.fade-out { opacity: 0; }

.rogue-anim-content {
  position: relative;
  width: 300px; height: 300px;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
}

.rogue-anim-glow {
  position: absolute;
  width: 150px; height: 150px;
  border-radius: 50%;
  animation: rogueGlowPulse 0.8s ease-out infinite;
}

.great-hearing-anim-overlay .rogue-anim-glow {
  background: radial-gradient(circle, rgba(125, 204, 125, 0.5) 0%, rgba(92, 184, 92, 0.2) 50%, transparent 70%);
}

.sharp-eyed-anim-overlay .rogue-anim-glow {
  background: radial-gradient(circle, rgba(125, 204, 125, 0.5) 0%, rgba(92, 184, 92, 0.2) 50%, transparent 70%);
}

.vaulting-anim-overlay .rogue-anim-glow {
  background: radial-gradient(circle, rgba(200, 200, 100, 0.5) 0%, rgba(170, 170, 68, 0.2) 50%, transparent 70%);
}

@keyframes rogueGlowPulse {
  0% { transform: scale(0.6); opacity: 1; }
  50% { transform: scale(1.3); opacity: 0.7; }
  100% { transform: scale(0.6); opacity: 1; }
}

.rogue-anim-icon {
  font-size: 4rem; z-index: 1;
  animation: rogueIconPulse 0.5s ease-in-out infinite alternate;
}

.great-hearing-anim-overlay .rogue-anim-icon {
  filter: drop-shadow(0 0 20px rgba(92, 184, 92, 0.8));
}

.sharp-eyed-anim-overlay .rogue-anim-icon {
  filter: drop-shadow(0 0 20px rgba(92, 184, 92, 0.8));
}

.vaulting-anim-overlay .rogue-anim-icon {
  filter: drop-shadow(0 0 20px rgba(200, 200, 100, 0.8));
}

@keyframes rogueIconPulse {
  from { transform: scale(1); }
  to { transform: scale(1.15); }
}

.rogue-anim-text {
  font-size: 1.4rem; font-weight: bold; z-index: 1;
  margin-top: 0.5rem;
}

.great-hearing-anim-overlay .rogue-anim-text {
  color: #7dcc7d;
  text-shadow: 0 0 15px rgba(125, 204, 125, 0.6);
}

.sharp-eyed-anim-overlay .rogue-anim-text {
  color: #7dcc7d;
  text-shadow: 0 0 15px rgba(125, 204, 125, 0.6);
}

.vaulting-anim-overlay .rogue-anim-text {
  color: #cccc7d;
  text-shadow: 0 0 15px rgba(200, 200, 100, 0.6);
}

/* ===== Sneak Attack Damage full-page animation ===== */
.sneak-damage-anim-overlay {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.75);
  display: flex; justify-content: center; align-items: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.sneak-damage-anim-overlay.active { opacity: 1; }
.sneak-damage-anim-overlay.fade-out { opacity: 0; }

.sneak-damage-anim-content {
  position: relative;
  width: 300px; height: 300px;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
}

.sneak-damage-glow {
  position: absolute;
  width: 150px; height: 150px;
  background: radial-gradient(circle, rgba(220, 80, 80, 0.6) 0%, rgba(180, 40, 40, 0.2) 50%, transparent 70%);
  border-radius: 50%;
  animation: rogueGlowPulse 0.8s ease-out infinite;
}

.sneak-damage-icon {
  font-size: 4rem; z-index: 1;
  animation: rogueIconPulse 0.5s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 20px rgba(220, 80, 80, 0.8));
}

.sneak-damage-text {
  font-size: 1.4rem; font-weight: bold; z-index: 1;
  color: #e06060;
  text-shadow: 0 0 15px rgba(220, 80, 80, 0.6);
  margin-top: 0.5rem;
}

.sneak-damage-dice {
  font-size: 1.1rem; z-index: 1;
  color: #ffaaaa;
  text-shadow: 0 0 10px rgba(220, 80, 80, 0.4);
  margin-top: 0.3rem;
}
